<mat-spinner-pbandi class="page" *ngIf="isLoading()"></mat-spinner-pbandi>
<div class="page" [ngClass]="{'displayNone': isLoading()}" id="scrollId">
    <div class="title">
        <div class="backContainer">
            <button (click)="goToCreaAnteprima()" mat-button>
                <mat-icon class="blue-icon">keyboard_backspace</mat-icon>
                <span class="backText">Torna alla creazione dell'anteprima di proposta</span>
            </button>
        </div>
        <h2>Creazione di proposta di certificazione</h2>
    </div>
    <div class="content">
        <mat-card class="mat-elevation-z2 messageSuccess" *ngIf="isMessageSuccessVisible">
            <mat-card-content class="messageSuccessContent">
                <p [innerHTML]="messageSuccess"></p>
            </mat-card-content>
        </mat-card>
        <mat-card class="mat-elevation-z2 messageError" *ngIf="isMessageErrorVisible">
            <mat-card-content class="messageErrorContent">
                <p [innerHTML]="messageError"></p>
            </mat-card-content>
        </mat-card>
        <mat-card class="mat-elevation-z2">
            <mat-card-content>
                <mat-form-field style="width: 30%">
                    <input matInput placeholder="Linea di intervento" [ngModel]="lineaDiIntervento.descLinea"
                        disabled />
                </mat-form-field>
            </mat-card-content>
        </mat-card>
    </div>
    <div class="content">
        <mat-card class="mat-elevation-z2">
            <mat-card-content>
                <div class="header">
                    <h3 class="search">Criteri di ricerca
                        <button mat-icon-button (click)="criteriRicercaOpened = !criteriRicercaOpened;">
                            <mat-icon class="arrow" *ngIf="criteriRicercaOpened">arrow_drop_up</mat-icon>
                            <mat-icon class="arrow" *ngIf="!criteriRicercaOpened">arrow_drop_down</mat-icon>
                        </button>
                    </h3>
                </div>
                <div *ngIf="criteriRicercaOpened">
                    <form #ricercaForm="ngForm" (submit)="ricerca()">
                        <div class="row">
                            <mat-form-field class="col">
                                <mat-label>Selezionare un bando-linea</mat-label>
                                <mat-select [(ngModel)]="bandoLineaSelected" name="bando"
                                    (selectionChange)="onSelectBandoLinea()">
                                    <mat-option *ngFor="let option of bandiLinea" [value]="option">
                                        {{ option.nomeBandoLinea }}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <div class="row">
                            <mat-form-field class="col">
                                <mat-label>Selezionare un beneficiario</mat-label>
                                <mat-select [(ngModel)]="beneficiarioSelected" name="beneficiario"
                                    (selectionChange)="onSelectBeneficiario()">
                                    <mat-option *ngFor="let option of beneficiari" [value]="option">
                                        {{ option.denominazioneBeneficiario }}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <div class="row">
                            <mat-form-field class="col">
                                <mat-label>Selezionare un codice</mat-label>
                                <mat-select [(ngModel)]="progettoSelected" name="progetto"
                                    (selectionChange)="onSelectProgetto()">
                                    <mat-option *ngFor="let option of progetti" [value]="option">
                                        {{ option.codiceProgetto }}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <div class="row">
                            <div class="marginTop10">
                                <button class="button-style-2 margin0" mat-raised-button type="submit">
                                    CERCA
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </mat-card-content>
        </mat-card>
    </div>
    <div class="content" [ngClass]="{'displayNone': !dataSourceAmmessi || !elencoProgettiAmmessi}">
        <h3>Progetti ammessi</h3>
        <mat-card class="mat-elevation-z2">
            <mat-card-content>
                <table mat-table [dataSource]="dataSourceAmmessi" matSort #sortAmmessi="matSort" style="width: 100%;">

                    <ng-container matColumnDef="check">
                        <th mat-header-cell *matHeaderCellDef class="radio">
                            <mat-checkbox (change)="selectAllCheckbox('A',$event)" [(ngModel)]="allCheckedAmmessi">
                            </mat-checkbox>
                        </th>
                        <td mat-cell *matCellDef="let row" class="radio">
                            <mat-checkbox (change)="selectCheckbox(row.idPreviewDettPropCer,'A',$event)"
                                value="{{row.checked}}" [(ngModel)]="row.checked"></mat-checkbox>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="codiceprogetto">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 23%;"> Codice progetto </th>
                        <td mat-cell *matCellDef="let row" style="width: 23%;">
                            {{row.codiceProgetto}}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="beneficiario">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 23%;"> Beneficiario </th>
                        <td mat-cell *matCellDef="let row" style="width: 23%;"> {{row.denominazioneBeneficiario}}</td>
                    </ng-container>

                    <ng-container matColumnDef="importocert">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 15%;"> Importo certificato
                            (ultima proposta approvata)
                        </th>
                        <td mat-cell *matCellDef="let row" style="width: 15%;">
                            {{row.importoCertificazioneNetto | number: '0.2' : 'it'}}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="pagamenti">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 15%;"> Pagamenti (IGRUE)
                        </th>
                        <td mat-cell *matCellDef="let row" style="width: 15%;">
                            {{row.importoPagamenti | number: '0.2' : 'it'}}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="importorev">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 15%;"> Importo revoche
                        </th>
                        <td mat-cell *matCellDef="let row" style="width: 15%;">
                            {{row.importoRevoche | number: '0.2' : 'it'}}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="lineaintervento">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 10%;"> Linea di intervento
                        </th>
                        <td mat-cell *matCellDef="let row" style="width: 10%;">
                            {{row.descLinea}}
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumnsAmmessi"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumnsAmmessi;"></tr>
                </table>
                <mat-paginator #paginatorAmmessi [pageSizeOptions]="[5, 10, 25, 100]" [pageSize]="10"
                    [showFirstLastButtons]="true">
                </mat-paginator>
                <div class="flexEnd">
                    <div matTooltip="Selezionare un elemento dall'elenco"
                        [matTooltipDisabled]="idDettPropAmmessiChecked.length>0">
                        <button mat-raised-button class="button-style-2" (click)="sospendi()"
                            [disabled]="idDettPropAmmessiChecked.length===0">SOSPENDI</button>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>
    </div>
    <div class="content" [ngClass]="{'displayNone': !dataSourceSospesi || !elencoProgettiSospesi}">
        <h3>Progetti sospesi</h3>
        <mat-card class="mat-elevation-z2">
            <mat-card-content>
                <table mat-table [dataSource]="dataSourceSospesi" matSort #sortSospesi="matSort" style="width: 100%;">

                    <ng-container matColumnDef="check">
                        <th mat-header-cell *matHeaderCellDef class="radio">
                            <mat-checkbox (change)="selectAllCheckbox('S',$event)" [(ngModel)]="allCheckedSospesi">
                            </mat-checkbox>
                        </th>
                        <td mat-cell *matCellDef="let row" class="radio">
                            <mat-checkbox (change)="selectCheckbox(row.idPreviewDettPropCer,'S',$event)"
                                value="{{row.checked}}" [(ngModel)]="row.checked"></mat-checkbox>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="codiceprogetto">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 23%;"> Codice progetto </th>
                        <td mat-cell *matCellDef="let row" style="width: 23%;">
                            {{row.codiceProgetto}}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="beneficiario">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 23%;"> Beneficiario </th>
                        <td mat-cell *matCellDef="let row" style="width: 23%;"> {{row.denominazioneBeneficiario}}</td>
                    </ng-container>

                    <ng-container matColumnDef="importocert">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 15%;"> Importo certificato
                            (ultima proposta approvata)
                        </th>
                        <td mat-cell *matCellDef="let row" style="width: 15%;">
                            {{row.importoCertificazioneNetto | number: '0.2' : 'it'}}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="pagamenti">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 15%;"> Pagamenti (IGRUE)
                        </th>
                        <td mat-cell *matCellDef="let row" style="width: 15%;">
                            {{row.importoPagamenti | number: '0.2' : 'it'}}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="importorev">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 15%;"> Importo revoche
                        </th>
                        <td mat-cell *matCellDef="let row" style="width: 15%;">
                            {{row.importoRevoche | number: '0.2' : 'it'}}
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumnsSospesi"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumnsSospesi;"></tr>
                </table>
                <mat-paginator #paginatorSospesi [pageSizeOptions]="[5, 10, 25, 100]" [pageSize]="10"
                    [showFirstLastButtons]="true">
                </mat-paginator>
                <div class="flexEnd">
                    <button mat-raised-button class="button-style-2 marginRight10"
                        (click)="scaricaExcel(idProposta, elencoProgettiSospesi)">SCARICA IN EXCEL</button>
                    <div matTooltip="Selezionare un elemento dall'elenco"
                        [matTooltipDisabled]="idDettPropSospesiChecked.length>0">
                        <button mat-raised-button class="button-style-2" (click)="riammetti()"
                            [disabled]="idDettPropSospesiChecked.length===0">RIAMMETTI</button>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>
    </div>
    <div class="content">
        <div class="textAlignRight marginTop10">
            <button mat-raised-button class="button-style-2" (click)="creaProposta()">CREA PROPOSTA</button>
        </div>
    </div>
</div>