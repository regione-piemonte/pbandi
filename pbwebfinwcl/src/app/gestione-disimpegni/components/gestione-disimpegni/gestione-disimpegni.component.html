<mat-spinner-pbandi [hidden]="!this.isLoading()"></mat-spinner-pbandi>
<div class="page" id="scrollId">
    <div class="title">
        <div class="reportingContainerUp">
            <div>
                <h2>Ricerca impegni</h2>
            </div>
        </div>
    </div>
    <div class="content" *ngIf="isMessageErrorVisible">
        <mat-card class="mat-elevation-z2 messageError">
            <mat-card-content class="messageErrorContent">
                <p [innerHTML]="messageError"></p>
            </mat-card-content>
        </mat-card>
    </div>
    <div class="content">
        <mat-card class="mat-elevation-z2 messageSuccess" *ngIf="isMessageSuccessVisible">
            <mat-card-content class="messageSuccessContent">
                <p [innerHTML]="messageSuccess"></p>
            </mat-card-content>
        </mat-card>
    </div>
    <div class="content">
        <mat-card class="mat-elevation-z2">
            <mat-card-content>
                <div class="header">
                    <h3 class="search">Criteri di ricerca
                        <button mat-icon-button (click)="criteriRicercaOpenClose()">
                            <mat-icon class="arrow" *ngIf="criteriRicercaOpened">arrow_drop_up</mat-icon>
                            <mat-icon class="arrow" *ngIf="!criteriRicercaOpened">arrow_drop_down</mat-icon>
                        </button>
                    </h3>
                </div>
                <div *ngIf="criteriRicercaOpened">
                    <form #ricercaForm="ngForm" (submit)="cerca(true)">
                        <mat-grid-list cols="8" rowHeight="60px">
                            <mat-grid-tile [colspan]="4" [rowspan]="1">
                                <mat-form-field class="marginRight10 fullWidth">
                                    <mat-label>Selezionare anno di esercizio *</mat-label>
                                    <mat-select [(ngModel)]="annoEsercizioSelected" name="annoEsercizio"
                                        [ngModelOptions]="{standalone: true}">
                                        <mat-option *ngFor="let annoEsercizio of anniEsercizio" [value]="annoEsercizio">
                                            {{ annoEsercizio }}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </mat-grid-tile>
                            <mat-grid-tile [colspan]="4" [rowspan]="1">
                                <div class="fullWidth">
                                    <mat-checkbox class="example-margin" [(ngModel)]="checkedImpegniReimputati"
                                        [ngModelOptions]="{standalone: true}">
                                        impegni reimputati
                                    </mat-checkbox>
                                </div>
                            </mat-grid-tile>
                        </mat-grid-list>
                        <mat-grid-list cols="8" rowHeight="60px">
                            <mat-grid-tile [colspan]="2" [rowspan]="1">
                                <mat-form-field class="marginRight10 fullWidth">
                                    <input type="text" placeholder="Anno impegno" [(ngModel)]="annoImpegno" matInput
                                        name="annoImpegno" [ngModelOptions]="{standalone: true}">
                                </mat-form-field>
                            </mat-grid-tile>
                            <mat-grid-tile [colspan]="2" [rowspan]="1">
                                <mat-form-field class="marginRight10 fullWidth">
                                    <input type="text" placeholder="N. impegno" [(ngModel)]="nImpegno" matInput
                                        name="nImpegno" [ngModelOptions]="{standalone: true}">
                                </mat-form-field>
                            </mat-grid-tile>
                        </mat-grid-list>
                        <mat-grid-list cols="8" rowHeight="60px">
                            <mat-grid-tile [colspan]="2" [rowspan]="1">
                                <mat-form-field class="marginRight10 fullWidth">
                                    <input type="text" placeholder="Anno provvedimento" [(ngModel)]="annoProvvedimento"
                                        matInput name="annoProvvedimento" [ngModelOptions]="{standalone: true}">
                                </mat-form-field>
                            </mat-grid-tile>
                            <mat-grid-tile [colspan]="2" [rowspan]="1">
                                <mat-form-field class="marginRight10 fullWidth">
                                    <input type="text" placeholder="N. provvedimento" [(ngModel)]="nProvvedimento"
                                        matInput name="nProvvedimento" [ngModelOptions]="{standalone: true}">
                                </mat-form-field>
                            </mat-grid-tile>
                            <mat-grid-tile [colspan]="4" [rowspan]="1">
                                <mat-form-field class="marginRight10 fullWidth">
                                    <mat-label>Selezionare Direzione provvedimento</mat-label>
                                    <mat-select [(ngModel)]="direzioneProvvedimentoSelected"
                                        name="direzioniProvvedimento" [ngModelOptions]="{standalone: true}">
                                        <mat-option></mat-option>
                                        <mat-option *ngFor="let direzioneProvvedimento of direzioniProvvedimento"
                                            [value]="direzioneProvvedimento">
                                            {{ direzioneProvvedimento.descEnte }}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </mat-grid-tile>
                        </mat-grid-list>
                        <mat-grid-list cols="8" rowHeight="60px">
                            <mat-grid-tile [colspan]="2" [rowspan]="1">
                                <mat-form-field class="marginRight10 fullWidth">
                                    <input type="text" placeholder="N. capitolo" [(ngModel)]="nCapitolo" matInput
                                        name="nCapitolo" [ngModelOptions]="{standalone: true}">
                                </mat-form-field>
                            </mat-grid-tile>
                        </mat-grid-list>
                        <mat-grid-list cols="8" rowHeight="60px">
                            <mat-grid-tile [colspan]="4" [rowspan]="1">
                                <mat-form-field class="marginRight10 fullWidth">
                                    <input type="text" placeholder="Ragione sociale beneficiario Impegno"
                                        [(ngModel)]="ragioneSocialeBeneficiarioImpegno" matInput
                                        name="ragioneSocialeBeneficiarioImpegno" [ngModelOptions]="{standalone: true}">
                                </mat-form-field>
                            </mat-grid-tile>
                        </mat-grid-list>
                        <div class="row">
                            <div matTooltip="Selezionare i campi obbligatori"
                                [matTooltipDisabled]="annoEsercizioSelected">
                                <button mat-raised-button class="button-style-2 margin0" type="submit"
                                    [disabled]="!annoEsercizioSelected">
                                    CERCA
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </mat-card-content>
        </mat-card>
    </div>
    <div [hidden]="!showResults">
        <mat-grid-list cols="8" rowHeight="50px">
            <mat-grid-tile [colspan]="4" [rowspan]="1"></mat-grid-tile>
            <mat-grid-tile [colspan]="4" [rowspan]="1">
                <div class="fullWidth textAlignRight paddingRight15">
                    <button class="button-style-1 marginLeft20" mat-button (click)="importaImpegno()">IMPORTA
                        IMPEGNO</button>
                    <button class="button-style-1 marginLeft20" mat-button (click)="annullaRicerca()">ANNULLA
                        RICERCA</button>
                </div>
            </mat-grid-tile>
        </mat-grid-list>
    </div>

    <div class="content" [hidden]="!showResults">
        <div [hidden]="!impegniTableEmpty">
            <mat-card class="mat-elevation-z4">
                <mat-card-content>
                    Non Ã¨ presente nessun impegno.
                </mat-card-content>
            </mat-card>
        </div>
        <div [hidden]="impegniTableEmpty">
            <mat-card class="mat-elevation-z4">
                <mat-card-content>
                    <h3>Impegni</h3>
                    <table mat-table [dataSource]="dataSource">

                        <ng-container matColumnDef="select">
                            <th mat-header-cell *matHeaderCellDef>
                                <mat-checkbox (change)="$event ? masterToggle() : null"
                                    [checked]="selection.hasValue() && isAllSelected()"
                                    [indeterminate]="selection.hasValue() && !isAllSelected()"
                                    [aria-label]="checkboxLabel()">
                                </mat-checkbox>
                            </th>
                            <td mat-cell *matCellDef="let row">
                                <mat-checkbox (click)="$event.stopPropagation()"
                                    (change)="$event ? changeSingleRow(row) : null"
                                    [checked]="selection.isSelected(row)" [aria-label]="checkboxLabel(row)">
                                </mat-checkbox>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="impegno">
                            <th mat-header-cell *matHeaderCellDef>Impegno (anno/numero) </th>
                            <td mat-cell *matCellDef="let element"> <a class="colorBlue clickableItem"
                                    (click)="dettaglioImpegno(element.idImpegno)">{{element.annoImpegno}}/{{element.numeroImpegno}}</a>
                            </td>
                        </ng-container>
                        <ng-container matColumnDef="impegnoReimp">
                            <th mat-header-cell *matHeaderCellDef> Impegno reimp. (anno/numero) </th>
                            <td mat-cell *matCellDef="let element"> <a class="colorBlue clickableItem"
                                    (click)="dettaglioImpegno(element.numeroImpegno)">
                                    {{element.annoPerente}}/{{element.numeroPerente}}</a> </td>
                        </ng-container>
                        <ng-container matColumnDef="annoEsercizio">
                            <th mat-header-cell *matHeaderCellDef> Anno esercizio </th>
                            <td mat-cell *matCellDef="let element"> {{element.annoEsercizio}} </td>
                        </ng-container>

                        <ng-container matColumnDef="capitolo">
                            <th mat-header-cell *matHeaderCellDef> Capitolo (tipo/fondo/num.) </th>
                            <td mat-cell *matCellDef="let element">
                                {{element.capitolo.tipoFondo.descTipoFondo}}/{{element.capitolo.numeroCapitolo}} </td>
                        </ng-container>

                        <ng-container matColumnDef="codFisc">
                            <th mat-header-cell *matHeaderCellDef> Codice fiscale </th>
                            <td mat-cell *matCellDef="let element"> {{element.codiceFiscale}} </td>
                        </ng-container>

                        <ng-container matColumnDef="ragSocCUP">
                            <th mat-header-cell *matHeaderCellDef> Ragione sociale - CUP </th>
                            <td mat-cell *matCellDef="let element"> {{element.ragsoc}} </td>
                        </ng-container>

                        <ng-container matColumnDef="provvedimento">
                            <th mat-header-cell *matHeaderCellDef> Provvedimento (anno/num./direz./tipo) </th>
                            <td mat-cell *matCellDef="let element">
                                {{element.provvedimento.annoProvvedimento}}/{{element.provvedimento.numeroProvvedimento}}/{{element.provvedimento.enteCompetenza.descEnte}}/{{element.provvedimento.tipoProvvedimento.descTipoProvvedimento}}
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                    </table>
                    <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
                </mat-card-content>
            </mat-card>
        </div>
    </div>
    <div [hidden]="!showResults">
        <div [hidden]="impegniTableEmpty">
            <mat-grid-list cols="8" rowHeight="50px">
                <mat-grid-tile [colspan]="8" [rowspan]="1">
                    <div class="fullWidth textAlignRight paddingRight15">
                        <button [class.customButton]="!showImpegniButtons" [class.button-style-3]="showImpegniButtons"
                            [disabled]='!showImpegniButtons' mat-stroked-button (click)="gestisciAss()" color="primary"
                            class="marginRight25">GESTISCI ASSOCIAZIONI</button>
                        <button [class.customButton]="!showImpegniButtons" [class.button-style-3]="showImpegniButtons"
                            [disabled]='!showImpegniButtons' mat-stroked-button (click)="gestisciAssBen()"
                            color="primary" class="marginRight25">GESTISCI ASSOCIAZIONI PER BENEFICIARIO</button>
                        <button [class.customButton]="!showImpegniButtons" [class.button-style-3]="showImpegniButtons"
                            [disabled]='!showImpegniButtons' mat-stroked-button (click)="nuovaAss()" color="primary"
                            class="marginRight25">NUOVA ASSOCIAZIONE</button>
                    </div>
                </mat-grid-tile>
            </mat-grid-list>
        </div>
    </div>
</div>