<mat-spinner-pbandi class="page" *ngIf="spinner"></mat-spinner-pbandi>
<div class="page" [ngClass]="{'displayNone': spinner}" id="scrollId">
  <div class="title">
    <div class="reportingContainerUp">
      <div>
        <h2>Gestione Anagrafica</h2>
      </div>
    </div>
  </div>
  <div class="content">
    <mat-card class="mat-elevation-z2" (click)="test()">
      <mat-card-content>
        <div class="header">
          <h3 class="search">Criteri di ricerca
            <button mat-icon-button (click)="criteriRicercaOpenClose()">
              <mat-icon class="arrow" *ngIf="criteriRicercaOpened">arrow_drop_up</mat-icon>
              <mat-icon class="arrow" *ngIf="!criteriRicercaOpened">arrow_drop_down</mat-icon>
            </button>
          </h3>
        </div>
        <div *ngIf="criteriRicercaOpened">
          <form #ricercaForm="ngForm" (submit)="cerca()">
            <div class="row">
              <mat-form-field class="col">
                <input type="text" placeholder="Codice Fiscale" (keyup)="onKeySearchCf($event)"
                  [(ngModel)]="codiceFiscale" matInput name="codiceFiscale" [matAutocomplete]="autoCf">
                <mat-autocomplete autoActiveFirstOption #autoCf="matAutocomplete">
                  <mat-option *ngFor="let option of options" [value]="option.codiceFiscale"
                    (click)="resetOptionsCf(option.codiceFiscale, option.idSoggetto, option.descrTipoSogg)">
                    {{option.codiceFiscale}}  Tipo Soggetto: {{option.descrTipoSogg}}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
              <mat-form-field class="col">
                <mat-label>NDG</mat-label>
                <input matInput type="text" [(ngModel)]="ndg" name="ndg"
                  (keyup)="onKeySearchIdSoggetto($event)" [matAutocomplete]="autoIdSoggetto">
                <mat-autocomplete autoActiveFirstOption #autoIdSoggetto="matAutocomplete">
                  <mat-option *ngFor="let option of options" [value]="option.idSoggetto"
                    (click)="resetOptionsIdSogg(option.idSoggetto,option.descrTipoSogg)">
                    {{option.ndg}}  Tipo Soggetto: {{option.descrTipoSogg}}
                  </mat-option>
                </mat-autocomplete>
                <button *ngIf="value" matSuffix mat-icon-button (click)="value=''">
                  <mat-icon>close</mat-icon>
                </button>
              </mat-form-field>
            </div>
            <div class="row">
              <mat-form-field class="col">
                <input type="text" placeholder="Partita IVA" (keyup)="onKeySearchPIva($event)" [(ngModel)]="partitaIva"
                  matInput name="partitaIva" [matAutocomplete]="autoPIva">
                <mat-autocomplete autoActiveFirstOption #autoPIva="matAutocomplete">
                  <mat-option *ngFor="let option of options" [value]="option.partitaIva"
                    (click)="resetOptionsPiva(option.partitaIva,option.idSoggetto, option.descrTipoSogg)">
                    {{option.partitaIva}}  Tipo Soggetto: {{option.descrTipoSogg}}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
              <mat-form-field class="col">
                <input type="text" placeholder="Ragione sociale" [(ngModel)]="denominazione" matInput
                  name="denominazione" [matAutocomplete]="autoDenominazione" (keyup)="onKeySearchDenominazione($event)">
                <mat-autocomplete autoActiveFirstOption #autoDenominazione="matAutocomplete">
                  <mat-option *ngFor="let option of options" [value]="option.denominazione"
                    (click)="resetOptionsDenominazione(option.denominazione, option.idSoggetto, option.descrTipoSogg)">
                    {{option.denominazione}}  Tipo Soggetto: {{option.descrTipoSogg}}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            </div>
            <div class="row">
              <mat-form-field class="col">
                <input type="text" placeholder="Cognome/Nome" [(ngModel)]="cognome" matInput name="cognome"
                  [matAutocomplete]="autoCognome" (keyup)="onKeySearchCognome($event)">
                <mat-autocomplete autoActiveFirstOption #autoCognome="matAutocomplete">
                  <mat-option *ngFor="let option of options" [value]="option.cognome"
                    (click)="resetCognome(option.cognome, option.idSoggetto, option.descrTipoSogg)">
                    {{option.cognome}}  Tipo Soggetto: {{option.descrTipoSogg}}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
              <!-- <mat-form-field class="col">
                <input type="text" placeholder="Nome" [(ngModel)]="nome" matInput name="nome"
                  [matAutocomplete]="autoNome" (keyup)="onKeySearchDenominazione($event)">
                <mat-autocomplete autoActiveFirstOption #autoNome="matAutocomplete">
                  <mat-option *ngFor="let option of options" [value]="option.nome"
                    (click)="resetNome(option.nome, option.idSoggetto, option.descrTipoSogg)">
                    {{option.nome}}  Tipo Soggetto: {{option.descrTipoSogg}}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field> -->
            </div>
            <div class="row">
              <mat-form-field class="col">
                <input type="text" placeholder="Numero ultima domanda" [(ngModel)]="numeroDomanda" matInput
                  name="numeroDomanda" [matAutocomplete]="autoDomanda" (keyup)="onKeySearchDomanda($event)">
                <mat-autocomplete autoActiveFirstOption #autoDomanda="matAutocomplete">
                  <mat-option *ngFor="let option of options" [value]="option.numeroDomanda"
                    (click)="resetOptionsIdDomanda(option.numeroDomanda, option.idSoggetto,option.descTipoSoggetto, option.idDomanda)">
                    {{option.numeroDomanda}}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
              <mat-form-field class="col">
                <input type="text" placeholder="Codice ultimo progetto" [(ngModel)]="codProgetto" matInput name="codProgetto"
                  [matAutocomplete]="autoProgetto" (keyup)="onKeySearchProgetto($event)">
                <mat-autocomplete autoActiveFirstOption #autoProgetto="matAutocomplete">
                  <mat-option *ngFor="let option of options" [value]="option.codProgetto"
                  (click)="resetOptionsIdProgetto(option.codProgetto, option.idSoggetto, option.idProgetto, option.descTipoSoggetto)">
                    {{option.codProgetto}}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            </div>
            <div class="row">
              <button mat-raised-button class="button-style-2 margin0" type="submit">
                CERCA
              </button>
              <button mat-raised-button class="button-style-1" style="margin-left: 50px;" (click)="azzeraCampi()"
             *ngIf="codProgetto || numeroDomanda || nome || cognome || denominazione || codiceFiscale || partitaIva">
                AZZERA
              </button>
            </div>
          </form>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
  <div class="content" [hidden]="!showTable">
    <mat-card class="mat-elevation-z4">
      <mat-card-content>
        <h3>Soggetti</h3>
        <p *ngIf="!dataSource || !dataSource.length">Nessun elemento da visualizzare.</p>
        <table mat-table [dataSource]="dataSource" [ngClass]="{'displayNone': !dataSource || !dataSource.length}">
          <ng-container matColumnDef="descTipoSogg">
            <th mat-header-cell *matHeaderCellDef> <b>Tipologia</b> </th>
            <td mat-cell *matCellDef="let row"> {{row.descTipoSogg}}</td>
          </ng-container>
          <ng-container matColumnDef="idSoggetto">
            <th mat-header-cell *matHeaderCellDef> <b>NDG</b> </th>
            <td mat-cell *matCellDef="let row">{{row.ndg}}</td>
          </ng-container>
          <ng-container matColumnDef="denominazione">
            <th mat-header-cell *matHeaderCellDef> <b>Denominazione</b> </th>
            <td mat-cell *matCellDef="let row">{{row.denominazione}}</td>
          </ng-container>
          <ng-container matColumnDef="cf">
            <th mat-header-cell *matHeaderCellDef> <b>Codice Fiscale</b> </th>
            <td mat-cell *matCellDef="let row">{{row.cf}}</td>
          </ng-container>
          <ng-container matColumnDef="pIva">
            <th mat-header-cell *matHeaderCellDef> <b>Partita IVA</b> </th>
            <td mat-cell *matCellDef="let row">{{row.pIva}}</td>
          </ng-container>
          <ng-container matColumnDef="blocco">
            <th mat-header-cell *matHeaderCellDef> <b>Blocco</b> </th>
            <td mat-cell *matCellDef="let row">{{row.flagBloccoAnag}}</td>
          </ng-container>
          <ng-container matColumnDef="azioni">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let row">
              <button mat-icon-button style="width: 30px;" matTooltip="Visualizza beneficiario"
                (click)="visualizzaBeneficiario(row)">
                <mat-icon>info</mat-icon>
              </button>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
        <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" [pageSize]="10" [showFirstLastButtons]="true"
          [ngClass]="{'displayNone': !dataSource || !dataSource.length}">
        </mat-paginator>
      </mat-card-content>
    </mat-card>
  </div>
  <div class="content" [hidden]="!emptyTable">
    <mat-card class="mat-elevation-z4">
      <mat-card-content>
        <h3>Soggetti</h3>
        Non ci sono elementi da visualizzare.
      </mat-card-content>
    </mat-card>
  </div>

</div>