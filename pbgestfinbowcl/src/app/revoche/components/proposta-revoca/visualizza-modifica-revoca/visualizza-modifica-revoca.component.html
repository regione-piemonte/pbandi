<mat-spinner-pbandi class="page" *ngIf="isLoading"></mat-spinner-pbandi>
<div class="page" [ngClass]="{'displayNone': isLoading}" id="scrollId">
  <div class="title">
    <div class="backContainer">
      <button (click)="goBack()" mat-button>
        <mat-icon class="blue-icon">keyboard_backspace</mat-icon>
        <span class="backText">Torna alla ricerca</span>
      </button>
    </div>
    <h2>Dettaglio proposta di revoca</h2>

    <div [hidden]="!error">
      <div  class="content width-100-perc margin-0 max-width-89-perc">
        <mat-card  class="mat-card mat-focus-indicator messageError"
          >
          <mat-card-content  class="mat-card-content messageWarningContent"
            >
            <p  id="ellipsisP" class="white-space-nowrap text-overflow-ellipsis overflow-hidden">
              {{messageError}}
            </p>
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <div [hidden]="!success">
      <div  class="content width-100-perc margin-0 max-width-89-perc">
        <mat-card  class="mat-card mat-focus-indicator messageSuccess"
          >
          <mat-card-content  class="mat-card-content messageWarningContent"
            >
            <p  id="ellipsisP" class="white-space-nowrap text-overflow-ellipsis overflow-hidden">
              Salvataggio terminato con successo!
            </p>
          </mat-card-content>
        </mat-card>
      </div>
    </div>

  </div>


  <div class="content">
    <mat-card class="mat-elevation-z4">
      <mat-card-content class="mat-card-content">
        <div>Beneficiario: <strong>{{informazioniBackend?.denominazioneBeneficiario}} -
            {{informazioniBackend?.codiceFiscaleSoggetto}}</strong></div>
        <div>Bando: <strong>{{informazioniBackend?.nomeBandoLinea}}</strong></div>
        <div>Codice Progetto: <strong>{{informazioniBackend?.codiceVisualizzato}} </strong></div>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="content">
    <mat-card class="mat-elevation-z4">
      <mat-card-content class="mat-card-content">
        <div>Numero proposta di revoca: <strong>{{informazioniBackend?.numeroRevoca}}</strong></div>
        <div>Causa proposta di revoca: <strong>{{informazioniBackend?.causaRevoca}}</strong></div>
        <div>Autorità controllante: <strong>{{informazioniBackend?.descCategAnagrafica == null ? "-" :
            informazioniBackend?.descCategAnagrafica}}</strong></div>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="content">
    <mat-card class="mat-elevation-z4">
      <mat-card-content class="mat-card-content">
        <div>Data proposta di revoca: <strong>{{informazioniBackend?.dtGestione | date:'dd/MM/yyyy'}}</strong></div>
        <div>Stato proposta di revoca: <strong>{{informazioniBackend?.descStatoRevoca}}</strong></div>
        <div>Data stato di proposta revoca: <strong>{{informazioniBackend?.dtStatoRevoca | date:'dd/MM/yyyy'}}</strong>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="content">
    <mat-card class="mat-elevation-z4">
      <mat-card-content class="mat-card-content">
        <table mat-table [dataSource]="dataSource" class="mat-elevation-z8" multiTemplateDataRows>

          <ng-container matColumnDef="a">
            <th mat-header-cell *matHeaderCellDef> Modalità di agevolazione </th>
            <td mat-cell *matCellDef="let element"> {{element.descModalitaAgevolazione == null ? " - " :
              element.descModalitaAgevolazione }} </td>
          </ng-container>


          <ng-container matColumnDef="ab">
            <th mat-header-cell *matHeaderCellDef> Importo amesso iniziale </th>
            <td mat-cell *matCellDef="let element"> {{element.importoAmmessoIniziale == null ? " - " :
              element.importoAmmessoIniziale | number: '1.2-2' : 'it'}} </td>
          </ng-container>


          <ng-container matColumnDef="b">
            <th mat-header-cell *matHeaderCellDef> Importo concesso </th>
            <td mat-cell *matCellDef="let element"> {{element.importoConcesso == null ? " - " :
              element.importoConcesso | number: '1.2-2' : 'it'}} </td>
          </ng-container>


          <ng-container matColumnDef="c">
            <th mat-header-cell *matHeaderCellDef> Importo già revocato </th>
            <td mat-cell *matCellDef="let element"> {{element.importoRevocato == null ? " - " :
              element.importoRevocato | number: '1.2-2' : 'it'}} </td>
          </ng-container>

          <ng-container matColumnDef="d">
            <th mat-header-cell *matHeaderCellDef> Importo erogato </th>
            <td mat-cell *matCellDef="let element"> {{element.importoErogato == null ? " - " :
              element.importoErogato| number: '1.2-2' : 'it'}} </td>
          </ng-container>


          <ng-container matColumnDef="e">
            <th mat-header-cell *matHeaderCellDef> Importo recuperato </th>
            <td mat-cell *matCellDef="let element"> {{element.importoRecuperato == null ? " - " :
              element.importoRecuperato| number: '1.2-2' : 'it'}} </td>
          </ng-container>

          <ng-container matColumnDef="f">
            <th mat-header-cell *matHeaderCellDef> Importo rimborsato </th>
            <td mat-cell *matCellDef="let element"> {{element?.importoRimborsato == null ? " - " :
              element.importoRimborsato| number: '1.2-2' : 'it'}} </td>
          </ng-container>


          <ng-container matColumnDef="g">
            <th mat-header-cell *matHeaderCellDef> Importo concesso al netto del revocato </th>
            <td mat-cell *matCellDef="let element"> {{element.importoConcessoAlNettoRevocato == null ? " - " :
              element.importoConcessoAlNettoRevocato| number: '1.2-2' : 'it'}} </td>
          </ng-container>

          <ng-container matColumnDef="h">
            <th mat-header-cell *matHeaderCellDef> Importo erogato al netto del recuperato e rimborsato </th>
            <td mat-cell *matCellDef="let element"> {{element.importoErogatoAlNettoRecuperatoRimborsato ==
              null ? " - " : element.importoErogatoAlNettoRecuperatoRimborsato| number: '1.2-2' : 'it'}} </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>


      </mat-card-content>
    </mat-card>
  </div>


  <div class="content">
    <mat-card class="mat-elevation-z4">
      <mat-card-content class="mat-card-content">
        <mat-form-field appearance="standard" class="fullWidth">
          <mat-label>Note:</mat-label>
          <textarea matInput type="text" matInput
            [(ngModel)]="noteBackend" name="noteBackend">{{noteBackend}}</textarea>
        </mat-form-field>
        <mat-error *ngIf="erroreNota">è necessario inserire una nota
        </mat-error>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="content">
    <mat-card class="mat-elevation-z4">
      <mat-card-content class="mat-card-content">
        Istruttore che ha avviato l'istruttoria: <strong>{{informazioniBackend?.nomeIstruttore}}
          {{informazioniBackend?.cognomeIstruttore}}</strong>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="content">
    <mat-card class="mat-elevation-z4">
      <mat-card-content class="mat-card-content">
        <div class="display-flex-content-right">
          <div class="ml-5">
            <button mat-raised-button (click)="salva(noteBackend,informazioniBackend)" class="button-style-2">SALVA</button>
          </div>
          <div [hidden]="informazioniBackend?.descStatoRevoca != 'Nuovo'" class="ml-5">
            <button mat-raised-button (click)="archivia(informazioniBackend)" class="button-style-1">ARCHIVIA</button>
          </div>
          <div [hidden]="informazioniBackend?.descStatoRevoca != 'Nuovo'" class="ml-5">
            <button mat-raised-button (click)="creaBozzaProcedimento(informazioniBackend)" class="button-style-2">CREA BOZZA PROCEDIMENTO DI REVOCA</button>
          </div>
          <div [hidden]="informazioniBackend?.descStatoRevoca != 'Nuovo'" class="ml-5">
            <button mat-raised-button (click)="creaBozzaProvvedimento(informazioniBackend)" class="button-style-2">CREA BOZZA PROVVEDIMENTO DI REVOCA</button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
