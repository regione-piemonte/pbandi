/*******************************************************************************
* Copyright Regione Piemonte - 2024
* SPDX-License-Identifier: EUPL-1.2
******************************************************************************/

---------------------------------------------------------------------------------
 -- PBANDI_W_ATTIVITA_PREGRESSE
 alter table PBANDI_W_ATTIVITA_PREGRESSE add RIFERIMENTO varchar2(255);

--------------------------------------------------------------------------------

--*****************************************************--
----         F I N P I E M O N T E                -------
--*****************************************************--


-- PBANDI_D_TIPO_FILE_MIGR_FINPIS
--
CREATE TABLE PBANDI_D_TIPO_FILE_MIGR_FINPIS 
(
ID_TIPO_FILE  INTEGER,
DESC_BREVE_FILE  VARCHAR2(100)
);

-- pk
ALTER TABLE PBANDI_D_TIPO_FILE_MIGR_FINPIS   ADD 
(CONSTRAINT PK_PBANDI_D_TIPO_FILE_M_FINPIS PRIMARY KEY (ID_TIPO_FILE)
USING INDEX TABLESPACE PBANDI_IDX);

-- PBANDI_T_MIGRAZIONE_FINPIS
CREATE TABLE PBANDI_T_MIGRAZIONE_FINPIS
( 
ID_CARICAMENTO  INTEGER,
NOME_FILE  VARCHAR2(200),
FILE_XML  XMLTYPE,
ID_TIPO_FILE  INTEGER,
DATA_CARICAMENTO  DATE,
DATA_MIGRAZIONE DATE
);

-- pk
ALTER TABLE PBANDI_T_MIGRAZIONE_FINPIS   ADD 
(CONSTRAINT PK_PBANDI_T_MIGRAZIONE_FINPIS   PRIMARY KEY (ID_CARICAMENTO)
USING INDEX TABLESPACE PBANDI_IDX);

-- fk
ALTER TABLE PBANDI_T_MIGRAZIONE_FINPIS ADD (
  CONSTRAINT FK_PBANDI_D_TIP_FIL_MIG_FIN_01
  FOREIGN KEY (ID_TIPO_FILE) 
  REFERENCES PBANDI_D_TIPO_FILE_MIGR_FINPIS (ID_TIPO_FILE)
 );

--idx 
CREATE INDEX IE1_PBANDI_T_MIGRAZIONE_FINPIS ON PBANDI_T_MIGRAZIONE_FINPIS (ID_TIPO_FILE) TABLESPACE PBANDI_IDX;

GRANT SELECT,INSERT,UPDATE,DELETE,REFERENCES ON PBANDI_T_MIGRAZIONE_FINPIS TO PBANDI_RW;

-- SEQ_PBANDI_t_migrazione_finpis
CREATE SEQUENCE SEQ_PBANDI_t_migrazione_finpis
  START WITH 1
  MAXVALUE 999999999999999999999999999
  MINVALUE 1
  NOCYCLE
  NOCACHE
  NOORDER;

create sequence SEQ_PBANDI_R_BAN_MOD_AG_ES_BAN
minvalue 1
maxvalue 999999999999999999999999999
start with 59738
increment by 1
nocache;


/* ---------------------------------------------------------------------- */
/* Sequences                                                              */
/* ---------------------------------------------------------------------- */


--PBANDI_T_SOGG_STATO_AZIENDA
CREATE SEQUENCE SEQ_PBANDI_T_SOGG_STATO_AZI
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;
	
--PBANDI_T_SOGGETTO_RATING
CREATE SEQUENCE SEQ_PBANDI_T_SOGG_RATING
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;

--PBANDI_R_SOGG_PROG_STA_CRED_FP
CREATE SEQUENCE SEQ_PBANDI_R_SOG_PROG_STA_CRED
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;

--PBANDI_T_SOGGETTO_CLA_RISCHIO
CREATE SEQUENCE SEQ_PBANDI_T_SOGG_CLA_RISCHIO
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;
	
--PBANDI_R_SOGG_PROG_BANCA_BEN	
CREATE SEQUENCE SEQ_PBANDI_R_SOGG_PROG_BAN_BEN
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;

	
-- Monitoraggio
--PBANDI_T_REVOCA_BANCARIA
CREATE SEQUENCE SEQ_PBANDI_T_REVOCA_BANCARIA
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;
	
--PBANDI_T_AZIONE_RECUP_BANCA
CREATE SEQUENCE SEQ_PBANDI_T_AZION_RECUP_BANCA
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;
	
--PBANDI_T_LIBERAZ_GARANTE
CREATE SEQUENCE SEQ_PBANDI_T_LIBERAZ_GARANTE
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;
	
--PBANDI_T_ABBATTIM_GARANZIE
CREATE SEQUENCE SEQ_PBANDI_T_ABBATTIM_GARANZIE
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;
	
--PBANDI_T_ESCUSS_CONFIDI
CREATE SEQUENCE SEQ_PBANDI_T_ESCUSS_CONFIDI
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;
	
--PBANDI_T_PIANO_RIENTRO  
CREATE SEQUENCE SEQ_PBANDI_T_PIANO_RIENTRO
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;

--PBANDI_T_SALDO_STRALCIO
CREATE SEQUENCE SEQ_PBANDI_T_SALDO_STRALCIO
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;
	
--PBANDI_T_PASSAGGIO_PERDITA 
CREATE SEQUENCE SEQ_PBANDI_T_PASSAGGIO_PERDITA
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;
	
--PBANDI_T_LIBERAZ_BANCA
CREATE SEQUENCE SEQ_PBANDI_T_LIBERAZ_BANCA
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;
	
--PBANDI_T_MESSA_IN_MORA
CREATE SEQUENCE SEQ_PBANDI_T_MESSA_IN_MORA
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;
	
--PBANDI_T_ANNOTAZ_GENERALI
CREATE SEQUENCE SEQ_PBANDI_T_ANNOTAZ_GENERALI
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;

	
--PBANDI_T_ISCRIZIONE_RUOLO
CREATE SEQUENCE SEQ_PBANDI_T_ISCRIZIONE_RUOLO
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;
	
	
--PBANDI_T_SEGNALAZ_CORTE_CONTI  
CREATE SEQUENCE SEQ_PBANDI_T_SEGN_CORTE_CONTI
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;

--PBANDI_T_CESSIONE_QUOTA_FP
CREATE SEQUENCE SEQ_PBANDI_T_CESSIONE_QUOTA_FP
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;

--PBANDI_T_TRANSAZIONI_BANCA	
	CREATE SEQUENCE SEQ_PBANDI_T_TRANSAZIONI_BANCA
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;

--PBANDI_T_VARIAZ_ST_CREDITO
	CREATE SEQUENCE SEQ_PBANDI_T_VARIAZ_ST_CREDITO
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;	
	
--PBANDI_T_PROCEDURE_CONCORS
	CREATE SEQUENCE SEQ_PBANDI_T_PROCEDURE_CONCORS
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;	
	
--PBANDI_T_CREDITORIE	
	CREATE SEQUENCE SEQ_PBANDI_T_CREDITORIE
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;
	
--PBANDI_T_ALLUNG_PIANO_AMMORT
	CREATE SEQUENCE SEQ_PBANDI_T_ALLU_PIANO_AMMORT
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;
	
--PBANDI_T_ENTE_GIUR_SEZI
CREATE SEQUENCE SEQ_PBANDI_T_ENTE_GIUR_SEZI
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    NOCACHE
    nocycle
    noorder;

--PBANDI_T_SOGG_DOMANDA_BLOCCO	
CREATE SEQUENCE SEQ_PBANDI_T_SOGG_DOM_BLOCCO
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    NOCACHE
    nocycle
    noorder;

--PBANDI_T_SOGGETTO_DURC
CREATE SEQUENCE SEQ_PBANDI_T_SOGGETTO_DURC
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    NOCACHE
    nocycle
    noorder;

--PBANDI_T_SOGGETTO_ANTIMAFIA
CREATE SEQUENCE SEQ_PBANDI_T_SOGG_ANTIMAFIA
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    NOCACHE
    nocycle
    noorder;

--PBANDI_T_SOGGETTO_DSAN	
CREATE SEQUENCE SEQ_PBANDI_T_SOGGETTO_DSAN
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    NOCACHE
    nocycle
    noorder;

--PBANDI_T_RICHIESTA
CREATE SEQUENCE SEQ_PBANDI_T_RICHIESTA
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    NOCACHE
    nocycle
    noorder;

--PBANDI_T_TRACCIATURA_RICH	
CREATE SEQUENCE SEQ_PBANDI_T_TRACC_RICHIESTA
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    NOCACHE
    nocycle
    noorder;
	
--PBANDI_T_CALC_DIM_IMPRESA
CREATE SEQUENCE SEQ_PBANDI_T_CALC_DIM_IMPRESA
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    NOCACHE
    nocycle
    noorder;

--PBANDI_T_MON_SERV_AMMVO_CONTAB
CREATE SEQUENCE SEQ_PBANDI_T_MON_SERV_AMM_CONT
  START WITH 1
  INCREMENT BY 1
  NOMINVALUE
  NOMAXVALUE
  NOCYCLE
  NOCACHE
  NOORDER;
  
--PBANDI_T_SOGG_AMMVO_CONTAB
CREATE SEQUENCE SEQ_PBANDI_T_SOGG_AMMVO_CONTAB
  START WITH 1
  INCREMENT BY 1
  NOMINVALUE
  NOMAXVALUE
  NOCYCLE
  NOCACHE
  NOORDER;

--PBANDI_T_CAMPIONAMENTO_FINP
CREATE SEQUENCE SEQ_PBANDI_T_CAMPIONAMENT_FINP
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;

--PBANDI_T_CONTROLLO_LOCO
CREATE SEQUENCE SEQ_PBANDI_T_CONTROLLO_LOCO
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;

--PBANDI_T_CONTROLLO_LOCO_ALTRI
CREATE SEQUENCE SEQ_PBANDI_T_CONTR_LOCO_ALTRI
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;

--PBANDI_T_RICHIESTA_INTEGRAZ
CREATE SEQUENCE SEQ_PBANDI_T_RICH_INTEGRAZ
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;	

--PBANDI_T_PROROGA
CREATE SEQUENCE SEQ_PBANDI_T_PROROGA
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;

--PBANDI_T_PROPOSTA_EROGAZIONE
CREATE SEQUENCE SEQ_PBANDI_T_PROP_EROGAZIONE
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    NOCACHE
    nocycle
    noorder;


--PBANDI_T_DISTINTA
CREATE SEQUENCE SEQ_PBANDI_T_DISTINTA
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    NOCACHE
    nocycle
    noorder;	
	
--PBANDI_T_DISTINTA_DETT
CREATE SEQUENCE SEQ_PBANDI_T_DISTINTA_DETT
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    NOCACHE
    nocycle
    noorder;	

--PBANDI_T_PROP_EROG_CTRL_RNA	
CREATE SEQUENCE SEQ_PBANDI_T_PROP_ER_CTRL_RNA
  START WITH 1
  INCREMENT BY 1
  NOMINVALUE
  NOMAXVALUE
  NOCYCLE
  NOCACHE
  NOORDER;

CREATE SEQUENCE SEQ_PBANDI_T_ESCUSSIONE
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    nocycle
    noorder;

--PBANDI_T_WORK_FLOW
CREATE SEQUENCE SEQ_PBANDI_T_WORK_FLOW
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;

--PBANDI_T_DETT_WORK_FLOW
CREATE SEQUENCE SEQ_PBANDI_T_DETT_WORK_FLOW
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;

--PBANDI_T_TEMPLATE_ITER
CREATE SEQUENCE SEQ_PBANDI_T_TEMPLATE_ITER
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;
	
--PBANDI_T_WORK_FLOW_ENTITA	
CREATE SEQUENCE SEQ_PBANDI_T_WORK_FLOW_ENTITA
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;	

--PBANDI_R_BANDO_MOD_AG_ESTR_BAN
CREATE SEQUENCE SEQ_PBANDI_R_BANDI_MOD_AG_BANC
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;

--PBANDI_T_NOTE
CREATE SEQUENCE SEQ_PBANDI_T_NOTE
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;

--PBANDI_T_DELIBERA_PROGETTI
CREATE SEQUENCE SEQ_PBANDI_T_DELIBERA_PROGETTI
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;

--PBANDI_T_AMMORTAMENTO_PROGETTI	
CREATE SEQUENCE SEQ_PBANDI_T_AMMORTAM_PROGETTI
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;

--NUMERO_DOMANDA MIGRAZIONE FINPIS	
CREATE SEQUENCE SEQ_MFINPIS_NUM_DOMANDA
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;	

--PBANDI_T_RNA_PROGETTO	
CREATE SEQUENCE SEQ_PBANDI_T_RNA_PROGETTO
  START WITH 1
  INCREMENT BY 1
  NOMINVALUE
  NOMAXVALUE
  NOCYCLE
  NOCACHE
  NOORDER;

--SEQ_PBANDI_T_RNA_AGEVOLAZIONE	
CREATE SEQUENCE SEQ_PBANDI_T_RNA_AGEVOLAZIONE
  START WITH 1
  INCREMENT BY 1
  NOMINVALUE
  NOMAXVALUE
  NOCYCLE
  NOCACHE
  NOORDER;

--SEQ_PBANDI_T_RNA_COSTO_GEST	
CREATE SEQUENCE SEQ_PBANDI_T_RNA_COSTO_GEST
  START WITH 1
  INCREMENT BY 1
  NOMINVALUE
  NOMAXVALUE
  NOCYCLE
  NOCACHE
  NOORDER;

	
	--PBANDI_T_ACTIVEINFO_METADATA
CREATE SEQUENCE SEQ_PBANDI_T_ACTIVEINFO_METADA
  START WITH 500000
  INCREMENT BY 1
  NOMINVALUE
  NOMAXVALUE
  NOCYCLE
  NOCACHE
  NOORDER;

--PBANDI_L_LOG_FILE_AFAI
CREATE SEQUENCE SEQ_PBANDI_L_LOG_FILE_AFAI
  START WITH 1
  INCREMENT BY 1
  NOMINVALUE
  NOMAXVALUE
  NOCYCLE
  NOCACHE
  NOORDER;

--PBANDI_T_GESTIONE_REVOCA
CREATE SEQUENCE SEQ_PBANDI_T_GESTIONE_REVOCA
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    NOCACHE
    nocycle
    noorder;

--PBANDI_T_GESTIONE_REVOCA PER NUMERO_REVOCA
CREATE SEQUENCE SEQ_PBANDI_T_GEST_REVOC_NUMERO
    START WITH 100000
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    NOCACHE
    nocycle
    noorder;


--PBANDI_T_CONTRODEDUZ
CREATE SEQUENCE SEQ_PBANDI_T_CONTRODEDUZ
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    NOCACHE
    nocycle
    noorder;

--PBANDI_T_CONTESTAZ
CREATE SEQUENCE SEQ_PBANDI_T_CONTESTAZ
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    NOCACHE
    nocycle
    noorder;

--PBANDI_T_MONIT_TEMPI
CREATE SEQUENCE SEQ_PBANDI_T_MONIT_TEMPI
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;

--PBANDI_R_PARAM_MONIT_BANDO_LIN
CREATE SEQUENCE SEQ_PBANDI_R_PAR_MONIT_BAN_LIN
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
	NOCACHE
    nocycle
    noorder;

--PBANDI_W_RNA_CARICAMENTO_XML
CREATE SEQUENCE SEQ_PBANDI_W_RNA_CARICAMEN_XML
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    NOCACHE
    nocycle
    noorder;

--PBANDI_W_RNAWS_INVIO_ELAB
CREATE SEQUENCE SEQ_PBANDI_W_RNAWS_INVIO_ELAB
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    NOCACHE
    nocycle
    noorder;

--PBANDI_W_RNA_CARIC_CONF_ESITO
CREATE SEQUENCE SEQ_PBANDI_W_RNA_CARI_CONF_ESI
    START WITH 1
    INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    NOCACHE
    nocycle
    noorder;

 CREATE SEQUENCE SEQ_PBANDI_T_SERVICER
  START WITH 1
   INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    NOCACHE
    nocycle
    noorder;

 CREATE SEQUENCE SEQ_PBANDI_D_DEST_INTERV_SOST
  START WITH 1
   INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    NOCACHE
    nocycle
    noorder;

 CREATE SEQUENCE SEQ_pbandi_t_riassicurazioni
  START WITH 1
   INCREMENT BY 1
    NOMINVALUE
    NOMAXVALUE
    NOCACHE
    nocycle
    noorder;

--PROGRESSIVO CODICE FISCALE FITTIZIO
CREATE SEQUENCE SEQ_PBANDI_CODFISC_FITTIZIO
  START WITH 1
  INCREMENT BY 1
  NOMINVALUE
  NOMAXVALUE
  NOCYCLE
  NOCACHE
  NOORDER;
  
CREATE SEQUENCE SEQ_PBANDI_T_RELAZIONE_TECNICA
  START WITH 1
  INCREMENT BY 1
  NOMINVALUE
  NOMAXVALUE
  NOCYCLE
  NOCACHE
  NOORDER;

CREATE SEQUENCE PBANDI.SEQ_PBANDI_T_RNA_PROGETTO_MAN
  START WITH 1
  INCREMENT BY 1
  NOMINVALUE
  NOMAXVALUE
  NOCYCLE
  NOCACHE
  NOORDER;

--PBANDI_T_MON_SERV_DOQUI
CREATE SEQUENCE SEQ_PBANDI_T_MON_SERV_DOQUI
  START WITH 1
  INCREMENT BY 1
  NOMINVALUE
  NOMAXVALUE
  NOCYCLE
  NOCACHE
  NOORDER;

--PBANDI_T_MON_SERV_FINISTR
CREATE SEQUENCE SEQ_PBANDI_T_MON_SERV_FINISTR
  START WITH 1
  INCREMENT BY 1
  NOMINVALUE
  NOMAXVALUE
  NOCYCLE
  NOCACHE
  NOORDER;


/* ---------------------------------------------------------------------- */
/* Tables                                                                 */
/* ---------------------------------------------------------------------- */


/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_STATO_AZIENDA"                                     */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_STATO_AZIENDA (
    ID_STATO_AZIENDA NUMBER(3) NOT NULL,
    DESC_BREVE_STATO_AZIENDA VARCHAR2(20) NOT NULL,
    DESC_STATO_AZIENDA VARCHAR2(255) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_STATO_AZIENDA PRIMARY KEY (ID_STATO_AZIENDA) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_SOGG_STATO_AZIENDA"                                */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_SOGG_STATO_AZIENDA (
    ID_SOGGETTO_STATO_AZIENDA NUMBER(8) NOT NULL,
    ID_SOGGETTO NUMBER(8) NOT NULL,
    ID_STATO_AZIENDA NUMBER(3) NOT NULL,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_T_SOGG_STATO_AZIENDA PRIMARY KEY (ID_SOGGETTO_STATO_AZIENDA) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_T_SOG_STATO_AZIENDA ON PBANDI_T_SOGG_STATO_AZIENDA (ID_SOGGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE2_PBANDI_T_SOG_STATO_AZIENDA ON PBANDI_T_SOGG_STATO_AZIENDA (ID_STATO_AZIENDA) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_STATO_CREDITO_FP"                                  */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_STATO_CREDITO_FP (
    ID_STATO_CREDITO_FP NUMBER(3) NOT NULL,
    DESC_BREVE_STATO_CREDITO_FP VARCHAR2(20) NOT NULL,
    DESC_STATO_CREDITO_FP VARCHAR2(255) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_STATO_CREDITO_FP PRIMARY KEY (ID_STATO_CREDITO_FP) USING INDEX TABLESPACE PBANDI_IDX
);

COMMENT ON TABLE PBANDI_D_STATO_CREDITO_FP IS 'Tabella stati credito Finpiemonte';

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_R_SOGG_PROG_STA_CRED_FP"                             */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_R_SOGG_PROG_STA_CRED_FP (
    ID_SOGG_PROG_STATO_CREDITO_FP NUMBER(8) NOT NULL,
    PROGR_SOGGETTO_PROGETTO NUMBER(8) NOT NULL,
    ID_STATO_CREDITO_FP NUMBER(3) NOT NULL,
    ID_MODALITA_AGEVOLAZIONE NUMBER(3) NOT NULL,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    DT_INIZIO_VALIDITA             DATE           NOT NULL,
    DT_FINE_VALIDITA               DATE,
    CONSTRAINT PK_PBANDI_R_SOGG_PROG_STA_CRED PRIMARY KEY (ID_SOGG_PROG_STATO_CREDITO_FP) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_R_SOG_PROG_STA_CRED ON PBANDI_R_SOGG_PROG_STA_CRED_FP (PROGR_SOGGETTO_PROGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE2_PBANDI_R_SOG_PROG_STA_CRED ON PBANDI_R_SOGG_PROG_STA_CRED_FP (ID_STATO_CREDITO_FP) TABLESPACE PBANDI_IDX;
CREATE INDEX IE3_PBANDI_R_SOG_PROG_STA_CRED ON PBANDI_R_SOGG_PROG_STA_CRED_FP (ID_MODALITA_AGEVOLAZIONE) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_RATING"                                            */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_RATING (
    ID_RATING NUMBER(3) NOT NULL,
    CODICE_RATING VARCHAR2(10) NOT NULL,
    DESC_BREVE_RATING VARCHAR2(20) NOT NULL,
    DESC_RATING VARCHAR2(255) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_PROVIDER NUMBER(3) NOT NULL,
    CONSTRAINT PK_PBANDI_D_RATING PRIMARY KEY (ID_RATING) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_PBANDI_D_RATING ON PBANDI_D_RATING (ID_PROVIDER);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_SOGGETTO_RATING"                                   */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_SOGGETTO_RATING (
    ID_SOGGETTO_RATING NUMBER(8) NOT NULL,
    ID_SOGGETTO NUMBER(8) NOT NULL,
    ID_RATING NUMBER(3) NOT NULL,
    DT_CLASSIFICAZIONE DATE NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_SOGGETTO_RATING PRIMARY KEY (ID_SOGGETTO_RATING) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_T_SOGGETTO_RATING ON PBANDI_T_SOGGETTO_RATING (ID_SOGGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE2_PBANDI_T_SOGGETTO_RATING ON PBANDI_T_SOGGETTO_RATING (ID_RATING) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_CLASSE_RISCHIO"                                    */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_CLASSE_RISCHIO (
    ID_CLASSE_RISCHIO NUMBER(3) NOT NULL,
    DESC_BREVE_CLASSE_RISCHIO VARCHAR2(20) NOT NULL,
    DESC_CLASSE_RISCHIO VARCHAR2(255) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_CLASSE_RISCHIO PRIMARY KEY (ID_CLASSE_RISCHIO) USING INDEX TABLESPACE PBANDI_IDX
);

COMMENT ON TABLE PBANDI_D_CLASSE_RISCHIO IS 'Tabella stati credito Finpiemonte';


/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_PROVIDER"                                          */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_PROVIDER (
    ID_PROVIDER NUMBER(3) NOT NULL,
    DESC_PROVIDER VARCHAR2(255) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_PROVIDER PRIMARY KEY (ID_PROVIDER) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_R_SOGG_PROG_BANCA_BEN"                               */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_R_SOGG_PROG_BANCA_BEN (
    ID_SOGG_PROG_BANCA_BEN NUMBER(8) NOT NULL,
    PROGR_SOGGETTO_PROGETTO NUMBER(8) NOT NULL,
    ID_BANCA NUMBER(6) NOT NULL,
    ID_ATTIVITA_BANCA_BEN NUMBER(3),
    DENOM_SOGGETTO_TERZO VARCHAR2(400),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_R_SOGG_PROG_BAN_BEN PRIMARY KEY (ID_SOGG_PROG_BANCA_BEN) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_R_SOGG_PROG_BAN_BEN ON PBANDI_R_SOGG_PROG_BANCA_BEN (PROGR_SOGGETTO_PROGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE2_PBANDI_R_SOGG_PROG_BAN_BEN ON PBANDI_R_SOGG_PROG_BANCA_BEN (ID_BANCA) TABLESPACE PBANDI_IDX;

CREATE INDEX IE3_PBANDI_R_SOGG_PROG_BAN_BEN ON PBANDI_R_SOGG_PROG_BANCA_BEN (ID_ATTIVITA_BANCA_BEN) TABLESPACE PBANDI_IDX;


/* ---------------------------------------------------------------------- */
/* Monitoraggio															  */
/* ---------------------------------------------------------------------- */

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_TIPO_MONIT_CRED"                                   */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_TIPO_MONIT_CRED (
    ID_TIPO_MONIT_CRED NUMBER(3) NOT NULL,
    DESC_BREVE_TIPO_MONIT_CRED VARCHAR2(40) NOT NULL,
    DESC_TIPO_MONIT_CRED VARCHAR2(255) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_TIPO_MONIT_CRED PRIMARY KEY (ID_TIPO_MONIT_CRED) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_ATTIVITA_MONIT_CRED"                               */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_ATTIVITA_MONIT_CRED (
    ID_ATTIVITA_MONIT_CRED NUMBER(3) NOT NULL,
    ID_TIPO_MONIT_CRED NUMBER(3) NOT NULL,
    DESC_BREVE_ATT_MONIT_CRED VARCHAR2(40) NOT NULL,
    DESC_ATT_MONIT_CRED VARCHAR2(255) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_ATTIV_MONIT_CRED PRIMARY KEY (ID_ATTIVITA_MONIT_CRED) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_D_ATTIV_MONIT_CRED_1 ON PBANDI_D_ATTIVITA_MONIT_CRED (ID_TIPO_MONIT_CRED) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_REVOCA_BANCARIA"                                   */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_REVOCA_BANCARIA (
    ID_REVOCA_BANCARIA NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8) NOT NULL,
	ID_MODALITA_AGEVOLAZIONE  NUMBER(3) NOT NULL,
    DT_RICEZIONE_COMUNICAZ DATE,
    DT_REVOCA DATE,
    IMP_DEBITO_RESIDUO_BANCA NUMBER(13,2),
    IMP_DEBITO_RESIDUO_FP NUMBER(13,2),
    PERC_COFINANZ_FP NUMBER(5,2),
    NUM_PROTOCOLLO VARCHAR2(30),
    NOTE VARCHAR2(4000),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_REVOCA_BANCARIA PRIMARY KEY (ID_REVOCA_BANCARIA) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_T_REVOCA_BANCARIA_1 ON PBANDI_T_REVOCA_BANCARIA (ID_PROGETTO) TABLESPACE PBANDI_IDX;
CREATE INDEX IE2_PBANDI_T_REVOCA_BANCARIA_1 ON PBANDI_T_REVOCA_BANCARIA (ID_MODALITA_AGEVOLAZIONE) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_AZIONE_RECUP_BANCA"                                */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_AZIONE_RECUP_BANCA (
    ID_AZIONE_RECUPERO_BANCA NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8) NOT NULL,
	ID_MODALITA_AGEVOLAZIONE  NUMBER(3) NOT NULL,
    ID_ATTIVITA_AZIONE NUMBER(3) NOT NULL,
    DT_AZIONE DATE,
    NUM_PROTOCOLLO VARCHAR2(30),
    NOTE VARCHAR2(4000),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_AZIONE_RECUP_BANCA PRIMARY KEY (ID_AZIONE_RECUPERO_BANCA) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_T_AZIO_RECUP_BANCA ON PBANDI_T_AZIONE_RECUP_BANCA (ID_PROGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE2_PBANDI_T_AZIO_RECUP_BANCA ON PBANDI_T_AZIONE_RECUP_BANCA (ID_ATTIVITA_AZIONE) TABLESPACE PBANDI_IDX;
CREATE INDEX IE3_PBANDI_T_AZIO_RECUP_BANCA ON PBANDI_T_AZIONE_RECUP_BANCA (ID_MODALITA_AGEVOLAZIONE) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_LIBERAZ_GARANTE"                                   */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_LIBERAZ_GARANTE (
    ID_LIBERAZ_GARANTE NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8)  NOT NULL,
	ID_MODALITA_AGEVOLAZIONE  NUMBER(3) NOT NULL,
    DT_LIBERAZ_GARANTE DATE,
    IMP_LIBERAZIONE NUMBER(13,2),
    DENOM_GARANTE_LIBERATO VARCHAR(400),
    NOTE VARCHAR2(4000),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_LIBERAZ_GARANTE PRIMARY KEY (ID_LIBERAZ_GARANTE) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_T_LIBERAZ_GARANTE ON PBANDI_T_LIBERAZ_GARANTE (ID_PROGETTO) TABLESPACE PBANDI_IDX;
CREATE INDEX IE2_PBANDI_T_LIBERAZ_GARANTE ON PBANDI_T_LIBERAZ_GARANTE (ID_MODALITA_AGEVOLAZIONE) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_ABBATTIM_GARANZIE"                                 */
/* ---------------------------------------------------------------------- */


CREATE TABLE PBANDI_T_ABBATTIM_GARANZIE (
    ID_ABBATTIM_GARANZIE NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8) NOT NULL,
	ID_MODALITA_AGEVOLAZIONE  NUMBER(3) NOT NULL,
    ID_ATTIVITA_GARANZIE NUMBER(3) NOT NULL,
	DT_ABBATTIM_GARANZIE DATE NOT NULL,
    IMP_INIZIALE NUMBER(13,2),
    IMP_LIBERATO NUMBER(13,2),
    IMP_NUOVO NUMBER(13,2),
    NOTE VARCHAR2(4000),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_ABBATTIM_GARANZIE PRIMARY KEY (ID_ABBATTIM_GARANZIE) USING INDEX TABLESPACE PBANDI_IDX
);


CREATE INDEX IE1_PBANDI_T_ABBATTI_GARANZIE ON PBANDI_T_ABBATTIM_GARANZIE (ID_PROGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE2_PBANDI_T_ABBATTI_GARANZIE ON PBANDI_T_ABBATTIM_GARANZIE (ID_ATTIVITA_GARANZIE) TABLESPACE PBANDI_IDX;
CREATE INDEX IE3_PBANDI_T_ABBATTI_GARANZIE ON PBANDI_T_ABBATTIM_GARANZIE (ID_MODALITA_AGEVOLAZIONE) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_ESCUSS_CONFIDI"                                    */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_ESCUSS_CONFIDI (
    ID_ESCUSS_CONFIDI NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8) NOT NULL,
	ID_MODALITA_AGEVOLAZIONE  NUMBER(3) NOT NULL,
    ID_ATTIVITA_GARANZIA_CONFIDI NUMBER(3),
    DENOM_CONFIDI VARCHAR(400),
    DT_ESCUSS_CONFIDI DATE,
    DT_PAGAM_CONFIDI DATE,
    PERC_GARANZIA NUMBER(5,2),
    NOTE VARCHAR2(4000),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_ESCUSS_CONFIDI PRIMARY KEY (ID_ESCUSS_CONFIDI) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_T_ESCUSS_CONFIDI ON PBANDI_T_ESCUSS_CONFIDI (ID_ATTIVITA_GARANZIA_CONFIDI) TABLESPACE PBANDI_IDX;

CREATE INDEX IE2_PBANDI_T_ESCUSS_CONFIDI ON PBANDI_T_ESCUSS_CONFIDI (ID_PROGETTO) TABLESPACE PBANDI_IDX;
CREATE INDEX IE3_PBANDI_T_ESCUSS_CONFIDI ON PBANDI_T_ESCUSS_CONFIDI (ID_MODALITA_AGEVOLAZIONE) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_PIANO_RIENTRO"                                     */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_PIANO_RIENTRO (
    ID_PIANO_RIENTRO NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8) NOT NULL,
	ID_MODALITA_AGEVOLAZIONE  NUMBER(3) NOT NULL,
    DT_PROPOSTA DATE,
    IMP_QUOTA_CAPITALE NUMBER(13,2),
    IMP_AGEVOLAZIONE NUMBER(13,2),
    ID_ATTIVITA_ESITO NUMBER(3),
    DT_ESITO DATE,
    ID_ATTIVITA_RECUPERO NUMBER(3),
    NOTE VARCHAR2(4000),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_PIANO_RIENTRO PRIMARY KEY (ID_PIANO_RIENTRO) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_T_PIANO_RIENTRO ON PBANDI_T_PIANO_RIENTRO (ID_PROGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE2_PBANDI_T_PIANO_RIENTRO ON PBANDI_T_PIANO_RIENTRO (ID_ATTIVITA_ESITO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE3_PBANDI_T_PIANO_RIENTRO ON PBANDI_T_PIANO_RIENTRO (ID_ATTIVITA_RECUPERO) TABLESPACE PBANDI_IDX;
CREATE INDEX IE4_PBANDI_T_PIANO_RIENTRO ON PBANDI_T_PIANO_RIENTRO (ID_MODALITA_AGEVOLAZIONE) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_SALDO_STRALCIO"                                    */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_SALDO_STRALCIO (
    ID_SALDO_STRALCIO NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8) NOT NULL,
	ID_MODALITA_AGEVOLAZIONE  NUMBER(3) NOT NULL,
    ID_ATTIVITA_SALDO_STRALCIO NUMBER(3),
    DT_PROPOSTA DATE,
    DT_ACCETTAZIONE DATE,
    IMP_DEBITORE NUMBER(13,2),
    IMP_CONFIDI NUMBER(13,2),
    ID_ATTIVITA_ESITO NUMBER(3),
    DT_ESITO DATE,
    DT_PAGAM_DEBITORE DATE,
    DT_PAGAM_CONFIDI DATE,
    ID_ATTIVITA_RECUPERO NUMBER(3),
    IMP_RECUPERATO NUMBER(13,2),
    IMP_PERDITA NUMBER(13,2),
    NOTE VARCHAR2(4000),
	FLAG_AGEVOLAZIONE VARCHAR2(1),
	IMP_DISIMPEGNO NUMBER(13,2),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_SALDO_STRALCIO PRIMARY KEY (ID_SALDO_STRALCIO) USING INDEX TABLESPACE PBANDI_IDX
);

ALTER TABLE PBANDI_T_SALDO_STRALCIO  add constraint CHK_FLAG_AGEVOLAZIONE  check (FLAG_AGEVOLAZIONE IN ('S',NULL));

CREATE INDEX IE1_PBANDI_T_SALDO_STRALCIO ON PBANDI_T_SALDO_STRALCIO (ID_PROGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE2_PBANDI_T_SALDO_STRALCIO ON PBANDI_T_SALDO_STRALCIO (ID_ATTIVITA_SALDO_STRALCIO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE3_PBANDI_T_SALDO_STRALCIO ON PBANDI_T_SALDO_STRALCIO (ID_ATTIVITA_ESITO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE4_PBANDI_T_SALDO_STRALCIO ON PBANDI_T_SALDO_STRALCIO (ID_ATTIVITA_RECUPERO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE5_PBANDI_T_SALDO_STRALCIO ON PBANDI_T_SALDO_STRALCIO (ID_MODALITA_AGEVOLAZIONE) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_PASSAGGIO_PERDITA"                                 */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_PASSAGGIO_PERDITA (
    ID_PASSAGGIO_PERDITA NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8) NOT NULL,
	ID_MODALITA_AGEVOLAZIONE  NUMBER(3) NOT NULL,
    DT_PASSAGGIO_PERDITA DATE,
    IMP_PERDITA_COMPLESSIVA NUMBER(13,2),
    IMP_PERDITA_CAPITALE NUMBER(13,2),
    IMP_PERDITA_INTERESSI NUMBER(13,2),
    IMP_PERDITA_AGEVOLAZ NUMBER(13,2),
    IMP_PERDITA_MORA NUMBER(13,2),
    NOTE VARCHAR2(4000),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_PASSAGGIO_PERDITA PRIMARY KEY (ID_PASSAGGIO_PERDITA) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_T_PASSAGG_PERDITA ON PBANDI_T_PASSAGGIO_PERDITA (ID_PROGETTO) TABLESPACE PBANDI_IDX;
CREATE INDEX IE2_PBANDI_T_PASSAGG_PERDITA ON PBANDI_T_PASSAGGIO_PERDITA (ID_MODALITA_AGEVOLAZIONE) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_LIBERAZ_BANCA"                                     */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_LIBERAZ_BANCA (
    ID_LIBERAZ_BANCA NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8) NOT NULL,
	ID_MODALITA_AGEVOLAZIONE  NUMBER(3) NOT NULL,
	ID_ATTIVITA_LIBERAZIONE NUMBER(3),
	DT_LIBERAZ_BANCA  DATE,
    BANCA_LIBERATA VARCHAR2(400),
    NOTE VARCHAR2(4000),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_LIBERAZ_BANCA PRIMARY KEY (ID_LIBERAZ_BANCA) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_T_LIBERAZ_BANCA ON PBANDI_T_LIBERAZ_BANCA (ID_PROGETTO) TABLESPACE PBANDI_IDX;
CREATE INDEX IE2_PBANDI_T_LIBERAZ_BANCA ON PBANDI_T_LIBERAZ_BANCA (ID_ATTIVITA_LIBERAZIONE) TABLESPACE PBANDI_IDX;
CREATE INDEX IE3_PBANDI_T_LIBERAZ_BANCA ON PBANDI_T_LIBERAZ_BANCA (ID_MODALITA_AGEVOLAZIONE) TABLESPACE PBANDI_IDX;


/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_MESSA_IN_MORA"                                     */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_MESSA_IN_MORA (
    ID_MESSA_IN_MORA NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8)  NOT NULL,
	ID_MODALITA_AGEVOLAZIONE  NUMBER(3) NOT NULL,
    ID_ATTIVITA_MORA NUMBER(3),
	DT_MESSA_IN_MORA DATE,
    IMP_MESSA_IN_MORA_COMPLESSIVA NUMBER(13,2),
    IMP_QUOTA_CAPITALE_REVOCA NUMBER(13,2),
    IMP_AGEVOLAZ_REVOCA NUMBER(13,2),
    IMP_CREDITO_RESIDUO NUMBER(13,2),
    IMP_INTERESSI_MORA NUMBER(13,2),
    DT_NOTIFICA DATE,
    ID_ATTIVITA_RECUPERO_MORA NUMBER(3),
	DT_PAGAMENTO DATE,
    NOTE VARCHAR2(4000),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
	NUM_PROTOCOLLO VARCHAR2(30),
    CONSTRAINT PK_PBANDI_T_MESSA_IN_MORA PRIMARY KEY (ID_MESSA_IN_MORA) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_T_MESSA_IN_MORA ON PBANDI_T_MESSA_IN_MORA (ID_PROGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE2_PBANDI_T_MESSA_IN_MORA ON PBANDI_T_MESSA_IN_MORA (ID_ATTIVITA_MORA) TABLESPACE PBANDI_IDX;

CREATE INDEX IE3_PBANDI_T_MESSA_IN_MORA ON PBANDI_T_MESSA_IN_MORA (ID_ATTIVITA_RECUPERO_MORA) TABLESPACE PBANDI_IDX;
CREATE INDEX IE4_PBANDI_T_MESSA_IN_MORA ON PBANDI_T_MESSA_IN_MORA (ID_MODALITA_AGEVOLAZIONE) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_ANNOTAZ_GENERALI"                                  */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_ANNOTAZ_GENERALI (
    ID_ANNOTAZ_GENERALE NUMBER(8) NOT NULL,
--    NUM_ANNOTAZ_GENERALE NUMBER(8) NOT NULL,
--    DESC_BREVE_ANNOTAZ_GENERALE VARCHAR2(20),
    ID_PROGETTO NUMBER(8) NOT NULL,
	ID_MODALITA_AGEVOLAZIONE  NUMBER(3) NOT NULL,
    NOTE VARCHAR2(4000),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
	FLAG_ELIMINAZIONE VARCHAR2(2),
    CONSTRAINT PK_PBANDI_T_ANNOTAZ_GENERALI PRIMARY KEY (ID_ANNOTAZ_GENERALE) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_T_ANNOTAZ_GENERALI ON PBANDI_T_ANNOTAZ_GENERALI (ID_PROGETTO) TABLESPACE PBANDI_IDX;
CREATE INDEX IE2_PBANDI_T_ANNOTAZ_GENERALI ON PBANDI_T_ANNOTAZ_GENERALI (ID_MODALITA_AGEVOLAZIONE) TABLESPACE PBANDI_IDX;
--CREATE INDEX IE3_PBANDI_T_ANNOTAZ_GENERALI ON PBANDI_T_ANNOTAZ_GENERALI (NUM_ANNOTAZ_GENERALE) TABLESPACE PBANDI_IDX;
ALTER TABLE PBANDI_T_ANNOTAZ_GENERALI ADD CONSTRAINT CK_PBANDI_T_ANNOTAZ_GENERAL_01 
    CHECK (FLAG_ELIMINAZIONE in ('SI'));

COMMENT ON COLUMN PBANDI_T_ANNOTAZ_GENERALI.FLAG_ELIMINAZIONE IS 'Valori ammessi: ''SI''';

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_ISCRIZIONE_RUOLO"                                  */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_ISCRIZIONE_RUOLO (
    ID_ISCRIZIONE_RUOLO NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8) NOT NULL,
	ID_MODALITA_AGEVOLAZIONE  NUMBER(3) NOT NULL,
    DT_RICHIESTA_ISCRIZIONE DATE,
    NUM_PROTOCOLLO VARCHAR2(30),
    DT_RICHIESTA_DISCARICO DATE,
    NUM_PROTOCOLLO_DISCARICO VARCHAR2(30),
    DT_ISCRIZIONE_RUOLO DATE,
    DT_DISCARICO DATE,
    NUM_PROTOCOLLO_DISCAR_REG VARCHAR2(30),
    DT_RICHIESTA_SOSP DATE,
    NUM_PROTOCOLLO_SOSP VARCHAR2(30),
    IMP_CAPITALE_RUOLO NUMBER(13,2),
    IMP_AGEVOLAZ_RUOLO NUMBER(13,2),
    DT_ISCRIZIONE DATE,
    NUM_PROTOCOLLO_REGIONE VARCHAR2(30),
    TIPO_PAGAMENTO VARCHAR2(1),
    NOTE VARCHAR2(4000),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_ISCRIZIONE_RUOLO PRIMARY KEY (ID_ISCRIZIONE_RUOLO) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_T_ISCRIZIONE_RUOLO ON PBANDI_T_ISCRIZIONE_RUOLO (ID_PROGETTO) TABLESPACE PBANDI_IDX;
CREATE INDEX IE2_PBANDI_T_ISCRIZIONE_RUOLO ON PBANDI_T_ISCRIZIONE_RUOLO (ID_MODALITA_AGEVOLAZIONE) TABLESPACE PBANDI_IDX;

ALTER TABLE PBANDI_T_ISCRIZIONE_RUOLO ADD CONSTRAINT CK_PBANDI_T_ISCRIZIONE_01 
    CHECK (tipo_pagamento in ('I','R', 'N'));

COMMENT ON COLUMN PBANDI_T_ISCRIZIONE_RUOLO.TIPO_PAGAMENTO IS 'I=Integrale R=Rateizzato N=Non presente';

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_SEGNALAZ_CORTE_CONTI"                              */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_SEGNALAZ_CORTE_CONTI (
    ID_SEGNALAZIONE_CORTE_CONTI NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8)  NOT NULL,
	ID_MODALITA_AGEVOLAZIONE  NUMBER(3) NOT NULL,
    DT_SEGNALAZIONE DATE,
    NUM_PROTOCOLLO_SEGN VARCHAR2(30),
    IMP_CRED_RES_CAPITALE NUMBER(13,2),
    IMP_ONERI_AGEVOLAZ NUMBER(13,2),
    IMP_QUOTA_SEGNALAZ NUMBER(13,2),
    IMP_GARANZIA NUMBER(13,2),
    FLAG_PIANO_RIENTRO VARCHAR2(2),
    DT_PIANO_RIENTRO DATE,
    FLAG_SALDO_STRALCIO VARCHAR2(2),
    DT_SALDO_STRALCIO DATE,
    FLAG_PAGAM_INTEGRALE VARCHAR(2),
    DT_PAGAMENTO DATE,
    FLAG_DISSEGNALAZIONE VARCHAR2(2),
    DT_DISSEGNALAZIONE DATE,
    NUM_PROTOCOLLO_DISS VARCHAR2(30),
    FLAG_DECRETO_ARCHIV VARCHAR2(2),
    DT_ARCHIV DATE,
    NUM_PROTOCOLLO_ARCHIV VARCHAR2(30),
    FLAG_COMUNICAZ_REGIONE VARCHAR2(2),
    NOTE VARCHAR2(4000),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_SEGN_CORTE_CONTI PRIMARY KEY (ID_SEGNALAZIONE_CORTE_CONTI) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_T_SEGN_CORTE_CONTI ON PBANDI_T_SEGNALAZ_CORTE_CONTI (ID_PROGETTO) TABLESPACE PBANDI_IDX;
CREATE INDEX IE2_PBANDI_T_SEGN_CORTE_CONTI ON PBANDI_T_SEGNALAZ_CORTE_CONTI (ID_MODALITA_AGEVOLAZIONE) TABLESPACE PBANDI_IDX;

ALTER TABLE PBANDI_T_SEGNALAZ_CORTE_CONTI ADD CONSTRAINT CK_PBANDI_T_SEGNALAZ_CORTE_01 
    CHECK (flag_comunicaz_regione in ('NO','SI'));

ALTER TABLE PBANDI_T_SEGNALAZ_CORTE_CONTI ADD CONSTRAINT CK_PBANDI_T_SEGNALAZ_CORTE_02 
    CHECK (flag_decreto_archiv in ('NO','SI'));

ALTER TABLE PBANDI_T_SEGNALAZ_CORTE_CONTI ADD CONSTRAINT CK_PBANDI_T_SEGNALAZ_CORTE_03 
    CHECK (flag_dissegnalazione IN ('NO','SI'));

ALTER TABLE PBANDI_T_SEGNALAZ_CORTE_CONTI ADD CONSTRAINT CK_PBANDI_T_SEGNALAZ_CORTE_04 
    CHECK (flag_pagam_integrale in ('NO','SI'));

ALTER TABLE PBANDI_T_SEGNALAZ_CORTE_CONTI ADD CONSTRAINT CK_PBANDI_T_SEGNALAZ_CORTE_05 
    CHECK (flag_piano_rientro in ('NO','SI'));

ALTER TABLE PBANDI_T_SEGNALAZ_CORTE_CONTI ADD CONSTRAINT CK_PBANDI_T_SEGNALAZ_CORTE_06 
    CHECK (flag_saldo_stralcio in ('NO','SI'));

COMMENT ON COLUMN PBANDI_T_SEGNALAZ_CORTE_CONTI.FLAG_PIANO_RIENTRO IS 'Valori ammessi: ''NO'',''SI''';

COMMENT ON COLUMN PBANDI_T_SEGNALAZ_CORTE_CONTI.FLAG_SALDO_STRALCIO IS 'Valori ammessi: NO, SI';

COMMENT ON COLUMN PBANDI_T_SEGNALAZ_CORTE_CONTI.FLAG_PAGAM_INTEGRALE IS 'Valori ammessi: NO,SI';

COMMENT ON COLUMN PBANDI_T_SEGNALAZ_CORTE_CONTI.FLAG_DISSEGNALAZIONE IS 'Valori ammessi: NO,SI';

COMMENT ON COLUMN PBANDI_T_SEGNALAZ_CORTE_CONTI.FLAG_DECRETO_ARCHIV IS 'VAlori ammessi: NO,SI';

COMMENT ON COLUMN PBANDI_T_SEGNALAZ_CORTE_CONTI.FLAG_COMUNICAZ_REGIONE IS 'Valori ammessi: NO,SI';

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_CESSIONE_QUOTA_FP"                                 */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_CESSIONE_QUOTA_FP (
    ID_CESSIONE_QUOTA_FP NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8) NOT NULL,
	ID_MODALITA_AGEVOLAZIONE  NUMBER(3) NOT NULL,
    IMP_CESSIONE_CAPITALE NUMBER(13,2),
    IMP_CESSIONE_ONERI NUMBER(13,2),
    IMP_CESSIONE_INTERESSI_MORA NUMBER(13,2),
    IMP_CESSIONE_COMPLESSIVA NUMBER(13,2),
    DT_CESSIONE DATE,
    IMP_CORRISP_CESSIONE NUMBER(13,2),
    DENOM_CESSIONARIO VARCHAR2(400),
    ID_STATO_CESSIONE NUMBER(3),
    NOTE VARCHAR2(4000),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_CESSIONE_QUOTA_FP PRIMARY KEY (ID_CESSIONE_QUOTA_FP) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_T_CESS_QUOTA_FP ON PBANDI_T_CESSIONE_QUOTA_FP (ID_PROGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE2_PBANDI_T_CESS_QUOTA_FP ON PBANDI_T_CESSIONE_QUOTA_FP (ID_STATO_CESSIONE) TABLESPACE PBANDI_IDX;
CREATE INDEX IE3_PBANDI_T_CESS_QUOTA_FP ON PBANDI_T_CESSIONE_QUOTA_FP (ID_MODALITA_AGEVOLAZIONE) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_TRANSAZIONI_BANCA"                                 */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_TRANSAZIONI_BANCA (
    ID_TRANSAZIONE_BANCA NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8) NOT NULL,
	ID_MODALITA_AGEVOLAZIONE  NUMBER(3) NOT NULL,
    IMP_RICONCILIATO NUMBER(13,2),
    IMP_TRANSATO NUMBER(13,2),
    PERC_TRANSAZIONE NUMBER(5,2),
    IMP_PAGATO NUMBER(13,2),
    ID_BANCA NUMBER(6),
    NOTE VARCHAR2(4000),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_TRANSAZIONI_BANCA PRIMARY KEY (ID_TRANSAZIONE_BANCA) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_T_TRANSAZ_BANCA ON PBANDI_T_TRANSAZIONI_BANCA (ID_PROGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE2_PBANDI_T_TRANSAZ_BANCA ON PBANDI_T_TRANSAZIONI_BANCA (ID_BANCA) TABLESPACE PBANDI_IDX;
CREATE INDEX IE3_PBANDI_T_TRANSAZ_BANCA ON PBANDI_T_TRANSAZIONI_BANCA (ID_MODALITA_AGEVOLAZIONE) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_STATO_CESSIONE"                                    */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_STATO_CESSIONE (
    ID_STATO_CESSIONE NUMBER(3) NOT NULL,
    DESC_BREVE_STATO_CESSIONE VARCHAR2(20) NOT NULL,
    DESC_STATO_CESSIONE VARCHAR2(255) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_STATO_CESSIONE PRIMARY KEY (ID_STATO_CESSIONE) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_VARIAZ_ST_CREDITO"                                 */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_VARIAZ_ST_CREDITO (
    ID_VARIAZ_ST_CREDITO NUMBER(8) NOT NULL,
    ID_SOGG_PROG_STATO_CREDITO_FP NUMBER(8) NOT NULL,
    --ID_STATO_AZIENDA NUMBER(3) NOT NULL,
    ID_NUOVO_STATO_CREDITO_FP NUMBER(3) NOT NULL,
    ID_STATO_PROP_VAR_CRE NUMBER(3),
    FLAG_CONF_NUOVO_STA_CRE VARCHAR2(1),
    PERC_SCONF NUMBER(5,2),
    GG_SCONF NUMBER(5),
    IMP_SCONF_CAPITALE NUMBER(15,2),
    IMP_SCONF_INTERESSI NUMBER(15,2),
    IMP_SCONF_AGEV NUMBER(15,2),
	IMP_EROGATO NUMBER(15,2),
    ID_MODALITA_AGEVOLAZIONE NUMBER(3) NOT NULL,
    DT_SCADENZA_RATA DATE,
    DT_PAGAMENTO_RATA DATE,
	NUM_RATA NUMBER(3) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_VARIAZ_ST_CREDITO PRIMARY KEY (ID_VARIAZ_ST_CREDITO) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_T_VARIAZ_ST_CRED ON PBANDI_T_VARIAZ_ST_CREDITO (ID_SOGG_PROG_STATO_CREDITO_FP,ID_MODALITA_AGEVOLAZIONE,NUM_RATA) TABLESPACE PBANDI_IDX;

CREATE INDEX IE3_PBANDI_T_VARIAZ_ST_CRED ON PBANDI_T_VARIAZ_ST_CREDITO (ID_NUOVO_STATO_CREDITO_FP) TABLESPACE PBANDI_IDX;

CREATE INDEX IE4_PBANDI_T_VARIAZ_ST_CRED ON PBANDI_T_VARIAZ_ST_CREDITO (ID_STATO_PROP_VAR_CRE) TABLESPACE PBANDI_IDX;

CREATE INDEX IE5_PBANDI_T_VARIAZ_ST_CRED ON PBANDI_T_VARIAZ_ST_CREDITO (ID_MODALITA_AGEVOLAZIONE) TABLESPACE PBANDI_IDX;

ALTER TABLE PBANDI_T_VARIAZ_ST_CREDITO ADD CONSTRAINT CC_PBANDI_T_VARIAZ_ST_CRED_01 
    CHECK (FLAG_CONF_NUOVO_STA_CRE IN ('N','S'));

COMMENT ON COLUMN PBANDI_T_VARIAZ_ST_CREDITO.FLAG_CONF_NUOVO_STA_CRE IS 'Valori : S/N';

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_STATO_PROP_VAR_CRE"                                */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_STATO_PROP_VAR_CRE (
    ID_STATO_PROP_VAR_CRE NUMBER(3) NOT NULL,
    DESC_BREVE_STATO_PROP_VAR_CRE VARCHAR2(20),
    DESC_STATO_PROP_VAR_CRE VARCHAR2(200),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_STATO_PROP_VAR_CRE PRIMARY KEY (ID_STATO_PROP_VAR_CRE) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_SOGGETTO_CLA_RISCHIO"                              */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_SOGGETTO_CLA_RISCHIO (
    ID_SOGGETTO_CLA_RISCHIO NUMBER(8) NOT NULL,
    ID_SOGGETTO NUMBER(8) NOT NULL,
    ID_CLASSE_RISCHIO NUMBER(3) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_SOGG_CLA_RISCHIO PRIMARY KEY (ID_SOGGETTO_CLA_RISCHIO) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_T_SOG_CLA_RISCHIO ON PBANDI_T_SOGGETTO_CLA_RISCHIO (ID_SOGGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE2_PBANDI_T_SOG_CLA_RISCHIO ON PBANDI_T_SOGGETTO_CLA_RISCHIO (ID_CLASSE_RISCHIO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE3_PBANDI_T_SOG_CLA_RISCHIO ON PBANDI_T_SOGGETTO_CLA_RISCHIO (ID_UTENTE_INS) TABLESPACE PBANDI_IDX;

CREATE INDEX IE4_PBANDI_T_SOG_CLA_RISCHIO ON PBANDI_T_SOGGETTO_CLA_RISCHIO (ID_UTENTE_AGG) TABLESPACE PBANDI_IDX;


/* ---------------------------------------------------------------------- */
/* Add table " PBANDI_D_ESITO_ALL_PIANO_AMMOR"                            */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_ESITO_ALL_PIANO_AMMOR (
    ID_ESITO_ALL_PIANO_AMMOR NUMBER(3) NOT NULL,
    DESC_BREVE_ESI_ALL_PIANO_AMMOR VARCHAR2(20),
    DESC_ESITO_ALL_PIANO_AMMOR VARCHAR2(255),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_ESI_ALL_PIANO_AMM PRIMARY KEY (ID_ESITO_ALL_PIANO_AMMOR) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table " PBANDI_D_TIPO_PROCED_CONCORS"                            */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_TIPO_PROCED_CONCORS (
    ID_TIPO_PROCED_CONCORS NUMBER(3) NOT NULL,
    DESC_BREVE_TIPO_PROCED_CONCORS VARCHAR2(20),
    DESC_TIPO_PROCED_CONCORS VARCHAR2(255),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_TIPO_PROCED_CONCOR PRIMARY KEY (ID_TIPO_PROCED_CONCORS) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table " PBANDI_D_STATO_INSINUA_CONCORS"                            */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_STATO_INSINUA_CONCORS (
    ID_STATO_INSINUA_CONCORS NUMBER(3) NOT NULL,
    DESC_BREVE_STA_INSINUA_CONCORS VARCHAR2(20),
    DESC_STATO_INSINUA_CONCORS VARCHAR2(255),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_STATO_INSIN_CONCOR PRIMARY KEY (ID_STATO_INSINUA_CONCORS) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table " PBANDI_D_STATO_PROCED_CONCORS"                            */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_STATO_PROCED_CONCORS (
    ID_STATO_PROCED_CONCORS NUMBER(3) NOT NULL,
    DESC_BREVE_STA_PROCED_CONCORS VARCHAR2(20),
    DESC_STATO_PROCED_CONCORS VARCHAR2(255),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_STATO_PROCE_CONCOR PRIMARY KEY (ID_STATO_PROCED_CONCORS) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_ALLUNG_PIANO_AMMORT"                                 */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_ALLUNG_PIANO_AMMORT (
    ID_ALLUNG_PIANO_AMMORT NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8) NOT NULL,
	ID_MODALITA_AGEVOLAZIONE  NUMBER(3) NOT NULL,
    ID_ESITO_ALL_PIANO_AMMOR NUMBER(3) NOT NULL,
    DT_PROPOSTA DATE  NOT NULL,
	NUM_MESI_ALLUNG NUMBER(2) NOT NULL,
	DT_SCAD_ORIG_PIANO_AMM DATE,
	DT_SCAD_PIANO_AMM DATE,
    NOTE VARCHAR2(4000),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_ALLUNG_PIANO_AMMOR PRIMARY KEY (ID_ALLUNG_PIANO_AMMORT) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_T_ALLU_PIANO_AMMORT ON PBANDI_T_ALLUNG_PIANO_AMMORT (ID_PROGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE2_PBANDI_T_ALLU_PIANO_AMMORT ON PBANDI_T_ALLUNG_PIANO_AMMORT (ID_ESITO_ALL_PIANO_AMMOR) TABLESPACE PBANDI_IDX;
CREATE INDEX IE3_PBANDI_T_ALLU_PIANO_AMMORT ON PBANDI_T_ALLUNG_PIANO_AMMORT (ID_MODALITA_AGEVOLAZIONE) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_CREDITORIE"                                 */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_CREDITORIE (
    ID_CREDITORIA NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8) NOT NULL,
	ID_MODALITA_AGEVOLAZIONE  NUMBER(3) NOT NULL,
    DT_RICHIESTA DATE  NOT NULL,
    DT_EVASIONE  DATE NOT NULL,
    NOTE VARCHAR2(4000),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_CREDITORIE PRIMARY KEY (ID_CREDITORIA) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_T_CREDITORIE ON PBANDI_T_CREDITORIE (ID_PROGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE2_PBANDI_T_CREDITORIE ON PBANDI_T_CREDITORIE (ID_MODALITA_AGEVOLAZIONE) TABLESPACE PBANDI_IDX;


/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_PROCEDURE_CONCORS"                                 */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_PROCEDURE_CONCORS (
    ID_PROCEDURA_CONCORS NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8) NOT NULL,
	ID_MODALITA_AGEVOLAZIONE  NUMBER(3) NOT NULL,
    ID_TIPO_PROCED_CONCORS NUMBER(3) NOT NULL,
    DT_INIZIO_PROCEDURA DATE  NOT NULL,
    DT_COMUNICAZIONE DATE,
    DT_UDIENZA DATE,
    DT_SCADENZA_INSINUAZIONE DATE,
    ID_STATO_INSINUA_CONCORS NUMBER(3),
	DT_ESECUTIV_STATO_PASS_OMOLOGA DATE,
	ID_STATO_PROCED_CONCORS NUMBER(3),
	DT_CHIUSURA_PROCEDURA DATE,
    NOTE VARCHAR2(4000),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_PROCEDURE_CONCORS PRIMARY KEY (ID_PROCEDURA_CONCORS) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_T_PROCEDURE_CONCORS ON PBANDI_T_PROCEDURE_CONCORS (ID_PROGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE2_PBANDI_T_PROCEDURE_CONCORS ON PBANDI_T_PROCEDURE_CONCORS (ID_TIPO_PROCED_CONCORS) TABLESPACE PBANDI_IDX;
CREATE INDEX IE3_PBANDI_T_PROCEDURE_CONCORS ON PBANDI_T_PROCEDURE_CONCORS (ID_MODALITA_AGEVOLAZIONE) TABLESPACE PBANDI_IDX;
CREATE INDEX IE4_PBANDI_T_PROCEDURE_CONCORS ON PBANDI_T_PROCEDURE_CONCORS (ID_STATO_PROCED_CONCORS) TABLESPACE PBANDI_IDX;
CREATE INDEX IE5_PBANDI_T_PROCEDURE_CONCORS ON PBANDI_T_PROCEDURE_CONCORS (ID_STATO_INSINUA_CONCORS) TABLESPACE PBANDI_IDX;


/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_R_AGEV_CREDITI_GARANZIE"                             */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_R_AGEV_CREDITI_GARANZIE (
	ID_MODALITA_AGEVOLAZIONE  NUMBER(3) NOT NULL,
    ID_ENTITA NUMBER(3) NOT NULL,
    FLAG_AREA_CREDITI VARCHAR2(1),
    FLAG_GARANZIE VARCHAR2(1),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_R_AGEV_CREDITI_GARAN PRIMARY KEY (ID_MODALITA_AGEVOLAZIONE, ID_ENTITA) USING INDEX TABLESPACE PBANDI_IDX
);

ALTER TABLE PBANDI_R_AGEV_CREDITI_GARANZIE ADD CONSTRAINT CK_PBANDI_R_AGEV_CRED_GARAN_01 
    CHECK (FLAG_AREA_CREDITI in ('S'));
ALTER TABLE PBANDI_R_AGEV_CREDITI_GARANZIE ADD CONSTRAINT CK_PBANDI_R_AGEV_CRED_GARAN_02 
    CHECK (FLAG_GARANZIE in ('S'));



COMMENT ON TABLE PBANDI_R_AGEV_CREDITI_GARANZIE IS 'Tabella di configurazione box per area crediti e graranzie';
COMMENT ON COLUMN PBANDI_R_AGEV_CREDITI_GARANZIE.FLAG_AREA_CREDITI IS 'S- Visualizza i box su area crediti';
COMMENT ON COLUMN PBANDI_R_AGEV_CREDITI_GARANZIE.FLAG_GARANZIE IS 'S- Visualizza i box su garanzie';

CREATE INDEX IE1_PBANDI_R_AGEV_CRED_GARAN ON PBANDI_R_AGEV_CREDITI_GARANZIE (ID_ENTITA) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_SEZIONE_SPECIALE"                                  */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_SEZIONE_SPECIALE (
    id_sezione_speciale NUMBER(3) NOT NULL,
    desc_sezione_speciale VARCHAR2(255) NOT NULL,
    desc_breve_sezione_speciale VARCHAR2(20),
    dt_inizio_validita DATE NOT NULL,
    dt_fine_validita DATE,
    CONSTRAINT PK_PBANDI_D_SEZIONE_SPECIALE PRIMARY KEY (id_sezione_speciale) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_ENTE_GIUR_SEZI"                                    */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_ENTE_GIUR_SEZI (
    id_ente_sezione NUMBER(3) NOT NULL,
    id_soggetto NUMBER(8) NOT NULL,
    id_sezione_speciale NUMBER(3),
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    dt_inizio_validita DATE NOT NULL,
    dt_fine_validita DATE,
    CONSTRAINT PK_PBANDI_T_ENTE_GIUR_SEZI PRIMARY KEY (id_ente_sezione) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_T_ENTE_GIUR_SEZI_1 ON PBANDI_T_ENTE_GIUR_SEZI (id_soggetto) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_ENTE_GIUR_SEZI_2 ON PBANDI_T_ENTE_GIUR_SEZI (id_sezione_speciale) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_TIPO_RICHIESTA"                                    */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_TIPO_RICHIESTA (
    id_tipo_richiesta NUMBER(3) NOT NULL,
    desc_tipo_richiesta VARCHAR2(255) NOT NULL,
    desc_breve_tipo_richiesta VARCHAR2(20),
    dt_inizio_validta DATE NOT NULL,
    dt_fine_validita DATE,
    CONSTRAINT PK_PBANDI_D_TIPO_RICHIESTA PRIMARY KEY (id_tipo_richiesta) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_RICHIESTA"                                         */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_RICHIESTA (
    id_richiesta NUMBER(8) NOT NULL,
    id_domanda NUMBER(8) NOT NULL,
    id_tipo_richiesta NUMBER(3) NOT NULL,
    id_stato_richiesta NUMBER(3) NOT NULL,
    id_utente_richiedente NUMBER(8) NOT NULL,
    dt_invio_richiesta DATE NOT NULL,
    dt_chiusura_richiesta DATE,
    flag_urgenza VARCHAR2(1),
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    dt_inizio_validita DATE NOT NULL,
    dt_fine_validita DATE,
    CONSTRAINT PK_PBANDI_T_RICHIESTA PRIMARY KEY (id_richiesta) USING INDEX TABLESPACE PBANDI_IDX
);

ALTER TABLE PBANDI_T_RICHIESTA ADD
    CHECK (flag_urgenza IN ('N','S'));

COMMENT ON COLUMN PBANDI_T_RICHIESTA.flag_urgenza IS 'Valori: S/N';

CREATE INDEX IE_PBANDI_T_RICHIESTA_1 ON PBANDI_T_RICHIESTA (id_domanda) TABLESPACE PBANDI_IDX;

CREATE INDEX IDX_PBANDI_T_RICHIESTA_2 ON PBANDI_T_RICHIESTA (id_tipo_richiesta) TABLESPACE PBANDI_IDX;

CREATE INDEX IDX_PBANDI_T_RICHIESTA_3 ON PBANDI_T_RICHIESTA (id_stato_richiesta) TABLESPACE PBANDI_IDX;

CREATE INDEX IDX_PBANDI_T_RICHIESTA_4 ON PBANDI_T_RICHIESTA (id_utente_richiedente) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_STATO_ATTIVITA"                                    */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_STATO_ATTIVITA (
    id_stato_attivita NUMBER(3) NOT NULL,
    desc_stato_attivita VARCHAR2(255) NOT NULL,
    desc_breve_stato_attivita VARCHAR2(20) NOT NULL,
    dt_inizio_validita DATE NOT NULL,
    dt_fine_validita DATE,
    CONSTRAINT PK_PBANDI_D_STATO_ATTIVITA PRIMARY KEY (id_stato_attivita) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_STATO_RICHIESTA"                                   */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_STATO_RICHIESTA (
    id_stato_richiesta NUMBER(3) NOT NULL,
    desc_stato_richiesta VARCHAR2(255) NOT NULL,
    desc_breve_stato_richiesta VARCHAR2(20) NOT NULL,
    dt_inizio_validita DATE NOT NULL,
    dt_fine_validita DATE,
    CONSTRAINT PK_PBANDI_D_STATO_RICHIESTA PRIMARY KEY (id_stato_richiesta) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_TRACCIATURA_RICH"                             */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_TRACCIATURA_RICH (
    id_tracciatura_rich NUMBER(8) NOT NULL,
    id_richiesta NUMBER(8) NOT NULL,
    id_tipo_comunicazione NUMBER(3),
    destinatario_mittente VARCHAR2(255),
    dt_comunicazione_esterna DATE,
    numero_protocollo VARCHAR2(20),
    motivazione VARCHAR2(255),
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    dt_inizio_validita DATE NOT NULL,
    dt_fine_validita DATE,
    CONSTRAINT PK_PBANDI_T_TRACCIATURA_RICH PRIMARY KEY (id_tracciatura_rich) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_T_TRACC_RICHIESTA_1 ON PBANDI_T_TRACCIATURA_RICH (id_richiesta) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_TRACC_RICHIESTA_2 ON PBANDI_T_TRACCIATURA_RICH (id_tipo_comunicazione) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_TIPO_COMUNICAZIONE"                                */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_TIPO_COMUNICAZIONE (
    id_tipo_comunicazione NUMBER(3) NOT NULL,
    desc_tipo_comunicazione VARCHAR2(255) NOT NULL,
    desc_breve_tipo_comunicazione VARCHAR2(40) NOT NULL,
    dt_inizio_validita DATE NOT NULL,
    dt_fine_validita DATE,
    CONSTRAINT PK_PBANDI_D_TIPO_COMUNICAZIONE PRIMARY KEY (id_tipo_comunicazione) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_SOGGETTO_DURC"                                     */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_SOGGETTO_DURC (
    id_soggetto_durc NUMBER(8) NOT NULL,
    id_soggetto NUMBER(8) NOT NULL,
    id_tipo_esito_durc NUMBER(3),
    dt_emissione_durc DATE NOT NULL,
    dt_scadenza DATE,
    num_protocollo_inps VARCHAR2(20),
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    dt_inizio_validita DATE NOT NULL,
    dt_fine_validita DATE,
    CONSTRAINT PK_PBANDI_T_SOGGETTO_DURC PRIMARY KEY (id_soggetto_durc) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_T_SOGGETTO_DURC_1 ON PBANDI_T_SOGGETTO_DURC (id_soggetto) TABLESPACE PBANDI_IDX;

CREATE INDEX IDX_PBANDI_T_SOGGETTO_DURC_2 ON PBANDI_T_SOGGETTO_DURC (id_tipo_esito_durc) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_TIPO_ESITO_RICHIESTE"                              */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_TIPO_ESITO_RICHIESTE (
    id_tipo_esito_richieste NUMBER(3) NOT NULL,
    desc_esito_richieste VARCHAR2(255),
    desc_breve_esito_richieste VARCHAR2(20),
    dt_inizio_validita DATE NOT NULL,
    dt_fine_validita DATE,
    CONSTRAINT PK_PBANDI_D_TIPO_ESITO_RICH PRIMARY KEY (id_tipo_esito_richieste) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_SOGGETTO_DSAN"                                     */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_SOGGETTO_DSAN (
    id_soggetto_dsan NUMBER(8) NOT NULL,
    id_domanda NUMBER(8) NOT NULL,
    --id_esito_dsan NUMBER(3),
    dt_emissione_dsan DATE NOT NULL,
    dt_scadenza DATE NOT NULL,
    --num_protocollo VARCHAR2(20),
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    dt_inizio_validita DATE NOT NULL,
    dt_fine_validita DATE,
	ID_ESITO_DSAN NUMBER(3),
    CONSTRAINT PK_PBANDI_T_SOGGETTO_DSAN PRIMARY KEY (id_soggetto_dsan) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_T_SOGGETTO_DSAN_1 ON PBANDI_T_SOGGETTO_DSAN (id_domanda) TABLESPACE PBANDI_IDX;

--CREATE INDEX IE_PBANDI_T_SOGGETTO_DSAN_2 ON PBANDI_T_SOGGETTO_DSAN (id_esito_dsan) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_SOGGETTO_ANTIMAFIA"                                */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_SOGGETTO_ANTIMAFIA (
    id_soggetto_antimafia NUMBER(8) NOT NULL,
    id_domanda NUMBER(8) NOT NULL,
    id_tipo_esito_antimafia NUMBER(3),
    dt_ricezione_bdna DATE NOT NULL,
    numer_protocollo_ricevuta VARCHAR2(50) NOT NULL,
    --numer_protocollo_ricevuta VARCHAR2(20) NOT NULL,
    dt_emissione DATE,
   -- esito_liberatoria_antimafia VARCHAR2(255),
    dt_scadenza_antimafia DATE,
    num_protocollo_prefettura VARCHAR2(50),
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    dt_inizio_validita DATE NOT NULL,
    dt_fine_validita DATE,
    CONSTRAINT PK_PBANDI_T_SOGGETTO_ANTIMAFIA PRIMARY KEY (id_soggetto_antimafia) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_T_SOGG_ANTI_MAF_1 ON PBANDI_T_SOGGETTO_ANTIMAFIA (id_domanda) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_SOGG_ANTI_MAF_2 ON PBANDI_T_SOGGETTO_ANTIMAFIA (id_tipo_esito_antimafia) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_CAUSALE_BLOCCO"                                    */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_CAUSALE_BLOCCO (
    id_causale_blocco NUMBER(3) NOT NULL,
    desc_causale_blocco VARCHAR2(255) NOT NULL,
    desc_breve_causale_blocco VARCHAR2(20) NOT NULL,
	flag_revoca  VARCHAR2(1),
	flag_blocco_anagrafico VARCHAR2(1) NOT NULL,
    desc_macroarea VARCHAR2(40) NOT NULL,
    ID_STATO_AZIENDA NUMBER(3),
    dt_inizio_validita DATE NOT NULL,
    dt_fine_validita DATE,
	FLAG_EROGAZIONE VARCHAR2(1),
    CONSTRAINT PK_PBANDI_D_CAUSALE_BLOCCO PRIMARY KEY (id_causale_blocco) USING INDEX TABLESPACE PBANDI_IDX
);

ALTER TABLE PBANDI_D_CAUSALE_BLOCCO ADD CONSTRAINT CK_PBANDI_D_CAUSALE_BLOCCO_01 
    CHECK (flag_revoca in ('S'));

ALTER TABLE PBANDI_D_CAUSALE_BLOCCO ADD CONSTRAINT CK_PBANDI_D_CAUSALE_BLOCCO_02 
    CHECK (flag_blocco_anagrafico in ('S', 'N'));

alter table PBANDI_D_CAUSALE_BLOCCO add constraint CHK_PBANDI_D_CAUSALE_BLOCCO   check (FLAG_EROGAZIONE IN ('S', 'N'));

COMMENT ON COLUMN PBANDI_D_CAUSALE_BLOCCO.flag_blocco_anagrafico IS 'N=Blocco singola domanda, S=Blocco del soggetto';

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_SOGG_DOMANDA_BLOCCO"                               */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_SOGG_DOMANDA_BLOCCO (
    id_soggetto_domanda_blocco NUMBER(8) NOT NULL,
    progr_soggetto_domanda NUMBER(8),
    id_causale_blocco NUMBER(3),
    dt_inserimento_blocco DATE,
    dt_inserimento_sblocco DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    dt_inizio_validita DATE NOT NULL,
    dt_fine_validita DATE,
    CONSTRAINT PK_PBANDI_T_SOGG_DOMANDA_BLOC PRIMARY KEY (id_soggetto_domanda_blocco) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_T_SOGG_DOM_BLOC_1 ON PBANDI_T_SOGG_DOMANDA_BLOCCO (progr_soggetto_domanda) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_SOGG_DOM_BLOC_2 ON PBANDI_T_SOGG_DOMANDA_BLOCCO (id_causale_blocco) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_CALC_DIM_IMPRESA"                                  */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_CALC_DIM_IMPRESA (
    ID_CALC_DIM_IMPRESA NUMBER(8) NOT NULL,
    ID_SOGGETTO NUMBER NOT NULL,
    ID_PERIODO NUMBER(8),
    ULA NUMBER(8),
    IMP_FATTURATO NUMBER(13,2) NOT NULL,
    TOT_BILANCIO_ANNUO NUMBER(13,2),
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_T_CALC_DIM_IMPRESA PRIMARY KEY (ID_CALC_DIM_IMPRESA) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_T_CALC_DIM_IMPRESA_1 ON PBANDI_T_CALC_DIM_IMPRESA (ID_SOGGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_CALC_DIM_IMPRESA_2 ON PBANDI_T_CALC_DIM_IMPRESA (ID_PERIODO) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_CAMPO_REGOLA"                                  */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_CAMPO_REGOLA (
    ID_CAMPO_REGOLA  NUMBER(3) NOT NULL,
    NOME_CAMPO VARCHAR2(100) NOT NULL,
    ID_REGOLA NUMBER(8) NOT NULL,
	ID_CAUSALE_BLOCCO NUMBER(8),
	DT_INIZIO_VALIDITA DATE NOT NULL,
	DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_CAMPO_REGOLA PRIMARY KEY (ID_CAMPO_REGOLA) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE UNIQUE INDEX IE_PBANDI_D_CAMPO_REGOLA_1 ON PBANDI_D_CAMPO_REGOLA (ID_REGOLA) TABLESPACE PBANDI_IDX;
CREATE UNIQUE INDEX IE_PBANDI_D_CAMPO_REGOLA_2 ON PBANDI_D_CAMPO_REGOLA (NOME_CAMPO) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_SERVIZI_AMMVO_CONTAB"                                        */
/* ---------------------------------------------------------------------- */
CREATE TABLE PBANDI_D_SERVIZI_AMMVO_CONTAB
(ID_SERVIZIO  Number  Not null,   
 NOME_SERVIZIO  VARCHAR2(40) Not null,    
 DESCRIZIONE  VARCHAR2(300),     
 TIPOLOGIA  Varchar2(1),		
 DT_INIZIO_VALIDITA	Date Not null,		
 DT_FINE_VALIDITA	Date,		
 PARAMETRI_DI_INPUT	VARCHAR2(200)	Not null,		
 PARAMETRI_DI_OUTPUT	VARCHAR2(200)	Not null,
 CONSTRAINT PK_PBANDI_D_SERVIZI_AMMVO_CONT PRIMARY KEY (ID_SERVIZIO) USING INDEX TABLESPACE PBANDI_IDX
);

--
COMMENT ON COLUMN PBANDI_D_SERVIZI_AMMVO_CONTAB.ID_SERVIZIO IS 'Identificativo interno del servizio';
COMMENT ON COLUMN PBANDI_D_SERVIZI_AMMVO_CONTAB.NOME_SERVIZIO IS 'Nome del servizio chiamato nel codice';
COMMENT ON COLUMN PBANDI_D_SERVIZI_AMMVO_CONTAB.DESCRIZIONE IS 'Testo descrittivo del servizio';
COMMENT ON COLUMN PBANDI_D_SERVIZI_AMMVO_CONTAB.TIPOLOGIA IS 'Se in lettura o scrittura (Valori R o W)';
COMMENT ON COLUMN PBANDI_D_SERVIZI_AMMVO_CONTAB.PARAMETRI_DI_INPUT IS 'Concatenazione con separatore';
COMMENT ON COLUMN PBANDI_D_SERVIZI_AMMVO_CONTAB.PARAMETRI_DI_OUTPUT IS 'Concatenazione con separatore';

-- PBANDI_T_MON_SERV_AMMVO_CONTAB
CREATE TABLE PBANDI_T_MON_SERV_AMMVO_CONTAB
(ID_MONIT_AMMVO_CONT	Number(38) not null,
    ID_SERVIZIO	Number		not null,		
    ID_UTENTE	Number		not null,		
    MODALITA_CHIAMATA	Varchar2(1)	not null	,    	
    ESITO 	Varchar2(2),		
    CODICE_ERRORE	Varchar2(10),		
    MESSAGGIO_ERRORE	Varchar2(4000),		
    DATETIME_INIZIO_CHIAMATA	Date	not null,		
    DATETIME_FINE_CHIAMATA	Date,		
    PARAMETRI_DI_INPUT	VARCHAR2(4000) not null,		
    PARAMETRI_DI_OUTPUT	VARCHAR2(4000),		
    ID_ENTITA	NUMBER(3,0) not null,		
    ID_TARGET	NUMBER(8,0)	not null,
    CONSTRAINT PK_PBANDI_T_MON_SERV_AMMVO_CON PRIMARY KEY (ID_MONIT_AMMVO_CONT) USING INDEX TABLESPACE PBANDI_IDX	
);


-- idx
CREATE INDEX IE1_PBANDI_T_MON_SER_AMM_CONT ON PBANDI_T_MON_SERV_AMMVO_CONTAB (ID_SERVIZIO) TABLESPACE PBANDI_IDX;
CREATE INDEX IE2_PBANDI_T_MON_SER_AMM_CONT ON PBANDI_T_MON_SERV_AMMVO_CONTAB (ID_UTENTE) TABLESPACE PBANDI_IDX;
CREATE INDEX IE3_PBANDI_T_MON_SER_AMM_CONT ON PBANDI_T_MON_SERV_AMMVO_CONTAB (ID_ENTITA,ID_TARGET) TABLESPACE PBANDI_IDX;

-- 
COMMENT ON COLUMN PBANDI_T_MON_SERV_AMMVO_CONTAB.ID_MONIT_AMMVO_CONT IS 'Identificativo interno valorizzato tramite sequence';
COMMENT ON COLUMN PBANDI_T_MON_SERV_AMMVO_CONTAB.ID_UTENTE IS 'Identificativo dell''utente applicativo che effettua la chiamata';
COMMENT ON COLUMN PBANDI_T_MON_SERV_AMMVO_CONTAB.MODALITA_CHIAMATA IS 'Possibili valori I (Insert), U (Update), nel caso di angrafica fondo e iban cancellazione non permessa';
COMMENT ON COLUMN PBANDI_T_MON_SERV_AMMVO_CONTAB.ESITO IS 'Valori (OK/KO)';
COMMENT ON COLUMN PBANDI_T_MON_SERV_AMMVO_CONTAB.PARAMETRI_DI_INPUT IS 'Concatenazione con separatore';
COMMENT ON COLUMN PBANDI_T_MON_SERV_AMMVO_CONTAB.PARAMETRI_DI_OUTPUT IS 'Concatenazione con separatore';


CREATE TABLE PBANDI_W_CARICAMENTO_AMMCO_XML
(
  ID_CARICAMENTO   NUMBER                  NOT NULL,
  FILE_XML         SYS.XMLTYPE,
  NOME_FILE        VARCHAR2(255)           NOT NULL,
  FLAG_CARICATO    VARCHAR2(2),
  FONTE            VARCHAR2(20)            NOT NULL, --(MONIT_CREDITI,RECUPERI,EROGAZIONI)
  DT_INSERIMENTO   DATE                    DEFAULT sysdate,
  FLAG_ANOMALIE    VARCHAR2(2)
)
TABLESPACE PBANDI_TBL
XMLTYPE FILE_XML STORE AS CLOB 
      ( TABLESPACE  PBANDI_LOB 
        ENABLE      STORAGE IN ROW
        CHUNK       8192
        RETENTION
        NOCACHE
        INDEX       (
          TABLESPACE PBANDI_LOB
                    )
      );

ALTER TABLE PBANDI_W_CARICAMENTO_AMMCO_XML 
ADD  CONSTRAINT PK_PBANDI_W_CARIC_AMMCO_XML PRIMARY KEY (ID_CARICAMENTO) USING INDEX TABLESPACE PBANDI_IDX;


/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_SOGG_AMMVO_CONTAB"                                 */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_SOGG_AMMVO_CONTAB (
    ID_SOGG_AMMVO_CONTAB NUMBER(8) NOT NULL,
    COD_BENEFICIARIO VARCHAR2(10) NOT NULL,
    RAGIONE_SOCIALE VARCHAR2(255),
    COGNOME VARCHAR2(150),
    NOME VARCHAR2(150),
    ID_NAZIONE NUMBER(4),
    ID_PROVINCIA NUMBER(4),
    ID_COMUNE NUMBER(4),
    INDIRIZZO VARCHAR2(255),
    CAP VARCHAR2(5),
    CODICE_FISCALE VARCHAR2(32),
    PARTITA_IVA VARCHAR2(20),
    EMAIL VARCHAR2(128),
    PEC VARCHAR2(128),
    TELEFONO VARCHAR2(24),
    DITTA NUMBER(4),
    TOP011_CLIFOR_CG44 INTEGER,
    DATA_INVIO DATE,
    TIPO_INVIO CHAR(1),
    ESITO VARCHAR2(40),
    CONSTRAINT PK_PBANDI_T_SOGG_AMMVO_CONTAB PRIMARY KEY (ID_SOGG_AMMVO_CONTAB) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_T_SOGG_AMMVO_CONTAB ON PBANDI_T_SOGG_AMMVO_CONTAB (COD_BENEFICIARIO) TABLESPACE PBANDI_IDX;

COMMENT ON TABLE PBANDI_T_SOGG_AMMVO_CONTAB IS 'Tabella di interfaccia con Amministrativo Contabile. Sono memorizzati i nuovi soggetti e soggetti con variazioni';

COMMENT ON COLUMN PBANDI_T_SOGG_AMMVO_CONTAB.TIPO_INVIO IS 'I=Inserimento U=Modifica';

COMMENT ON COLUMN PBANDI_T_SOGG_AMMVO_CONTAB.ESITO IS 'OK,KO';

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_CAMP_STATO"                                        */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_CAMP_STATO (
    ID_STATO_CAMP NUMBER(3) NOT NULL,
    DESC_BREVE_STATO_CAMP VARCHAR2(20) NOT NULL,
    DESC_STATO_CAMP VARCHAR2(255) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_CAMP_STATO PRIMARY KEY (ID_STATO_CAMP) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_FASE_CAMP"                                         */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_FASE_CAMP (
    ID_FASE_CAMP NUMBER(3) NOT NULL,
    DESC_BREVE_FASE_CAMP VARCHAR2(20) NOT NULL,
    DESC_FASE_CAMP VARCHAR2(255) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_FASE_CAMP PRIMARY KEY (ID_FASE_CAMP) USING INDEX TABLESPACE PBANDI_IDX
);


/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_TIPO_CAMP"                                         */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_TIPO_CAMP (
    ID_TIPO_CAMP NUMBER(3) NOT NULL,
    DESC_BREVE_TIPO_CAMP VARCHAR2(20) NOT NULL,
    DESC_TIPO_CAMP VARCHAR2(255) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_TIPO_CAMP PRIMARY KEY (ID_TIPO_CAMP) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_ATTIV_CONTROLLO_LOCO"                              */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_ATTIV_CONTROLLO_LOCO (
    ID_ATTIV_CONTR_LOCO NUMBER(3) NOT NULL,
    DESC_BREVE_ATTIV_CONTR_LOCO VARCHAR2(20) NOT NULL,
    DESC_ATTIV_CONTR_LOCO VARCHAR2(255) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_ATTIV_CONTR_LOCO PRIMARY KEY (ID_ATTIV_CONTR_LOCO) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_STATO_CHECKLIST"                                   */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_STATO_CHECKLIST (
    ID_STATO_CHECKLIST NUMBER(3) NOT NULL,
    DESC_BREVE_STATO_CHECKLIST VARCHAR2(20) NOT NULL,
    DESC_STATO_CHECKLIST VARCHAR2(255) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_STATO_CHECKLIST PRIMARY KEY (ID_STATO_CHECKLIST)  USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_CAMPIONAMENTO_FINP"                                */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_CAMPIONAMENTO_FINP (
    ID_CAMPIONAMENTO NUMBER(8) NOT NULL,
    ID_FASE_CAMP NUMBER(3) NOT NULL,
    ID_TIPO_CAMP NUMBER(3) NOT NULL,
    FLAG_ANNULLATO VARCHAR2(1),
    DESC_CAMPIONAMENTO VARCHAR2(400),
    DT_CAMPIONAMENTO DATE,
    NUM_PROGETTI_SEL INTEGER,
    IMPORTO_VALIDATO NUMBER(17,2),
    PERC_ESTRATTA NUMBER(5,2),
    IMP_VAL_PERC_ESTRATTA NUMBER(17,2),
	NUM_CAMPIONAMENTO_ESTERNO  NUMBER(8),
	FLAG_CAMPIONAMENTO_ESTERNO VARCHAR2(1),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_CAMPIONAMENTO_FINP PRIMARY KEY (ID_CAMPIONAMENTO) USING INDEX TABLESPACE PBANDI_IDX
);

ALTER TABLE PBANDI_T_CAMPIONAMENTO_FINP ADD CONSTRAINT CC_PBANDI_T_CAMPIONAM_FINP_01 
    CHECK (FLAG_ANNULLATO='S');

ALTER TABLE PBANDI_T_CAMPIONAMENTO_FINP ADD CONSTRAINT CC_PBANDI_T_CAMPIONAM_FINP_02
    CHECK (FLAG_CAMPIONAMENTO_ESTERNO='S');


CREATE INDEX IE_PBANDI_T_CAMP_FINP_1 ON PBANDI_T_CAMPIONAMENTO_FINP (ID_FASE_CAMP) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_CAMP_FINP_2 ON PBANDI_T_CAMPIONAMENTO_FINP (ID_TIPO_CAMP) TABLESPACE PBANDI_IDX;

COMMENT ON COLUMN PBANDI_T_CAMPIONAMENTO_FINP.NUM_CAMPIONAMENTO_ESTERNO IS 'Parametro valorizzato per i campionamenti effettuati esternamente da Finpiemonte';

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_R_CAMP_PROGETTI"                                     */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_R_CAMP_PROGETTI (
    ID_CAMPIONAMENTO NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8) NOT NULL,
    DT_ULTIMO_CONTROLLO DATE,
    FLAG_ESCLUDI VARCHAR2(1),
    FLAG_ESTRATTO VARCHAR2(1),
    FLAG_CAMPIONATO VARCHAR2(1),
    MOTIVO_ESCLUSIONE VARCHAR2(4000),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_R_CAMP_PROGETTI PRIMARY KEY (ID_CAMPIONAMENTO, ID_PROGETTO) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_R_CAMP_PROGETTI_1 ON PBANDI_R_CAMP_PROGETTI (ID_PROGETTO) TABLESPACE PBANDI_IDX;

ALTER TABLE PBANDI_R_CAMP_PROGETTI ADD CONSTRAINT CC_PBANDI_R_CAMP_PROGETTI_01 
    CHECK (FLAG_ESCLUDI='S');

ALTER TABLE PBANDI_R_CAMP_PROGETTI ADD CONSTRAINT CC_PBANDI_R_CAMP_PROGETTI_02 
    CHECK (FLAG_ESTRATTO='S');

ALTER TABLE PBANDI_R_CAMP_PROGETTI ADD CONSTRAINT CC_PBANDI_R_CAMP_PROGETTI_03 
    CHECK (FLAG_CAMPIONATO='S');


/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_R_RIC_CAMP_TIPO_DICH_SP"                             */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_R_RIC_CAMP_TIPO_DICH_SP (
    ID_CAMPIONAMENTO NUMBER(8) NOT NULL,
    ID_TIPO_DICHIARAZ_SPESA NUMBER(3) NOT NULL,
    CONSTRAINT PK_PBANDI_R_RIC_CAMP_TIPO_DSP PRIMARY KEY (ID_CAMPIONAMENTO, ID_TIPO_DICHIARAZ_SPESA) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_R_RIC_CAMP_TIP_DS_1 ON PBANDI_R_RIC_CAMP_TIPO_DICH_SP (ID_TIPO_DICHIARAZ_SPESA) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_R_RIC_CAMP_BANDO_LINEA"                              */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_R_RIC_CAMP_BANDO_LINEA (
    ID_CAMPIONAMENTO NUMBER(8) NOT NULL,
    PROGR_BANDO_LINEA_INTERVENTO NUMBER(8) NOT NULL,
    CONSTRAINT PK_PBANDI_R_RIC_CAMP_BANDO_LIN PRIMARY KEY (ID_CAMPIONAMENTO, PROGR_BANDO_LINEA_INTERVENTO) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_R_RIC_CAMP_BL_01 ON PBANDI_R_RIC_CAMP_BANDO_LINEA (PROGR_BANDO_LINEA_INTERVENTO) TABLESPACE PBANDI_IDX;


/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_RIC_CAMP_DICH_SP"                                  */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_RIC_CAMP_DICH_SP (
    ID_CAMPIONAMENTO NUMBER(8) NOT NULL,
    DT_RICEZIONE_DA DATE,
    DT_RICEZIONE_A DATE,
    DT_ULTIMO_ESITO_DA DATE,
    DT_ULTIMO_ESITO_A DATE,
    IMP_RENDICONTATO_DA NUMBER(17,2),
    IMP_RENDICONTATO_A NUMBER(13,2),
    IMP_VALIDATO_DA NUMBER(17,2),
    IMP_VALIDATO_A NUMBER(17,2),
    CONSTRAINT PK_PBANDI_T_RIC_CAMP_DICH_SP PRIMARY KEY (ID_CAMPIONAMENTO) USING INDEX TABLESPACE PBANDI_IDX
);

-- Controlli in loco
/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_STATO_CONTR_LOCO"                                  */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_STATO_CONTR_LOCO (
    ID_STATO_CONTR_LOCO NUMBER(3) NOT NULL,
    DESC_BREVE_STATO_CONTR_LOCO VARCHAR2(20) NOT NULL,
    DESC_STATO_CONTR_LOCO VARCHAR2(255) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_STATO_CONTR_LOCO PRIMARY KEY (ID_STATO_CONTR_LOCO) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_STATO_RICH_INTEGRAZ"                               */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_STATO_RICH_INTEGRAZ (
    ID_STATO_RICHIESTA NUMBER(3) NOT NULL,
    DESC_BREVE_STATO_RICHIESTA VARCHAR2(20) NOT NULL,
    DESC_STATO_RICHIESTA VARCHAR2(255) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_STATO_RICH_INTEGR PRIMARY KEY (ID_STATO_RICHIESTA) USING INDEX TABLESPACE PBANDI_IDX
);


/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_CONTROLLO_LOCO"                                    */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_CONTROLLO_LOCO (
    ID_CONTROLLO_LOCO INTEGER NOT NULL,
    ID_STATO_CONTR_LOCO NUMBER(3),
    DT_AVVIO_CONTROLLI DATE,
    DT_INIZIO_CONTROLLI DATE,
    DT_FINE_CONTROLLI DATE,
    IMP_DA_CONTROLLARE NUMBER(17,2),
    IMP_IRREGOLARITA NUMBER(17,2),
    IMP_AGEVOLAZ_IRREG NUMBER(17,2),
    DT_VISITA_CONTROLLO DATE,
    TIPO_VISITA VARCHAR2(255),
    ISTRUTTORE_VISITA VARCHAR2(255),
    ID_CATEG_ANAGRAFICA NUMBER(3),
    ID_ATTIV_CONTR_LOCO NUMBER(3),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_CONTROLLO_LOCO PRIMARY KEY (ID_CONTROLLO_LOCO) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IDX_PBANDI_T_CONTROLLO_LOCO_1 ON PBANDI_T_CONTROLLO_LOCO (ID_STATO_CONTR_LOCO) TABLESPACE PBANDI_IDX;
CREATE INDEX IDX_PBANDI_T_CONTROLLO_LOCO_2 ON PBANDI_T_CONTROLLO_LOCO (ID_CATEG_ANAGRAFICA) TABLESPACE PBANDI_IDX;
CREATE INDEX IDX_PBANDI_T_CONTROLLO_LOCO_3 ON PBANDI_T_CONTROLLO_LOCO (ID_ATTIV_CONTR_LOCO) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_R_CAMP_CONTR_LOCO"                                   */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_R_CAMP_CONTR_LOCO (
    ID_CAMPIONAMENTO NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8) NOT NULL,
    ID_CONTROLLO_LOCO INTEGER NOT NULL,
    CONSTRAINT PK_PBANDI_R_CAMP_CONTR_LOCO PRIMARY KEY (ID_CAMPIONAMENTO, ID_PROGETTO, ID_CONTROLLO_LOCO) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IDX_PBANDI_R_CAMP_CONTR_LOCO_1 ON PBANDI_R_CAMP_CONTR_LOCO (ID_PROGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IDX_PBANDI_R_CAMP_CONTR_LOCO_2 ON PBANDI_R_CAMP_CONTR_LOCO (ID_CONTROLLO_LOCO) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_CONTROLLO_LOCO_ALTRI"                              */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_CONTROLLO_LOCO_ALTRI (
    ID_CONTROLLO INTEGER NOT NULL,
    ID_PROGETTO NUMBER(8) NOT NULL,
    ID_STATO_CONTR_LOCO NUMBER(3) NOT NULL,
    DT_INIZIO_CONTROLLI DATE,
    DT_FINE_CONTROLLI DATE,
    IMP_DA_CONTROLLARE NUMBER(17,2),
    IMP_IRREGOLARITA NUMBER(17,2),
    IMP_AGEVOLAZ_IRREG NUMBER(17,2),
    ID_CATEG_ANAGRAFICA NUMBER(3) NOT NULL,
    TIPO_CONTROLLI VARCHAR2(1),
    ISTRUTTORE_VISITA VARCHAR2(255),
    ID_ATTIV_CONTR_LOCO NUMBER(3),
    DT_AVVIO_CONTROLLI DATE,
    DT_VISITA_CONTROLLO DATE,
    TIPO_VISITA VARCHAR2(255),
    NUM_PROTOCOLLO VARCHAR2(30),
    ID_STATO_CHECKLIST NUMBER(3),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_CONTR_LOCO_ALTRI PRIMARY KEY (ID_CONTROLLO) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IDX_PBANDI_T_CONTR_LOCO_ALTR_1 ON PBANDI_T_CONTROLLO_LOCO_ALTRI (ID_PROGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IDX_PBANDI_T_CONTR_LOCO_ALTR_2 ON PBANDI_T_CONTROLLO_LOCO_ALTRI (ID_STATO_CONTR_LOCO) TABLESPACE PBANDI_IDX;

CREATE INDEX IDX_PBANDI_T_CONTR_LOCO_ALTR_3 ON PBANDI_T_CONTROLLO_LOCO_ALTRI (ID_CATEG_ANAGRAFICA) TABLESPACE PBANDI_IDX;

CREATE INDEX IDX_PBANDI_T_CONTR_LOCO_ALTR_4 ON PBANDI_T_CONTROLLO_LOCO_ALTRI (ID_ATTIV_CONTR_LOCO) TABLESPACE PBANDI_IDX;

CREATE INDEX IDX_PBANDI_T_CONTR_LOCO_ALTR_5 ON PBANDI_T_CONTROLLO_LOCO_ALTRI (ID_STATO_CHECKLIST) TABLESPACE PBANDI_IDX;

ALTER TABLE PBANDI_T_CONTROLLO_LOCO_ALTRI ADD CONSTRAINT CC_PBANDI_T_CONTR_LOCO_ALTR_01 
    CHECK (TIPO_CONTROLLI IN ('D','L'));

COMMENT ON COLUMN PBANDI_T_CONTROLLO_LOCO_ALTRI.TIPO_CONTROLLI IS 'D=Documentale L=Loco';
/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_RICHIESTA_INTEGRAZ"                                */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_RICHIESTA_INTEGRAZ (
    ID_RICHIESTA_INTEGRAZ NUMBER(8) NOT NULL,
    ID_ENTITA NUMBER(3) NOT NULL,
    ID_TARGET NUMBER(8) NOT NULL,
    DT_RICHIESTA DATE NOT NULL,
    DT_INVIO DATE,
    ID_UTENTE_RICHIESTA NUMBER(8) NOT NULL,
    ID_UTENTE_INVIO NUMBER(8),
    DT_NOTIFICA DATE,
    NUM_GIORNI_SCADENZA NUMBER(4),
    DT_CHIUSURA_UFFICIO DATE,
    ID_STATO_RICHIESTA NUMBER(3) NOT NULL,
    DT_SCADENZA DATE,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_RICHIESTA_INTEGRAZ PRIMARY KEY (ID_RICHIESTA_INTEGRAZ) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IDX_PBANDI_T_RICH_INTEGRAZ_1 ON PBANDI_T_RICHIESTA_INTEGRAZ (ID_ENTITA,ID_TARGET) TABLESPACE PBANDI_IDX;

CREATE INDEX IDX_PBANDI_T_RICH_INTEGRAZ_2 ON PBANDI_T_RICHIESTA_INTEGRAZ (ID_STATO_RICHIESTA) TABLESPACE PBANDI_IDX;

CREATE INDEX IDX_PBANDI_T_RICH_INTEGRAZ_3 ON PBANDI_T_RICHIESTA_INTEGRAZ (ID_UTENTE_RICHIESTA) TABLESPACE PBANDI_IDX;
CREATE INDEX IDX_PBANDI_T_RICH_INTEGRAZ_4 ON PBANDI_T_RICHIESTA_INTEGRAZ (ID_UTENTE_INVIO) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_STATO_PROROGA"                                     */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_STATO_PROROGA (
    ID_STATO_PROROGA NUMBER(3) NOT NULL,
    DESC_BREVE_STATO_PROROGA VARCHAR2(20) NOT NULL,
    DESC_STATO_PROROGA VARCHAR2(255) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_STATO_PROROGA PRIMARY KEY (ID_STATO_PROROGA) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_PROROGA"                                           */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_PROROGA (
    ID_RICHIESTA_PROROGA NUMBER(8) NOT NULL,
    ID_ENTITA NUMBER(3),
    ID_TARGET NUMBER(8) NOT NULL,
    DT_RICHIESTA DATE NOT NULL,
    NUM_GIORNI_RICH NUMBER(3) NOT NULL,
    MOTIVAZIONE VARCHAR(2000) NOT NULL,
    NUM_GIORNI_APPROV NUMBER(3),
    ID_STATO_PROROGA NUMBER(3),
    DT_ESITO_RICHIESTA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_PROROGA PRIMARY KEY (ID_RICHIESTA_PROROGA) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_T_PROROGA ON PBANDI_T_PROROGA (ID_ENTITA,ID_TARGET) TABLESPACE PBANDI_IDX;

CREATE INDEX IE2_PBANDI_T_PROROGA ON PBANDI_T_PROROGA (ID_STATO_PROROGA) TABLESPACE PBANDI_IDX;

CREATE INDEX IE3_PBANDI_T_PROROGA ON PBANDI_T_PROROGA (ID_UTENTE_INS) TABLESPACE PBANDI_IDX;

CREATE INDEX IE4_PBANDI_T_PROROGA ON PBANDI_T_PROROGA (ID_UTENTE_AGG) TABLESPACE PBANDI_IDX;

COMMENT ON COLUMN PBANDI_T_PROROGA.ID_ENTITA IS 'Individua la tabella PBANDI_T_CONTRODEDUZ o PBANDI_T_RICHIESTA_INTEGRAZ';

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_STATO_DISTINTA"                                    */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_STATO_DISTINTA (
    ID_STATO_DISTINTA NUMBER(3) NOT NULL,
    DESC_STATO_DISTINTA VARCHAR2(255) NOT NULL,
    DESC_BREVE_STATO_DISTINTA VARCHAR2(20) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_STATO_DISTINTA PRIMARY KEY (ID_STATO_DISTINTA) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_TIPO_DISTINTA"                                       */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_TIPO_DISTINTA (
    ID_TIPO_DISTINTA NUMBER(3) NOT NULL,
    DESC_TIPO_DISTINTA VARCHAR2(255) NOT NULL,
    DESC_BREVE_TIPO_DISTINTA VARCHAR2(20) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_TIPO_DISTINTA PRIMARY KEY (ID_TIPO_DISTINTA) USING INDEX TABLESPACE PBANDI_IDX
);


/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_DISTINTA"                                          */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_DISTINTA (
    ID_DISTINTA NUMBER(8) NOT NULL,
    ID_ENTITA NUMBER(3) NOT NULL,
    ID_TIPO_DISTINTA NUMBER(3) NOT NULL,
    ID_MODALITA_AGEVOLAZIONE NUMBER(3) NOT NULL,
    DESCRIZIONE VARCHAR2(250),
    ID_ESTREMI_BANCARI NUMBER(8),
    ID_STATO_DISTINTA NUMBER(3) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
	CODICE_DISTINTA NUMBER(8),
    CONSTRAINT PK_PBANDI_T_DISTINTA PRIMARY KEY (ID_DISTINTA) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_T_DISTINTA_1 ON PBANDI_T_DISTINTA (ID_MODALITA_AGEVOLAZIONE) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_DISTINTA_2 ON PBANDI_T_DISTINTA (ID_ESTREMI_BANCARI) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_DISTINTA_3 ON PBANDI_T_DISTINTA (ID_ENTITA) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_DISTINTA_4 ON PBANDI_T_DISTINTA (ID_TIPO_DISTINTA) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_DISTINTA_5 ON PBANDI_T_DISTINTA (CODICE_DISTINTA) TABLESPACE PBANDI_IDX;

COMMENT ON COLUMN PBANDI_T_DISTINTA.DESCRIZIONE IS 'Contiene la descrizione della distinta inserita dall''istruttore in dettaglio distinta';

COMMENT ON COLUMN PBANDI_T_DISTINTA.ID_ESTREMI_BANCARI IS 'Indica la banca tesoriera selezionata dall''istruttore in dettaglio distinta. Se  presente una sola banca tesoriera per il Bando/Modalit di agevolazione viene usata di default.';

COMMENT ON COLUMN PBANDI_T_DISTINTA.CODICE_DISTINTA IS 'Codice distinta da migrazione Finpis';

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_DISTINTA_DETT"                                     */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_DISTINTA_DETT (
    ID_DISTINTA_DETT NUMBER(8) NOT NULL,
    ID_DISTINTA NUMBER(8) NOT NULL,
    ID_TARGET NUMBER(8) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
	RIGA_DISTINTA NUMBER(8),
    CONSTRAINT PK_PBANDI_T_DISTINTA_DETT PRIMARY KEY (ID_DISTINTA_DETT) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_T_DISTINTA_DETT_1 ON PBANDI_T_DISTINTA_DETT (ID_DISTINTA) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_DISTINTA_DETT_2 ON PBANDI_T_DISTINTA_DETT (ID_TARGET) TABLESPACE PBANDI_IDX;


/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_PROPOSTA_EROGAZIONE"                               */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_PROPOSTA_EROGAZIONE (
    ID_PROPOSTA NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8) NOT NULL,
    FLAG_CTRL_PRE_EROGAZIONE VARCHAR2(1),
    IMP_LORDO NUMBER(17,2),
    IMP_IRES NUMBER(17,2),
	IMP_DA_EROGARE NUMBER(17,2),
    DT_CONTROLLI DATE,
    ID_MODALITA_AGEVOLAZIONE NUMBER(3),
	DT_VALIDAZIONE_SPESA DATE,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_PROPOSTA_EROGAZ PRIMARY KEY (ID_PROPOSTA) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_T_PROPOSTA_EROGAZ_1 ON PBANDI_T_PROPOSTA_EROGAZIONE (ID_PROGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_PROPOSTA_EROGAZ_2 ON PBANDI_T_PROPOSTA_EROGAZIONE (ID_MODALITA_AGEVOLAZIONE) TABLESPACE PBANDI_IDX;

ALTER TABLE PBANDI_T_PROPOSTA_EROGAZIONE ADD CONSTRAINT CC_PBANDI_T_PROPOSTA_EROGAZ_01 
    CHECK (FLAG_CTRL_PRE_EROGAZIONE IN('S','N'));

COMMENT ON COLUMN PBANDI_T_PROPOSTA_EROGAZIONE.FLAG_CTRL_PRE_EROGAZIONE IS 'Indica se sono stati eseguiti i controlli pre-erogazione. Valorizzata a S al salvataggio dei controlli di pre-erogazione.';

COMMENT ON COLUMN PBANDI_T_PROPOSTA_EROGAZIONE.IMP_LORDO IS 'E'' l''importo lordo da erogare.  E'' inserito manualmente dall''utente in fase di esito della validazione della spesa oppure  inserito automaticamente dal flusso XML che ci porta i dati dall''istruttoria. ';

COMMENT ON COLUMN PBANDI_T_PROPOSTA_EROGAZIONE.IMP_IRES IS 'E'' l''importo IRES.  E'' inserito manualmente dall''utente in fase di esito della validazione della spesa. Viene proposto nella ricerca delle proposte di erogazione.';

COMMENT ON COLUMN PBANDI_T_PROPOSTA_EROGAZIONE.DT_CONTROLLI IS 'E'' la data dei controlli pre-erogazione eseguiti.  Inserita automaticamente al salvataggio dei controlli di pre-erogazione';

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_R_CTRL_NA_EROGAZIONE"                                */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_R_CTRL_NA_EROGAZIONE (
    ID_PROPOSTA NUMBER(8) NOT NULL,
    ID_TIPO_RICHIESTA NUMBER(3) NOT NULL,
    MOTIVAZIONE VARCHAR2(250),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT UK_PBANDI_R_CTRL_NA_EROGAZIONE UNIQUE (ID_PROPOSTA, ID_TIPO_RICHIESTA,  DT_FINE_VALIDITA) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_R_CTRL_NA_EROGAZ_1 ON PBANDI_R_CTRL_NA_EROGAZIONE (ID_TIPO_RICHIESTA)  TABLESPACE PBANDI_IDX;

COMMENT ON TABLE PBANDI_R_CTRL_NA_EROGAZIONE IS 'Tabella di Non Applicabilit del controllo all'' Erogazione';

COMMENT ON COLUMN PBANDI_R_CTRL_NA_EROGAZIONE.MOTIVAZIONE IS 'Motivazione della non applicabilit del controllo';

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_PROP_EROG_CTRL_RNA"                                */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_PROP_EROG_CTRL_RNA
(ID_PROP_EROG_CTRL_RNA number(8) NOT NULL,
  ID_SOGGETTO number (8) NOT NULL,
  ESITO number(1) NOT NULL,
  DT_EMISSIONE  date NOT NULL,
  DT_SCADENZA   date NOT NULL,
  CODICE_UNIVOCO varchar2(20),
  ID_UTENTE_INS	number(8) NOT NULL,
  ID_UTENTE_AGG	number(8),
  DT_INIZIO_VALIDITA date NOT NULL,
  DT_FINE_VALIDITA date,
  CONSTRAINT PK_PBANDI_T_PROP_EROG_CTRL_RNA PRIMARY KEY (ID_PROP_EROG_CTRL_RNA) USING INDEX TABLESPACE PBANDI_IDX
);

COMMENT ON COLUMN PBANDI_T_PROP_EROG_CTRL_RNA.ID_PROP_EROG_CTRL_RNA IS ' E'' l''ID del record.';
COMMENT ON COLUMN PBANDI_T_PROP_EROG_CTRL_RNA.ID_SOGGETTO IS 'Identifica il Soggetto al quale si riferisce il progetto della proposta di erogazione.';
COMMENT ON COLUMN PBANDI_T_PROP_EROG_CTRL_RNA.ESITO IS 'Indica il tipo di esito. 1=positivo; 2=negativo';
COMMENT ON COLUMN PBANDI_T_PROP_EROG_CTRL_RNA.DT_EMISSIONE IS  'E'' la data di richiesta del Deggendorf.';
COMMENT ON COLUMN PBANDI_T_PROP_EROG_CTRL_RNA.DT_SCADENZA  IS 'E'' la data di scadenza del Deggendorf.';
COMMENT ON COLUMN PBANDI_T_PROP_EROG_CTRL_RNA.CODICE_UNIVOCO IS ' Contiene un codice univoco staccato dalla procedura di verifica RNA da inserire nella lettera di erogazione del beneficiario.';
COMMENT ON COLUMN PBANDI_T_PROP_EROG_CTRL_RNA.ID_UTENTE_INS	IS 'E'' l''utente che ha inserito il record.';
COMMENT ON COLUMN PBANDI_T_PROP_EROG_CTRL_RNA.ID_UTENTE_AGG	IS 'E'' l''utente che ha aggiornato il record.';
COMMENT ON COLUMN PBANDI_T_PROP_EROG_CTRL_RNA.DT_INIZIO_VALIDITA	IS 'E'' la data di inizio validit del record.';
COMMENT ON COLUMN PBANDI_T_PROP_EROG_CTRL_RNA.DT_FINE_VALIDITA	IS 'E'' la data di fine validit del record (per la cancellazione logica del record).';

ALTER TABLE PBANDI_T_PROP_EROG_CTRL_RNA ADD CONSTRAINT CC_PBANDI_T_PRO_ER_CTRL_RNA_01 
    CHECK (ESITO IN(1,2));


CREATE INDEX IE1_PBANDI_T_PROP_ER_CTRL_RNA ON PBANDI_T_PROP_EROG_CTRL_RNA (ID_SOGGETTO) TABLESPACE PBANDI_IDX;
CREATE INDEX IE2_PBANDI_T_PROP_ER_CTRL_RNA ON PBANDI_T_PROP_EROG_CTRL_RNA (ID_UTENTE_INS) TABLESPACE PBANDI_IDX;
CREATE INDEX IE3_PBANDI_T_PROP_ER_CTRL_RNA ON PBANDI_T_PROP_EROG_CTRL_RNA (ID_UTENTE_AGG) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_TIPO_ESCUSSIONE"                                   */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_TIPO_ESCUSSIONE (
    ID_TIPO_ESCUSSIONE NUMBER(3) NOT NULL,
    DESC_BREVE_TIPO_ESCUSSIONE VARCHAR2(20) NOT NULL,
    DESC_TIPO_ESCUSSIONE VARCHAR2(255) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_TIPO_ESCUSSIONE PRIMARY KEY (ID_TIPO_ESCUSSIONE) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_STATO_ESCUSSIONE"                                  */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_STATO_ESCUSSIONE (
    ID_STATO_ESCUSSIONE NUMBER(3) NOT NULL,
    DESC_BREVE_STATO_ESCUSSIONE VARCHAR2(20) NOT NULL,
    DESC_STATO_ESCUSSIONE VARCHAR2(255) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_STATO_ESCUSSIONE PRIMARY KEY (ID_STATO_ESCUSSIONE) USING INDEX TABLESPACE PBANDI_IDX
);


/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_ESCUSSIONE"                                        */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_ESCUSSIONE (
    ID_ESCUSSIONE NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8) NOT NULL,
    ID_TIPO_ESCUSSIONE NUMBER(3) NOT NULL,
    ID_STATO_ESCUSSIONE NUMBER(3) NOT NULL,
	--DT_STATO_ESCUSSIONE DATE,
    DT_RIC_RICH_ESCUSSIONE DATE NOT NULL,
	NUM_PROTOCOLLO_RICH VARCHAR2(30),
    DT_NOTIFICA DATE,
	NUM_PROTOCOLLO_NOTIF VARCHAR2(30),
    IMP_RICHIESTO NUMBER(13,2) NOT NULL,
    IMP_APPROVATO NUMBER(13,2),
    CAUSALE_BONIFICO VARCHAR2(4000),
    IBAN_BONIFICO VARCHAR2(40),
    NOTE VARCHAR2(4000),
	--MOTIVO_RICH_INTEGRAZIONE  VARCHAR2(200),
	ID_DISTINTA NUMBER(8),
	FLAG_ESITO VARCHAR2(1),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8)  NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
	ID_PROPOSTA_EROGAZIONE NUMBER(8),
    CONSTRAINT PK_PBANDI_T_ESCUSSIONE PRIMARY KEY (ID_ESCUSSIONE) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_T_ESCUSSIONE_1 ON PBANDI_T_ESCUSSIONE (ID_PROGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_ESCUSSIONE_2 ON PBANDI_T_ESCUSSIONE (ID_TIPO_ESCUSSIONE) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_ESCUSSIONE_3 ON PBANDI_T_ESCUSSIONE (ID_STATO_ESCUSSIONE) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_ESCUSSIONE_4 ON PBANDI_T_ESCUSSIONE (ID_DISTINTA) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_ESCUSSIONE_5 ON PBANDI_T_ESCUSSIONE (ID_PROPOSTA_EROGAZIONE) TABLESPACE PBANDI_IDX;

ALTER TABLE PBANDI_T_ESCUSSIONE ADD CONSTRAINT CC_PBANDI_T_ESCUSSIONE_01 
    CHECK (FLAG_ESITO IN ('P','N'));
	
COMMENT ON COLUMN PBANDI_T_ESCUSSIONE.FLAG_ESITO IS 'P=Esito positivo, N=Esito negativo';

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_TIPO_ITER"                                         */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_TIPO_ITER (
    ID_TIPO_ITER NUMBER(3) NOT NULL,
    DESC_BREVE_TIPO_ITER VARCHAR2(40) NOT NULL,
    DESC_TIPO_ITER VARCHAR2(200) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_TIPO_ITER PRIMARY KEY (ID_TIPO_ITER) USING INDEX TABLESPACE PBANDI_IDX
);


/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_STATO_ITER"                                        */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_STATO_ITER (
    ID_STATO_ITER NUMBER(3) NOT NULL,
    DESC_BREVE_STATO_ITER VARCHAR2(20) NOT NULL,
    DESC_STATO_ITER VARCHAR2(200) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_STATO_ITER PRIMARY KEY (ID_STATO_ITER) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_INCARICO"                                          */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_INCARICO (
    ID_INCARICO NUMBER(3) NOT NULL,
    DESC_BREVE_INCARICO VARCHAR2(20) NOT NULL,
    DESC_INCARICO VARCHAR2(200) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_INCARICO PRIMARY KEY (ID_INCARICO) USING INDEX TABLESPACE PBANDI_IDX
);


/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_R_INCARICO_SOGGETTO"                                 */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_R_INCARICO_SOGGETTO (
    ID_INCARICO NUMBER(3) NOT NULL,
    ID_SOGGETTO NUMBER(8) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_R_INCARICO_SOGGETTO PRIMARY KEY (ID_INCARICO, ID_SOGGETTO) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IDX_PBANDI_R_INCARICO_SOGG_1 ON PBANDI_R_INCARICO_SOGGETTO (ID_SOGGETTO) TABLESPACE PBANDI_IDX;


/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_R_TIPO_STATO_ITER"                                   */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_R_TIPO_STATO_ITER (
    ID_TIPO_ITER NUMBER(3) NOT NULL,
    ID_STATO_ITER NUMBER(3) NOT NULL,
    ORDINE NUMBER(2) NOT NULL,
    ID_INCARICO NUMBER(3),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_R_TIPO_STATO_ITER PRIMARY KEY (ID_TIPO_ITER, ID_STATO_ITER) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_R_TIPO_STATO_ITER_1 ON PBANDI_R_TIPO_STATO_ITER (ID_INCARICO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_R_TIPO_STATO_ITER_2 ON PBANDI_R_TIPO_STATO_ITER (ID_STATO_ITER) TABLESPACE PBANDI_IDX;


/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_WORK_FLOW"                                         */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_WORK_FLOW (
    ID_WORK_FLOW NUMBER(8) NOT NULL,
    ID_TIPO_ITER NUMBER(3) NOT NULL,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_WORK_FLOW PRIMARY KEY (ID_WORK_FLOW) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_T_WORK_FLOW_1 ON PBANDI_T_WORK_FLOW (ID_TIPO_ITER);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_DETT_WORK_FLOW"                                    */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_DETT_WORK_FLOW (
    ID_DETT_WORK_FLOW NUMBER(8) NOT NULL,
    ID_WORK_FLOW NUMBER(8) NOT NULL,
    ID_STATO_ITER NUMBER(3) NOT NULL,
    DT_APPROVAZIONE DATE,
    DT_ANNULLAMENTO DATE,
    MOTIVAZIONE VARCHAR2(4000),
    ID_UTENTE_INS NUMBER NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_DETT_WORK_FLOW PRIMARY KEY (ID_DETT_WORK_FLOW) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_T_DETT_WORK_FLOW_1 ON PBANDI_T_DETT_WORK_FLOW (ID_WORK_FLOW) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_DETT_WORK_FLOW_2 ON PBANDI_T_DETT_WORK_FLOW (ID_STATO_ITER) TABLESPACE PBANDI_IDX;


/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_WORK_FLOW_ENTITA"                                  */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_WORK_FLOW_ENTITA (
    ID_WORK_FLOW_ENTITA NUMBER(8) NOT NULL,
    ID_WORK_FLOW NUMBER(8) NOT NULL,
    ID_ENTITA NUMBER(3) NOT NULL,
    ID_TARGET NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8),
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_WORK_FLOW_ENTITA PRIMARY KEY (ID_WORK_FLOW_ENTITA) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IDX_PBANDI_T_WORK_FLOW_ENTIT_1 ON PBANDI_T_WORK_FLOW_ENTITA (ID_WORK_FLOW) TABLESPACE PBANDI_IDX;

CREATE INDEX IDX_PBANDI_T_WORK_FLOW_ENTIT_2 ON PBANDI_T_WORK_FLOW_ENTITA (ID_ENTITA,ID_TARGET) TABLESPACE PBANDI_IDX;

CREATE INDEX IDX_PBANDI_T_WORK_FLOW_ENTIT_3 ON PBANDI_T_WORK_FLOW_ENTITA (ID_PROGETTO) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_R_BANDO_MOD_AG_ESTR_BAN"                             */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_R_BANDO_MOD_AG_ESTR_BAN (
    ID_BANDO_MOD_AG_ESTR_BAN NUMBER(8) NOT NULL,
    ID_MODALITA_AGEVOLAZIONE NUMBER(3) NOT NULL,
    ID_BANDO NUMBER(8) NOT NULL,
    ID_ESTREMI_BANCARI NUMBER(8) NOT NULL,
    MOLTIPLICATORE VARCHAR2(8),
	TIPOLOGIA_CONTO  VARCHAR2(50),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
	CODICE_FONDO_FINPIS NUMBER(8),
    CONSTRAINT PK_PBANDI_R_BAN_MOD_AG_EST_BAN PRIMARY KEY (ID_BANDO_MOD_AG_ESTR_BAN)  USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_R_BANDI_MOD_AG_BAN_1 ON PBANDI_R_BANDO_MOD_AG_ESTR_BAN (ID_ESTREMI_BANCARI) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_NOTE"                                              */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_NOTE
(
  ID_NOTA                       NUMBER(8)       NOT NULL,
  ID_SOGGETTO_BENEFICIARIO      NUMBER(8),
  ID_PROGETTO                   NUMBER(8),
  TESTO_NOTA                    CLOB NOT NULL,
  ID_MODALITA_AGEVOLAZIONE      NUMBER(3),
  FLAG_VISIBILITA_BENEFICIARIO  VARCHAR2(1 BYTE),
  DT_INIZIO_VALIDITA            DATE            NOT NULL,
  DT_FINE_VALIDITA              DATE,
  ID_UTENTE_INS                 NUMBER(8)       NOT NULL,
  ID_UTENTE_AGG                 NUMBER(8),
  CONSTRAINT PK_PBANDI_T_NOTE PRIMARY KEY (ID_NOTA) USING INDEX TABLESPACE PBANDI_IDX
)
TABLESPACE PBANDI_TBL;

CREATE INDEX IE_PBANDI_T_NOTE_1 ON PBANDI_T_NOTE (ID_SOGGETTO_BENEFICIARIO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_NOTE_2 ON PBANDI_T_NOTE (ID_PROGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_NOTE_3 ON PBANDI_T_NOTE (ID_MODALITA_AGEVOLAZIONE) TABLESPACE PBANDI_IDX;

ALTER TABLE PBANDI_T_NOTE ADD CONSTRAINT CC_PBANDI_T_NOTE_01 
    CHECK (FLAG_VISIBILITA_BENEFICIARIO='S');

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_DELIBERA_PROGETTI"                                 */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_DELIBERA_PROGETTI (
    ID_DELIBERA NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8),
    OGGETTO_DELIBERA VARCHAR2(4000) NOT NULL,
    DT_DELIBERA DATE,
    DT_ANNULLAMENTO DATE,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    CONSTRAINT PK_PBANDI_T_DELIBERA_PROGETTI PRIMARY KEY (ID_DELIBERA) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_T_DELIBERA_PROG_1 ON PBANDI_T_DELIBERA_PROGETTI (ID_PROGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_DELIBERA_PROG_2 ON PBANDI_T_DELIBERA_PROGETTI (DT_DELIBERA) TABLESPACE PBANDI_IDX;

-- PBANDI_D_TIPO_PERIODO_AMMORTAMENTO
CREATE TABLE PBANDI_D_TIPO_PERIODO_AMMORT
(ID_TIPO_PERIODO_AMMORTAMENTO INTEGER,
 DESCR_BREVE_TIPO_PERIOD_AMM VARCHAR2(1),
 DESCRIZIONE_TIPO_PERIOD_AMM VARCHAR2(100),
 DT_INIZIO_VALIDITA DATE NOT NULL,
 DT_FINE_VALIDITA DATE,
 CONSTRAINT PK_PBANDI_D_TIPO_PERIODO_AMM PRIMARY KEY (ID_TIPO_PERIODO_AMMORTAMENTO) USING INDEX TABLESPACE PBANDI_IDX
);

-- pbandi_d_frequenza_ammort
CREATE TABLE pbandi_d_frequenza_ammort
(ID_FREQUENZA_AMMORTAMENTO INTEGER,
 DESCR_BREVE_FREQUENZA_AMMORT VARCHAR2(3),
 DESCRIZIONE_FREQUENZA_AMMORT VARCHAR2(100),
 DT_INIZIO_VALIDITA DATE NOT NULL,
 DT_FINE_VALIDITA DATE,
 CONSTRAINT PK_pbandi_d_frequenza_amm PRIMARY KEY (ID_FREQUENZA_AMMORTAMENTO) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_AMMORTAMENTO_PROGETTI"                             */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_AMMORTAMENTO_PROGETTI (
    ID_AMMORT_PROGETTI NUMBER(8) NOT NULL,
    ID_DELIBERA NUMBER(8) NOT NULL,
    MM_AMMORTAMENTO NUMBER(3) NOT NULL,
    MM_PREAMMORTAMENTO NUMBER(3),
    ID_TIPO_TASSO NUMBER(3),
    PERC_SPREAD NUMBER(5,2),
    ID_FREQUENZA_AMMORTAMENTO NUMBER(3),
    --PERC_FINANZ_BANCHE  NUMBER(5,2),
    PERC_INTERESSI NUMBER(5,2),
    --GARANZIE VARCHAR2(4000),
    --NOTE VARCHAR2(4000),
    ID_TIPO_CALC_AMM NUMBER(3),
    ID_TASSO_AMM NUMBER(3),
	ID_TIPO_PERIODO_AMMORTAMENTO INTEGER,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    CONSTRAINT PK_PBANDI_T_AMMORTAM_PROG PRIMARY KEY (ID_AMMORT_PROGETTI) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_T_AMMORTAM_PROG_1 ON PBANDI_T_AMMORTAMENTO_PROGETTI (ID_DELIBERA) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_AMMORTAM_PROG_2 ON PBANDI_T_AMMORTAMENTO_PROGETTI (ID_TIPO_TASSO) TABLESPACE PBANDI_IDX;
CREATE INDEX IE_PBANDI_T_AMMORTAM_PROG_3 ON PBANDI_T_AMMORTAMENTO_PROGETTI (ID_TIPO_CALC_AMM) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_AMMORTAM_PROG_4 ON PBANDI_T_AMMORTAMENTO_PROGETTI (ID_TASSO_AMM) TABLESPACE PBANDI_IDX;
CREATE INDEX IE_PBANDI_T_AMMORTAM_PROG_5 ON pbandi_t_ammortamento_progetti (ID_TIPO_PERIODO_AMMORTAMENTO)  TABLESPACE PBANDI_IDX;
CREATE INDEX IE_PBANDI_T_AMMORTAM_PROG_6 ON PBANDI_T_AMMORTAMENTO_PROGETTI (ID_FREQUENZA_AMMORTAMENTO)  TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_TIPO_TASSI"                                        */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_TIPO_TASSI (
    ID_TIPO_TASSO NUMBER(3) NOT NULL,
    DESC_BREVE_TIPO_TASSO VARCHAR2(20),
    DESC_TIPO_TASSO VARCHAR2(200),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_TIPO_TASSI PRIMARY KEY (ID_TIPO_TASSO) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_TIPO_CALCOLO_AMM"                                  */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_TIPO_CALCOLO_AMM (
    ID_TIPO_CALC_AMM NUMBER(3) NOT NULL,
    DESC_BREVE_TIPO_CALC_AMM VARCHAR2(20) NOT NULL,
    DESC_TIPO_CALC_AMM VARCHAR2(255) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_TIPO_CALCOLO_AMM PRIMARY KEY (ID_TIPO_CALC_AMM) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_TASSO_AMM"                                         */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_TASSO_AMM (
    ID_TASSO_AMM NUMBER(3) NOT NULL,
    DESC_BREVE_TASSO_AMM VARCHAR2(20) NOT NULL,
    DESC_TASSO_AMM VARCHAR2(255) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_TASSO_AMM PRIMARY KEY (ID_TASSO_AMM) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_RNA_PROGETTO"                                      */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_RNA_PROGETTO (
    ID_RNA_PROGETTO NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8) NOT NULL,
    CODICE_BANDO_RNA NUMBER,
    ID_CONCESSIONE_GEST VARCHAR2(60) NOT NULL,
    ID_COMP_AIUTO_GEST VARCHAR2(100) NOT NULL,
    COR NUMBER NOT NULL,
    COVAR NUMBER,
    COR_COLLEGTO NUMBER,
    DT_ESITO_VALIDAZIONE DATE,
    DT_RICH_ANNULLAMENTO DATE,
    ESITO_CONFERMA_REG VARCHAR2(40),
    DT_CONFERMA_REG DATE,
    ID_PROVVEDIMENTO NUMBER(8),
    ID_CARICAMENTO NUMBER(8),
    COD_TIPO_VARIAZIONE VARCHAR2(2),
    ID_RICHIESTA_RNA NUMBER(8),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    CONSTRAINT PK_PBANDI_T_RNA_PROGETTO PRIMARY KEY (ID_RNA_PROGETTO)  USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_T_RNA_PROGETTO_1 ON PBANDI_T_RNA_PROGETTO (ID_PROGETTO ASC)  TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_RNA_PROGETTO_2 ON PBANDI_T_RNA_PROGETTO (ID_UTENTE_INS ASC)  TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_RNA_PROGETTO_3 ON PBANDI_T_RNA_PROGETTO (ID_UTENTE_AGG ASC)  TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_RNA_PROGETTO_4 ON PBANDI_T_RNA_PROGETTO (COD_TIPO_VARIAZIONE ASC)  TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_RNA_PROGETTO_5 ON PBANDI_T_RNA_PROGETTO (ID_CARICAMENTO ASC)  TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_RNA_AGEVOLAZIONE"                                  */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_RNA_AGEVOLAZIONE (
    ID_RNA_AGEVOLAZIONE INTEGER NOT NULL,
    ID_RNA_PROGETTO NUMBER(8) NOT NULL,
    ID_MODALITA_AGEVOLAZIONE NUMBER(3) NOT NULL,
    ID_STRUM_AIUTO_GEST VARCHAR2(100) NOT NULL,
    IMPORTO_NOMINALE NUMBER(16,2) NOT NULL,
    IMPORTO_AGEVOLAZIONE NUMBER(16,2) NOT NULL,
    INTENSITA_AIUTO NUMBER(16,2) NOT NULL,
    ESITO_REG VARCHAR2(40),
    DT_ESITO DATE,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    CONSTRAINT PK_PBANDI_T_RNA_AGEVOLAZIONE PRIMARY KEY (ID_RNA_AGEVOLAZIONE)   USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_T_RNA_AGEV_1 ON PBANDI_T_RNA_AGEVOLAZIONE (ID_RNA_PROGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_RNA_AGEV_2 ON PBANDI_T_RNA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE)  TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_RNA_AGEV_3 ON PBANDI_T_RNA_AGEVOLAZIONE (ID_UTENTE_INS)  TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_RNA_AGEV_4 ON PBANDI_T_RNA_AGEVOLAZIONE (ID_UTENTE_AGG)  TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_RNA_COSTO_GEST"                                    */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_RNA_COSTO_GEST (
    ID_RNA_COST_GEST INTEGER NOT NULL,
    ID_RNA_PROGETTO NUMBER(8) NOT NULL,
    ID_RIGO_CONTO_ECONOMICO NUMBER(8),
    ID_COSTO_GEST VARCHAR2(100) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    CONSTRAINT PK_PBANDI_T_RNA_COSTO_GEST PRIMARY KEY (ID_RNA_COST_GEST)   USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_T_RNA_COSTO_GEST_1 ON PBANDI_T_RNA_COSTO_GEST (ID_RNA_PROGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_RNA_COSTO_GEST_2 ON PBANDI_T_RNA_COSTO_GEST (ID_RIGO_CONTO_ECONOMICO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_RNA_COSTO_GEST_3 ON PBANDI_T_RNA_COSTO_GEST (ID_UTENTE_INS) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_RNA_COSTO_GEST_4 ON PBANDI_T_RNA_COSTO_GEST (ID_UTENTE_AGG) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_ACTIVEINFO_METADATA"                               */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_ACTIVEINFO_METADATA (
    ID_METADATA NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8),
    NOME_FILE VARCHAR2(200),
    ID_DOC VARCHAR2(20),
    TIPO_DOC VARCHAR2(50),
    PROTOCOLLO VARCHAR2(50),
    DATA_RICEVIMENTO DATE,
    DATA_LETTERA DATE,
    TITOLARIO VARCHAR2(100),
    OPERATORE VARCHAR2(50),
    MITTENTE_DESTINATARIO VARCHAR2(4000),
    OGGETTO VARCHAR2(4000),
    FONDI_COMMESSA VARCHAR2(4000),
    SERVIZIO_DI_LINEA VARCHAR2(4000),
	CODICE_VISUALIZZATO    VARCHAR2(100),	
    CONSTRAINT PK_PBANDI_T_ACTIVEINFO_METADA PRIMARY KEY (ID_METADATA) USING INDEX TABLESPACE PBANDI_IDX
);

COMMENT ON TABLE PBANDI_T_ACTIVEINFO_METADATA IS 'Tabella di migrazione documentale Finpis';

CREATE INDEX IE1_PBANDI_T_ACTIVEINFO_METADA ON PBANDI_T_ACTIVEINFO_METADATA (ID_PROGETTO) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_L_LOG_FILE_AFAI"                                     */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_L_LOG_FILE_AFAI (
    ID_LOG NUMBER(8) NOT NULL,
    ID_METADATA NUMBER(8),
    FLAG_FILE_ELABORATO VARCHAR2(1) NOT NULL,
    REPORT_ELABORAZIONE VARCHAR2(4000),
    DATA_FINE_ELABORAZIONE DATE,
    PATH_FILES VARCHAR2(255),
    CONSTRAINT PK_PBANDI_L_LOG_FILE_AFAI PRIMARY KEY (ID_LOG) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE1_PBANDI_L_LOG_FILE_AFAI_1 ON PBANDI_L_LOG_FILE_AFAI (ID_METADATA) TABLESPACE PBANDI_IDX;

ALTER TABLE PBANDI_L_LOG_FILE_AFAI ADD CONSTRAINT CC_PBANDI_L_LOG_FILE_AFAI_01
    CHECK (flag_file_elaborato in ('S','N'));

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_TIPOLOGIA_REVOCA"                                  */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_TIPOLOGIA_REVOCA (
    ID_TIPOLOGIA_REVOCA NUMBER(3) NOT NULL,
    DESC_BREVE_TIPOLOGIA_REVOCA VARCHAR2(20) NOT NULL,
    DESC_TIPOLOGIA_REVOCA VARCHAR2(255) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_TIPOLOGIA_REVOCA PRIMARY KEY (ID_TIPOLOGIA_REVOCA) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_STATO_REVOCA"                                      */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_STATO_REVOCA (
    ID_STATO_REVOCA NUMBER(3) NOT NULL,
    DESC_BREVE_STATO_REVOCA VARCHAR2(20) NOT NULL,
    DESC_STATO_REVOCA VARCHAR2(255) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_STATO_REVOCA PRIMARY KEY (ID_STATO_REVOCA) USING INDEX TABLESPACE PBANDI_IDX
);


/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_ATTIVITA_REVOCA"                                   */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_ATTIVITA_REVOCA (
    ID_ATTIVITA_REVOCA NUMBER(3) NOT NULL,
    DESC_BREVE_ATTIVITA_REVOCA VARCHAR2(20) NOT NULL,
    DESC_ATTIVITA_REVOCA VARCHAR2(255) NOT NULL,
    ID_TIPOLOGIA_REVOCA NUMBER(3) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_ATTIVITA_REVOCA PRIMARY KEY (ID_ATTIVITA_REVOCA) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_R_STATO_TIPO_REVOCA"                                 */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_R_STATO_TIPO_REVOCA (
    ID_TIPOLOGIA_REVOCA NUMBER(3) NOT NULL,
    ID_STATO_REVOCA NUMBER(3) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_R_STATO_TIPO_REVOCA PRIMARY KEY (ID_TIPOLOGIA_REVOCA, ID_STATO_REVOCA) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_GESTIONE_REVOCA"                                   */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_GESTIONE_REVOCA (
    ID_GESTIONE_REVOCA NUMBER(8) NOT NULL,
    NUMERO_REVOCA NUMBER(8) NOT NULL,
    ID_TIPOLOGIA_REVOCA NUMBER(3) NOT NULL,
    ID_PROGETTO NUMBER(8) NOT NULL,
    ID_CAUSALE_BLOCCO NUMBER(3) NOT NULL,
    ID_CATEG_ANAGRAFICA NUMBER(3),
    DT_GESTIONE DATE,
    NUM_PROTOCOLLO VARCHAR2(100),
    FLAG_ORDINE_RECUPERO VARCHAR2(1),
    ID_MANCATO_RECUPERO NUMBER(8),
    ID_STATO_REVOCA NUMBER(3) NOT NULL,
    DT_STATO_REVOCA DATE NOT NULL,
    DT_NOTIFICA DATE,
    GG_RISPOSTA NUMBER(3),
    FLAG_PROROGA VARCHAR2(1),
    IMP_DA_REVOCARE_CONTRIB NUMBER(17,2),
    IMP_DA_REVOCARE_FINANZ NUMBER(17,2),
    IMP_DA_REVOCARE_GARANZIA NUMBER(17,2),
    FLAG_DETERMINA VARCHAR2(1),
    ESTREMI VARCHAR2(250),
    DT_DETERMINA DATE,
    NOTE VARCHAR2(4000),
    ID_ATTIVITA_REVOCA NUMBER(3),
    DT_ATTIVITA DATE,
    ID_MOTIVO_REVOCA NUMBER(3),
    FLAG_CONTRIB_REVOCA VARCHAR2(1),
    FLAG_CONTRIB_MINOR_SPESE VARCHAR2(1),
    FLAG_CONTRIB_DECURTAZ VARCHAR2(1),
    FLAG_FINANZ_REVOCA VARCHAR2(1),
    FLAG_FINANZ_MINOR_SPESE VARCHAR2(1),
    FLAG_FINANZ_DECURTAZ VARCHAR2(1),
    FLAG_GARANZIA_REVOCA VARCHAR2(1),
    FLAG_GARANZIA_MINOR_SPESE VARCHAR2(1),
    FLAG_GARANZIA_DECURTAZ VARCHAR2(1),
    IMP_CONTRIB_REVOCA_NO_RECU NUMBER(17,2),
    IMP_CONTRIB_REVOCA_RECU NUMBER(17,2),
    IMP_CONTRIB_INTERESSI NUMBER(17,2),
    IMP_FINANZ_REVOCA_NO_RECU NUMBER(17,2),
    IMP_FINANZ_REVOCA_RECU NUMBER(17,2),
    IMP_FINANZ_INTERESSI NUMBER(17,2),
    IMP_FINANZ_PRERECUPERO NUMBER(17,2),
    IMP_GARANZIA_REVOCA_NO_RECU NUMBER(17,2),
    IMP_GARANZIA_REVOCA_RECUPERO NUMBER(17,2),
    IMP_GARANZIA_INTERESSI NUMBER(17,2),
    IMP_GARANZIA_PRERECUPERO NUMBER(17,2),
	--
	IMP_IRES  NUMBER(17,2),
	IMP_DA_EROGARE_CONTRIBUTO  NUMBER(17,2),
	ID_DICHIARAZIONE_SPESA NUMBER(8),
	--
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
	COVAR			 INTEGER,
	IMP_DA_EROGARE_FINANZIAMENTO NUMBER(17,2),
    CONSTRAINT PK_PBANDI_T_GESTIONE_REVOCA PRIMARY KEY (ID_GESTIONE_REVOCA) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_T_GESTIONE_REVOCA_1 ON PBANDI_T_GESTIONE_REVOCA (ID_PROGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_GESTIONE_REVOCA_2 ON PBANDI_T_GESTIONE_REVOCA (ID_CATEG_ANAGRAFICA) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_GESTIONE_REVOCA_3 ON PBANDI_T_GESTIONE_REVOCA (ID_MANCATO_RECUPERO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_GESTIONE_REVOCA_4 ON PBANDI_T_GESTIONE_REVOCA (ID_STATO_REVOCA) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_GESTIONE_REVOCA_5 ON PBANDI_T_GESTIONE_REVOCA (ID_ATTIVITA_REVOCA) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_GESTIONE_REVOCA_6 ON PBANDI_T_GESTIONE_REVOCA (ID_TIPOLOGIA_REVOCA) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_GESTIONE_REVOCA_7 ON PBANDI_T_GESTIONE_REVOCA (NUMERO_REVOCA) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_GESTIONE_REVOCA_8 ON PBANDI_T_GESTIONE_REVOCA (ID_CAUSALE_BLOCCO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_GESTIONE_REVOCA_9 ON PBANDI_T_GESTIONE_REVOCA (ID_MOTIVO_REVOCA) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_GESTIONE_REVOCA_10 ON PBANDI_T_GESTIONE_REVOCA (ID_DICHIARAZIONE_SPESA ) TABLESPACE PBANDI_IDX;

ALTER TABLE PBANDI_T_GESTIONE_REVOCA ADD CONSTRAINT CC_PBANDI_T_GESTIONE_REVOCA_01 
    CHECK (FLAG_CONTRIB_DECURTAZ='S');

ALTER TABLE PBANDI_T_GESTIONE_REVOCA ADD CONSTRAINT CC_PBANDI_T_GESTIONE_REVOCA_02 
    CHECK (FLAG_PROROGA='S');

ALTER TABLE PBANDI_T_GESTIONE_REVOCA ADD CONSTRAINT CC_PBANDI_T_GESTIONE_REVOCA_03 
    CHECK (FLAG_DETERMINA='S');

ALTER TABLE PBANDI_T_GESTIONE_REVOCA ADD CONSTRAINT CC_PBANDI_T_GESTIONE_REVOCA_04 
    CHECK (FLAG_CONTRIB_REVOCA='S');

ALTER TABLE PBANDI_T_GESTIONE_REVOCA ADD CONSTRAINT CC_PBANDI_T_GESTIONE_REVOCA_05 
    CHECK (FLAG_CONTRIB_MINOR_SPESE='S');

ALTER TABLE PBANDI_T_GESTIONE_REVOCA ADD CONSTRAINT CC_PBANDI_T_GESTIONE_REVOCA_06 
    CHECK (FLAG_FINANZ_REVOCA='S');

ALTER TABLE PBANDI_T_GESTIONE_REVOCA ADD CONSTRAINT CC_PBANDI_T_GESTIONE_REVOCA_07 
    CHECK (FLAG_FINANZ_MINOR_SPESE='S');

ALTER TABLE PBANDI_T_GESTIONE_REVOCA ADD CONSTRAINT CC_PBANDI_T_GESTIONE_REVOCA_08 
    CHECK (FLAG_FINANZ_DECURTAZ='S');

ALTER TABLE PBANDI_T_GESTIONE_REVOCA ADD CONSTRAINT CC_PBANDI_T_GESTIONE_REVOCA_09 
    CHECK (FLAG_GARANZIA_REVOCA='S');

ALTER TABLE PBANDI_T_GESTIONE_REVOCA ADD CONSTRAINT CC_PBANDI_T_GESTIONE_REVOCA_10 
    CHECK (FLAG_GARANZIA_MINOR_SPESE='S');

ALTER TABLE PBANDI_T_GESTIONE_REVOCA ADD CONSTRAINT CC_PBANDI_T_GESTIONE_REVOCA_11 
    CHECK (FLAG_GARANZIA_DECURTAZ='S');

ALTER TABLE PBANDI_T_GESTIONE_REVOCA ADD CONSTRAINT CC_PBANDI_T_GESTIONE_REVOCA_12 
    CHECK (FLAG_ORDINE_RECUPERO='S');

COMMENT ON COLUMN PBANDI_T_GESTIONE_REVOCA.NUMERO_REVOCA IS 'E'' il numero della revoca. E'' univoco per ciascuna revoca e va sempre preso a riferimento insieme all'' ID_TIPOLOGIA_REVOCA perch individua se si tratti della proposta, del procedimento o del provvedimento di una specifica revoca';

COMMENT ON COLUMN PBANDI_T_GESTIONE_REVOCA.DT_NOTIFICA IS 'E'' la data di ricezione delle notifiche al beneficiario per il calcolo della data di scadenza';

COMMENT ON COLUMN PBANDI_T_GESTIONE_REVOCA.GG_RISPOSTA IS 'Indica i giorni disponibili al beneficiario per calcolare la scadenza';

COMMENT ON COLUMN PBANDI_T_GESTIONE_REVOCA.FLAG_PROROGA IS 'Indica se  stata richiesta da beneficiario una proroga per controdedurre o per inviare le integrazioni a un procedimento di revoca';

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_STATO_CONTRODEDUZ"                                 */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_STATO_CONTRODEDUZ (
    ID_STATO_CONTRODEDUZ NUMBER(3) NOT NULL,
    DESC_STATO_CONTRODEDUZ VARCHAR2(255) NOT NULL,
    DESC_BREVE_STATO_CONTRODEDUZ VARCHAR2(20) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_STATO_CONTRODEDUZ PRIMARY KEY (ID_STATO_CONTRODEDUZ) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_ATTIV_CONTRODEDUZ"                                 */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_ATTIV_CONTRODEDUZ (
    ID_ATTIV_CONTRODEDUZ NUMBER(3) NOT NULL,
    DESC_ATTIV_CONTRODEDUZ VARCHAR2(255) NOT NULL,
    DESC_BREVE_ATTIV_CONTRODEDUZ VARCHAR2(20) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_ATTIV_CONTRODEDUZ PRIMARY KEY (ID_ATTIV_CONTRODEDUZ) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_STATO_CONTESTAZ"                                   */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_STATO_CONTESTAZ (
    ID_STATO_CONTESTAZ NUMBER(3) NOT NULL,
    DESC_STATO_CONTESTAZ VARCHAR2(255) NOT NULL,
    DESC_BREVE_STATO_CONTESTAZ VARCHAR2(20) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_STATO_CONTESTAZ PRIMARY KEY (ID_STATO_CONTESTAZ) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_CONTRODEDUZ"                                       */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_CONTRODEDUZ (
    ID_CONTRODEDUZ NUMBER(8) NOT NULL,
    NUMERO_CONTRODEDUZ NUMBER(8) NOT NULL,
    ID_ENTITA NUMBER(3) NOT NULL,
    ID_TARGET NUMBER(8) NOT NULL,
    ID_STATO_CONTRODEDUZ NUMBER(3) NOT NULL,
    DT_STATO_CONTRODEDUZ DATE NOT NULL,
    ID_ATTIV_CONTRODEDUZ NUMBER(3),
    DT_ATTIV_CONTRODEDUZ DATE,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_CONTRODEDUZ PRIMARY KEY (ID_CONTRODEDUZ) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_T_CONTRODEDUZ_1 ON PBANDI_T_CONTRODEDUZ (NUMERO_CONTRODEDUZ) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_CONTRODEDUZ_2 ON PBANDI_T_CONTRODEDUZ (ID_ENTITA) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_CONTRODEDUZ_3 ON PBANDI_T_CONTRODEDUZ (ID_TARGET) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_CONTRODEDUZ_4 ON PBANDI_T_CONTRODEDUZ (ID_STATO_CONTRODEDUZ) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_CONTRODEDUZ_5 ON PBANDI_T_CONTRODEDUZ (ID_ATTIV_CONTRODEDUZ) TABLESPACE PBANDI_IDX;

COMMENT ON COLUMN PBANDI_T_CONTRODEDUZ.ID_ENTITA IS 'Individua la tabella PBANDI_T_GESTIONE_REVOCA';

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_CONTESTAZ"                                         */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_CONTESTAZ (
    ID_CONTESTAZ NUMBER(8) NOT NULL,
    NUMERO_CONTESTAZ NUMBER(8),
    ID_ENTITA NUMBER(3) NOT NULL,
    ID_TARGET NUMBER(8) NOT NULL,
    ID_STATO_CONTESTAZ NUMBER(3) NOT NULL,
    DT_STATO_CONTESTAZ DATE,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    ID_UTENTE_INS NUMBER(8) NOT NULL,
    ID_UTENTE_AGG NUMBER(8),
    DT_INSERIMENTO DATE NOT NULL,
    DT_AGGIORNAMENTO DATE,
    CONSTRAINT PK_PBANDI_T_CONTESTAZ PRIMARY KEY (ID_CONTESTAZ) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_T_CONTESTAZ_1 ON PBANDI_T_CONTESTAZ (NUMERO_CONTESTAZ) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_CONTESTAZ_2 ON PBANDI_T_CONTESTAZ (ID_ENTITA) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_CONTESTAZ_3 ON PBANDI_T_CONTESTAZ (ID_TARGET) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_CONTESTAZ_4 ON PBANDI_T_CONTESTAZ (ID_STATO_CONTESTAZ) TABLESPACE PBANDI_IDX;

COMMENT ON COLUMN PBANDI_T_CONTESTAZ.ID_ENTITA IS 'Individua la tabella PBANDI_T_GESTIONE_REVOCA';

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_MONIT_TEMPI"                                       */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_MONIT_TEMPI (
    ID_MONIT_TEMPI NUMBER(8) NOT NULL,
    ID_PROGETTO NUMBER(8) NOT NULL,
    DT_DECORRENZA DATE NOT NULL,
    DT_FINE DATE,
    ID_ENTITA NUMBER(3) NOT NULL,
    ID_TARGET NUMBER(8) NOT NULL,
    DESCRIZIONE VARCHAR2(4000),
    ID_PARAM_MONIT_BANDO_LINEA NUMBER(8),
    NUM_GIORNI NUMBER(4),
    ID_MONIT_TEMPI_SOSPESO NUMBER(8),
    CONSTRAINT PK_PBANDI_T_MONIT_TEMPI PRIMARY KEY (ID_MONIT_TEMPI) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_T_MONIT_TEMPI_1 ON PBANDI_T_MONIT_TEMPI (ID_PROGETTO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_MONIT_TEMPI_2 ON PBANDI_T_MONIT_TEMPI (ID_ENTITA,ID_TARGET) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_MONIT_TEMPI_3 ON PBANDI_T_MONIT_TEMPI (ID_PARAM_MONIT_BANDO_LINEA) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_MONIT_TEMPI_4 ON PBANDI_T_MONIT_TEMPI (ID_MONIT_TEMPI_SOSPESO) TABLESPACE PBANDI_IDX;

COMMENT ON COLUMN PBANDI_T_MONIT_TEMPI.DT_DECORRENZA IS ' la data dell''evento scatenante da cui decorrono i termini ';

COMMENT ON COLUMN PBANDI_T_MONIT_TEMPI.DT_FINE IS ' la data dell''evento che interrompe la decorrenza dei termini';

COMMENT ON COLUMN PBANDI_T_MONIT_TEMPI.ID_PARAM_MONIT_BANDO_LINEA IS ' l''identificativo della PBANDI_R_PARAMETRI_MONIT_BANDO_LINEA corrispondente all''associazione tra parametro e bando-linea applicata all''evento corrente';

COMMENT ON COLUMN PBANDI_T_MONIT_TEMPI.NUM_GIORNI IS 'se null recuperarlo dinamicamente nella vista nel range data inizio e data fine validit della tabella di configurazione che associa bando-linea al parametro applicato  ';

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_C_PARAMETRI_MONIT"                                   */
/* ---------------------------------------------------------------------- */
/*
-- Commentato perch gi eseguita in produzione 24/10/2023

CREATE TABLE PBANDI_C_PARAMETRI_MONIT (
    ID_PARAMETRO_MONIT NUMBER(3) NOT NULL,
    DESC_BREVE_PARAMETRO_MONIT VARCHAR2(20) NOT NULL,
    DESC_PARAMETRO_MONIT VARCHAR2(200) NOT NULL,
	ID_TEMPLATE_NOTIFICA INTEGER NOT NULL,
    CONSTRAINT PK_PBANDI_C_PARAMETRI_MONIT PRIMARY KEY (ID_PARAMETRO_MONIT) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_C_PARAMETRI_MONIT_1 ON PBANDI_C_PARAMETRI_MONIT (ID_TEMPLATE_NOTIFICA)  TABLESPACE PBANDI_IDX;
*/

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_R_PARAM_MONIT_BANDO_LIN"                             */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_R_PARAM_MONIT_BANDO_LIN (
    ID_PARAM_MONIT_BANDO_LINEA NUMBER(8) NOT NULL,
    ID_PARAMETRO_MONIT NUMBER(3) NOT NULL,
    PROGR_BANDO_LINEA_INTERVENTO NUMBER(8) NOT NULL,
    NUM_GIORNI NUMBER(4),
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_R_PAR_MONI_BANDO_LIN PRIMARY KEY (ID_PARAM_MONIT_BANDO_LINEA) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_R_PAR_MONI_BAN_LIN_1 ON PBANDI_R_PARAM_MONIT_BANDO_LIN (ID_PARAMETRO_MONIT)  TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_R_PAR_MONI_BAN_LIN_2 ON PBANDI_R_PARAM_MONIT_BANDO_LIN (PROGR_BANDO_LINEA_INTERVENTO)  TABLESPACE PBANDI_IDX;


-- VALIDAZIONE SPESA

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_ATTRIBUTO_VALID_SPESA"                             */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_ATTRIBUTO_VALID_SPESA (
    ID_ATTRIB_VALID_SPESA NUMBER(3) NOT NULL,
    DESC_BREVE_ATTRIB_VALID_SPESA VARCHAR2(20) NOT NULL,
    DESC_ATTRIB_VALID_SPESA VARCHAR2(255) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
	COD_FINPIS VARCHAR2(2),
    CONSTRAINT PK_PBANDI_D_ATTRIB_VALID_SPESA PRIMARY KEY (ID_ATTRIB_VALID_SPESA) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_ESITO_VALID_SPESA"                                 */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_ESITO_VALID_SPESA (
    ID_ESITO_VALID_SPESA NUMBER(3) NOT NULL,
    DESC_BREVE_ESITO_VALID_SPESA VARCHAR2(20) NOT NULL,
    DESC_ESITO_VALID_SPESA VARCHAR2(255) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
	COD_FINPIS  VARCHAR2(2),
    CONSTRAINT PK_PBANDI_D_ESITO_VALID_SPESA PRIMARY KEY (ID_ESITO_VALID_SPESA) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* TABELLE TECNICHE DI CARICAMENTO XML PER MIGRAZIONE                                               */
/* ---------------------------------------------------------------------- */
CREATE TABLE MFINPIS_W_CARICAMENTO_XML
(
  ID_CARICAMENTO   NUMBER                       NOT NULL,
  FILE_XML         SYS.XMLTYPE,
  NOME_FILE        VARCHAR2(255)           NOT NULL,
  FLAG_CARICATO    VARCHAR2(2),
  NUMERO_DOMANDA   VARCHAR2(20),
  FONTE            VARCHAR2(20)            NOT NULL,
  DT_INSERIMENTO   DATE                         DEFAULT sysdate,
  TITOLO_PROGETTO  VARCHAR2(1000),
  FLAG_CLONATO     VARCHAR2(2),
  ID_CARICAMENTO_CLONATO NUMBER,
  ID_AGEVOLAZIONE  NUMBER,
  DT_CONCESSIONE_AGEV DATE,
  DT_COMITATO_AGEV DATE,
  COD_FONDO               VARCHAR2(4),
  CODICE_ERRORE           VARCHAR2(10),
  ID_DICHIARAZIONE_SPESA INTEGER,
  CODICE_PROGETTO_AGEV VARCHAR2(100) 
)
TABLESPACE PBANDI_TBL
XMLTYPE FILE_XML STORE AS CLOB 
      ( TABLESPACE  PBANDI_LOB 
        ENABLE      STORAGE IN ROW
        CHUNK       8192
        RETENTION
        NOCACHE
        INDEX       (
          TABLESPACE PBANDI_LOB
       )
      )
NOCACHE
NOPARALLEL;

CREATE INDEX IDX_MFINPIS_W_CARICAMENTO_XML ON MFINPIS_W_CARICAMENTO_XML
(ID_CARICAMENTO)
TABLESPACE PBANDI_IDX;


CREATE INDEX IDX1_MFINPIS_W_CARICAMENTO_XML ON MFINPIS_W_CARICAMENTO_XML
(COD_FONDO)
TABLESPACE PBANDI_IDX;

CREATE INDEX IDX2_MFINPIS_W_CARICAMENTO_XML ON MFINPIS_W_CARICAMENTO_XML
(NUMERO_DOMANDA)
TABLESPACE PBANDI_IDX;

CREATE INDEX PBANDI.IDX3_MFINPIS_W_CARICAMENTO_XML ON PBANDI.MFINPIS_W_CARICAMENTO_XML
(ID_CARICAMENTO_CLONATO)
TABLESPACE PBANDI_IDX;

create table PBANDI_W_MFINPIS_DICH
(ID_PROGETTO NUMBER(8),
 TIPO_DICHIARAZIONE_MFINPIS VARCHAR2(1),
 DESC_TIPO_DICH_MFINPIS VARCHAR2(100),
 id_dichiarazione_mfinpis varchar2(100),
 TipoAgevolazione_mfinpis   varchar2(100),
 ProgrWf            varchar2(100),
 id_agevolazione_mfinpis varchar2(100),
 StatoDS_mfinpis varchar2(100),
 AttributoDS_mfinpis varchar2(100),
 ImportoImponibile   NUMBER(13,2),
 ImportoRendicontato   NUMBER(13,2),
 ImportoAmmesso   NUMBER(13,2),
 DataConferma   DATE,
 DataInizioIstruttoria   DATE,
 DataEsito  DATE,
 MatricolaIstruttore   varchar2(100),
 id_pban_dichiarazione varchar2(100),
 Nr_Protocollo varchar2(100),
 IdDocDigitale varchar2(100),
 Id_Progetto_mfinpis  varchar2(100),
 IdVoceSpesa varchar2(100),
 ImportoRichiesto  NUMBER(13,2),
 FlagIres  varchar2(100),
 DescrizioneSpesa_mfinpis   varchar2(100)
 );

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_W_RNA_CARICAMENTO_XML"                               */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_W_RNA_CARICAMENTO_XML (
    ID_CARICAMENTO NUMBER(8) NOT NULL,
    FILE_XML XMLTYPE NOT NULL,
    NOME_FILE VARCHAR2(255) NOT NULL,
    COD_BANDO VARCHAR2(40),
    DT_INSERIMENTO DATE NOT NULL,
    ID_ELAB NUMBER(8),
    NUM_FILE NUMBER(8),
    REGIME_AIUTO VARCHAR(100),
    FLAG_ACQUISITO NUMBER(1) NOT NULL,
    ID_CONCESSIONE_GEST VARCHAR(100),
    CONSTRAINT PK_PBANDI_W_RNA_CARICAM_XML PRIMARY KEY (ID_CARICAMENTO) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_W_RNA_CARICAM_XML_1 ON PBANDI_W_RNA_CARICAMENTO_XML (ID_ELAB,NUM_FILE) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_W_RNA_CARICAM_XML_2 ON PBANDI_W_RNA_CARICAMENTO_XML (COD_BANDO) TABLESPACE PBANDI_IDX;

COMMENT ON TABLE PBANDI_W_RNA_CARICAMENTO_XML IS 'Tabella di caricamento degli aiuti per la registrazione a RNA (Registro nNazionale degli Aiuti)';

COMMENT ON COLUMN PBANDI_W_RNA_CARICAMENTO_XML.FILE_XML IS 'File XML relativo al singolo aiuto ricevuto per la registrazione dell''aiuto';

COMMENT ON COLUMN PBANDI_W_RNA_CARICAMENTO_XML.ID_ELAB IS 'Identificativo elaborazione a cui viene assegnato il singolo aiuto ricevuto';

COMMENT ON COLUMN PBANDI_W_RNA_CARICAMENTO_XML.NUM_FILE IS 'Identificativo file XML padre a cui viene assegnato il singolo aiuto ricevuto';

COMMENT ON COLUMN PBANDI_W_RNA_CARICAMENTO_XML.REGIME_AIUTO IS 'Descrizione del regime di aiuto associato al singolo aiuto';

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_W_RNAWS_INVIO_ELAB"                                  */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_W_RNAWS_INVIO_ELAB (
    ID_ELAB NUMBER(8) NOT NULL,
    COD_BANDO VARCHAR2(40),
    COD_STATO_ELAB VARCHAR2(40),
    DT_INIZIO DATE,
    DT_FINE DATE,
    NUM_FILE_INVIATI INTEGER,
    NUM_FILE_DA_INVIARE INTEGER,
    FLAG_INVIO_AUTOMATICO VARCHAR2(1),
    NUM_FILE_ESITO INTEGER,
    FLAG_EMAIL_INVIATA VARCHAR2(1),
    NUM_COR INTEGER,
    NUM_AIUTI_ELAB INTEGER,
    CONSTRAINT PK_PBANDI_W_RNAWS_INVIO_ELAB PRIMARY KEY (ID_ELAB) USING INDEX TABLESPACE PBANDI_IDX
);

CREATE INDEX IE_PBANDI_W_RNAWS_INVIO_ELAB_1 ON PBANDI_W_RNAWS_INVIO_ELAB (COD_BANDO) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_W_RNAWS_INVIO_ELAB_2 ON PBANDI_W_RNAWS_INVIO_ELAB (COD_STATO_ELAB) TABLESPACE PBANDI_IDX;

COMMENT ON TABLE PBANDI_W_RNAWS_INVIO_ELAB IS 'Tabella dove sono memorizzate le elaborazioni del batch Java per l''invio a RNA';

COMMENT ON COLUMN PBANDI_W_RNAWS_INVIO_ELAB.COD_STATO_ELAB IS 'Stato di avanzamento della richiesta di elaborazione';

COMMENT ON COLUMN PBANDI_W_RNAWS_INVIO_ELAB.DT_INIZIO IS 'Data in cui viene richiamato il servizio per la richiesta di elaborazione';

COMMENT ON COLUMN PBANDI_W_RNAWS_INVIO_ELAB.DT_FINE IS 'Data in cui si conclude la richiesta di elaborazione e tutti i singoli aiuti ottengono il COR';

COMMENT ON COLUMN PBANDI_W_RNAWS_INVIO_ELAB.NUM_FILE_INVIATI IS 'Numero di file XML padre associati alla richiesta di elaborazione gi elaborati';

COMMENT ON COLUMN PBANDI_W_RNAWS_INVIO_ELAB.NUM_FILE_DA_INVIARE IS 'Numero di file XML padre associati all''elaborazione ancora da elaborare';

COMMENT ON COLUMN PBANDI_W_RNAWS_INVIO_ELAB.NUM_COR IS 'Numero dei codici COR ottenuti per registrazione andata a buon fine per la specifica elaborazione';

COMMENT ON COLUMN PBANDI_W_RNAWS_INVIO_ELAB.NUM_AIUTI_ELAB IS 'Numero dei singoli aiuti elaborati e registrati, sia con esito positivo che negativo';

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_RNAWS_INVIO_XML"                                   */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_RNAWS_INVIO_XML (
    ID_ELAB NUMBER(8),
    NUM_FILE NUMBER(8) NOT NULL,
    NOME_FILE_XML VARCHAR2(255),
    FILE_XML XMLTYPE,
    ID_RICHIESTA_RNA NUMBER(8),
    DT_INVIO_RICHIESTA DATE,
    DT_ESITO_RICHIESTA DATE,
    ESITO_RICHIESTA_XML XMLTYPE,
    NUM_ESITI_CONCESSIONE INTEGER,
    NUM_ESITI_OK INTEGER,
    NUM_ESITI_KO INTEGER,
    NUM_AIUTI INTEGER,
    DT_INVIO_FINPIEMONTE DATE,
	COD_TIPO_VARIAZIONE VARCHAR2(2),
    CONSTRAINT PK_PBANDI_T_RNAWS_INVIO_XML PRIMARY KEY (ID_ELAB, NUM_FILE) USING INDEX TABLESPACE PBANDI_IDX,
    CONSTRAINT TUC_PBANDI_T_RNAWS_INVIO_XML_1 UNIQUE (ID_RICHIESTA_RNA) USING INDEX TABLESPACE PBANDI_IDX
);

COMMENT ON TABLE PBANDI_T_RNAWS_INVIO_XML IS 'Tabella che raggruppa per identificativo file padre e genera una richiesta da inviare a RNA';

COMMENT ON COLUMN PBANDI_T_RNAWS_INVIO_XML.FILE_XML IS 'File XML padre contenente n singoli aiuti per richiamare il servizio di registrazione degli aiuti';

COMMENT ON COLUMN PBANDI_T_RNAWS_INVIO_XML.ID_RICHIESTA_RNA IS 'Identificativo della singola richiesta di registrazione fornito da RNA';

COMMENT ON COLUMN PBANDI_T_RNAWS_INVIO_XML.DT_INVIO_RICHIESTA IS 'Data in cui viene richiamato il servizio per la registrazione degli aiuti';

COMMENT ON COLUMN PBANDI_T_RNAWS_INVIO_XML.DT_ESITO_RICHIESTA IS 'Data in cui viene fornito un esito da RNA alla richiesta di registrazione';

COMMENT ON COLUMN PBANDI_T_RNAWS_INVIO_XML.ESITO_RICHIESTA_XML IS 'File XML di risposta del servizio RNA per la registrazione degli aiuti';

COMMENT ON COLUMN PBANDI_T_RNAWS_INVIO_XML.NUM_ESITI_CONCESSIONE IS 'Numero degli aiuti per cui  stato fornito un esito da parte di RNA';

COMMENT ON COLUMN PBANDI_T_RNAWS_INVIO_XML.NUM_ESITI_OK IS 'Numero degli aiuti per cui  stato fornito un esito positivo da parte di RNA';

COMMENT ON COLUMN PBANDI_T_RNAWS_INVIO_XML.NUM_ESITI_KO IS 'Numero degli aiuti per cui  stato fornito un esito negativo da parte di RNA';

COMMENT ON COLUMN PBANDI_T_RNAWS_INVIO_XML.NUM_AIUTI IS 'Numero degli aiuti per cui  stata richiesta la registrazione';

COMMENT ON COLUMN PBANDI_T_RNAWS_INVIO_XML.DT_INVIO_FINPIEMONTE IS 'Data in cui il file XML contenente gli esiti viene rimandato a Finpiemonte';

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_RNA_BANDI"                                         */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_RNA_BANDI (
    COD_BANDO VARCHAR2(40) NOT NULL,
    WSDL_USER VARCHAR2(30),
    WSDL_PASSWORD VARCHAR2(30),
    SIGLA_AMM_RESP VARCHAR2(40),
    EMAIL_A VARCHAR2(1000),
    EMAIL_CC VARCHAR2(1000),
    EMAIL_OGGETTO VARCHAR2(4000),
    EMAIL_DA VARCHAR2(1000),
    CONSTRAINT PK_PBANDI_D_RNA_BANDI PRIMARY KEY (COD_BANDO) USING INDEX TABLESPACE PBANDI_IDX
);

COMMENT ON COLUMN PBANDI_D_RNA_BANDI.WSDL_USER IS 'Credenziali per accesso al servizio RNA';

COMMENT ON COLUMN PBANDI_D_RNA_BANDI.WSDL_PASSWORD IS 'Credenziali per accesso al servizio RNA';

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_RNAWS_INVIO_ESITO"                                 */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_RNAWS_INVIO_ESITO (
    ID_RICHIESTA_RNA NUMBER(8) NOT NULL,
    COR VARCHAR2(40) NOT NULL,
    COD_ESITO INTEGER,
    DESCR_ESITO VARCHAR2(1000),
    DT_SCARICO_ESITO DATE,
    ID_CONCESSIONE_GEST VARCHAR2(100),
    CONSTRAINT PK_PBANDI_T_RNAWS_INVIO_ESITO PRIMARY KEY (ID_RICHIESTA_RNA, COR) USING INDEX TABLESPACE PBANDI_IDX
);

COMMENT ON TABLE PBANDI_T_RNAWS_INVIO_ESITO IS 'Tabella che memorizza l''esito tramite il COR a fronte di una richiesta a RNA';

COMMENT ON COLUMN PBANDI_T_RNAWS_INVIO_ESITO.COR IS 'Codice COR restituito dal servizio RNA se la registrazione  andata a buon fine per ogni singolo aiuto';

COMMENT ON COLUMN PBANDI_T_RNAWS_INVIO_ESITO.COD_ESITO IS '0=Esito positivo 1=Esito negativo';

COMMENT ON COLUMN PBANDI_T_RNAWS_INVIO_ESITO.DESCR_ESITO IS 'Descrizione esito della registrazione';

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_RNA_STATI_ELAB"                                    */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_RNA_STATI_ELAB (
    COD_STATO_ELAB CHARACTER VARYING(2) NOT NULL,
    DESCR_STATO_ELAB CHARACTER VARYING(40) NOT NULL,
    CONSTRAINT PK_PBANDI_D_RNA_STATI_ELAB PRIMARY KEY (COD_STATO_ELAB) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_T_RNAWS_CONFERMA"                                    */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_T_RNAWS_CONFERMA (
    ID_CARICAMENTO NUMBER NOT NULL,
    COR CHARACTER VARYING(40) NOT NULL,
    DT_CONCESSIONE DATE NOT NULL,
    ATTO_CONCESSIONE VARCHAR2(255) NOT NULL,
    LINK_ATTO_CONCESSIONE VARCHAR2(500),
    ESITO VARCHAR(100),
    CONSTRAINT PK_PBANDI_T_RNAWS_CONFERMA PRIMARY KEY (ID_CARICAMENTO, COR) USING INDEX TABLESPACE PBANDI_IDX,
    CONSTRAINT TUC_PBANDI_T_RNAWS_CONFERMA_1 UNIQUE (COR) USING INDEX TABLESPACE PBANDI_IDX
);

COMMENT ON COLUMN PBANDI_T_RNAWS_CONFERMA.ESITO IS '0=Esito positivo 1=Esito negativo';

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_W_RNA_CARIC_CONF_ESITO"                              */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_W_RNA_CARIC_CONF_ESITO (
    ID_CARICAMENTO NUMBER(8) NOT NULL,
    FILE_XML XMLTYPE,
    DT_INVIO_ESITO DATE,
    DT_RICEZIONE_CONFERMA DATE,
    DT_INSERIMENTO DATE NOT NULL,
    NOME_FILE VARCHAR2(40) NOT NULL,
    CONSTRAINT PK_PBANDI_W_RNA_CAR_CONF_ESITO PRIMARY KEY  (ID_CARICAMENTO) USING INDEX TABLESPACE PBANDI_IDX
);

COMMENT ON COLUMN PBANDI_W_RNA_CARIC_CONF_ESITO.FILE_XML IS 'File XML padre contenente n singoli aiuti per richiamare il servizio di conferma degli aiuti';

COMMENT ON COLUMN PBANDI_W_RNA_CARIC_CONF_ESITO.DT_INVIO_ESITO IS 'Data di invio esito a Finpiemonte';

COMMENT ON COLUMN PBANDI_W_RNA_CARIC_CONF_ESITO.DT_RICEZIONE_CONFERMA IS 'Data in cui ricevo l''xml di risposta da RNA';

COMMENT ON COLUMN PBANDI_W_RNA_CARIC_CONF_ESITO.DT_INSERIMENTO IS 'Data di caricamento da Finpiemonte';

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_RNA_FORME_GIURIDICHE"                              */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_RNA_FORME_GIURIDICHE (
    COD_FORMA_GIURIDICA_RNA CHAR(2) NOT NULL,
    DESC_FORMA_GIURIDICA_RNA VARCHAR2(200) NOT NULL,
    CONSTRAINT PK_PBANDI_D_RNA_FORME_GIURIDIC PRIMARY KEY (COD_FORMA_GIURIDICA_RNA) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_RNA_TIPO_VARIAZIONE"                               */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_RNA_TIPO_VARIAZIONE (
    COD_TIPO_VARIAZIONE VARCHAR2(2) NOT NULL,
    DESC_TIPO_VARIAZIONE VARCHAR2(50) NOT NULL,
	COD_TIPO_PACCHETTO VARCHAR2(2),
    CONSTRAINT PK_PBANDI_D_RNA_TIPO_VARIAZ PRIMARY KEY (COD_TIPO_VARIAZIONE) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_RNA_TIPO_SOGG_BENEF"                               */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_RNA_TIPO_SOGG_BENEF (
    ID_TIPO_SOGGETTO_RNA NUMBER(3) NOT NULL,
    DESC_TIPO_SOGGETTO_RNA VARCHAR2(200) NOT NULL,
    NOTE VARCHAR2(200),
    CONSTRAINT PK_PBANDI_D_RNA_TIPO_SOGG_BEN PRIMARY KEY (ID_TIPO_SOGGETTO_RNA) USING INDEX TABLESPACE PBANDI_IDX
);


/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_RNA_DIMENSION_IMPRESA"                             */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_RNA_DIMENSION_IMPRESA (
    ID_DIMENSIONE_IMPRESA_RNA NUMBER(3) NOT NULL,
    DESC_DIMENSIONE_IMPRESA_RNA VARCHAR2(50) NOT NULL,
    NOTA VARCHAR2(200),
    CONSTRAINT PK_PBANDI_D_RNA_DIMENSION_IMPR PRIMARY KEY (ID_DIMENSIONE_IMPRESA_RNA) USING INDEX TABLESPACE PBANDI_IDX
);

/* ---------------------------------------------------------------------- */
/* ALTER table "PBANDI_D_DIMENSIONE_IMPRESA"                                */
/* ---------------------------------------------------------------------- */

ALTER TABLE PBANDI_D_DIMENSIONE_IMPRESA ADD (
    ID_DIMENSIONE_IMPRESA_RNA NUMBER(3));

CREATE INDEX IE_PBANDI_D_DIMENSION_IMPR_2 ON PBANDI_D_DIMENSIONE_IMPRESA (ID_DIMENSIONE_IMPRESA_RNA) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_FASCICOLO_ACTA                                  */
/* ---------------------------------------------------------------------- */

CREATE TABLE PBANDI_D_FASCICOLO_ACTA (
    ID_FASCICOLO_ACTA NUMBER(3) NOT NULL,
    DESC_FASCICOLO VARCHAR2(255) NOT NULL,
	--ID_TIPO_DOCUMENTO_INDEX NUMBER(3) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_D_FASCICOLO_ACTA PRIMARY KEY (ID_FASCICOLO_ACTA) USING INDEX TABLESPACE PBANDI_IDX
);





/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_R_FASC_ACTA_TIP_DOC_IDX"                             */
/* Associazione fascicoli a tipo documento index                                          */
/* ---------------------------------------------------------------------- */
CREATE TABLE PBANDI_R_FASC_ACTA_TIP_DOC_IDX (
    ID_FASCICOLO_ACTA NUMBER(3) NOT NULL,
    ID_TIPO_DOCUMENTO_INDEX NUMBER(3) NOT NULL,
    DT_INIZIO_VALIDITA DATE NOT NULL,
    DT_FINE_VALIDITA DATE,
    CONSTRAINT PK_PBANDI_R_SOG_TIP_ANA_EN_COM PRIMARY KEY (ID_FASCICOLO_ACTA, ID_TIPO_DOCUMENTO_INDEX) USING INDEX TABLESPACE PBANDI_IDX
);

COMMENT ON TABLE PBANDI_R_FASC_ACTA_TIP_DOC_IDX IS 'Associazione fascicoli a tipo documento index';

CREATE UNIQUE INDEX IE1_PBANDI_R_FASC_AC_TP_DOC_IX ON PBANDI_R_FASC_ACTA_TIP_DOC_IDX (ID_TIPO_DOCUMENTO_INDEX) TABLESPACE PBANDI_IDX;

ALTER TABLE PBANDI_R_FASC_ACTA_TIP_DOC_IDX ADD CONSTRAINT FK_PBANDI_C_TIPO_DOC_INDEX_09
    FOREIGN KEY (ID_TIPO_DOCUMENTO_INDEX) REFERENCES PBANDI_C_TIPO_DOCUMENTO_INDEX (ID_TIPO_DOCUMENTO_INDEX);

ALTER TABLE PBANDI_R_FASC_ACTA_TIP_DOC_IDX ADD CONSTRAINT FK_PBANDI_D_FASCICOLO_ACTA_01
    FOREIGN KEY (ID_FASCICOLO_ACTA) REFERENCES PBANDI_D_FASCICOLO_ACTA (ID_FASCICOLO_ACTA);

-- PBANDI_D_ATTIVITA_SERVICER
CREATE TABLE PBANDI_D_ATTIVITA_SERVICER
  (ID_ATTIVITA_SERVICER  NUMBER(8)    NOT NULL,
  DESC_BREVE_ATTIVITA_SERVICER  VARCHAR2(20) NOT NULL,
  DESC_ATTIVITA_SERVICER  VARCHAR2(255)   NOT NULL,
  DT_INIZIO_VALIDITA  DATE  NOT NULL,
  DT_FINE_VALIDITA  DATE ,
  CONSTRAINT PK_PBANDI_D_ATTIVITA_SERVICER PRIMARY KEY (ID_ATTIVITA_SERVICER) USING INDEX TABLESPACE PBANDI_IDX
  ); 
  
-- PBANDI_T_SERVICER
CREATE TABLE PBANDI_T_SERVICER  
  (ID_SERVICER  NUMBER(8)  NOT NULL,
    ID_PROGETTO  NUMBER(8)  NOT NULL,
    ID_MODALITA_AGEVOLAZIONE  NUMBER(3)NOT NULL,
    IMP_CESSIONE_CAPITALE  NUMBER(13,2),    
    IMP_CESSIONE_ONERI  NUMBER(13,2),    
    IMP_CESSIONE_INTERESSI_MORA	NUMBER(13,2),		
		IMP_CESSIONE_COMPLESSIVA	NUMBER(13,2),		
		DT_CESSIONE	DATE,		
		IMP_CORRISP_CESSIONE	NUMBER(13,2),		
		DENOM_CESSIONARIO	VARCHAR2(400),		 
		ID_ATTIVITA_SERVICER	NUMBER(8),		
		NOTE	VARCHAR2(4000),		
		DT_INIZIO_VALIDITA	DATE		NOT NULL,
		DT_FINE_VALIDITA	DATE,		
		ID_UTENTE_INS	NUMBER(8)		NOT NULL,
		ID_UTENTE_AGG	NUMBER(8),		
		DT_INSERIMENTO	DATE		NOT NULL,
		DT_AGGIORNAMENTO	DATE,
    CONSTRAINT PK_PBANDI_T_SERVICER PRIMARY KEY (ID_SERVICER) USING INDEX TABLESPACE PBANDI_IDX,
    CONSTRAINT FK_PBANDI_D_ATTIVITA_SERV_01 FOREIGN KEY (ID_ATTIVITA_SERVICER) REFERENCES PBANDI_D_ATTIVITA_SERVICER (ID_ATTIVITA_SERVICER),
    CONSTRAINT fk_pbandi_t_utente_426 FOREIGN KEY (ID_UTENTE_INS) REFERENCES PBANDI_T_UTENTE (ID_UTENTE),
    CONSTRAINT fk_pbandi_t_utente_427 FOREIGN KEY (ID_UTENTE_AGG) REFERENCES PBANDI_T_UTENTE (ID_UTENTE),
    CONSTRAINT fk_pbandi_t_progetto_97 FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI_T_PROGETTO (ID_PROGETTO),
    CONSTRAINT fk_pbandi_d_modalita_agevol_36 FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE) REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE)
    );		

-- PBANDI_D_DEST_INTERV_SOSTITUT
CREATE TABLE PBANDI_D_DEST_INTERV_SOSTITUT
(ID_DESTINATARIO_INTERVENTO NUMBER(8) NOT NULL,
 DESC_BREVE_DEST_INTERVENTO VARCHAR2(50) NOT NULL,
 DESC_DESTINATARIO_INTERVENTO VARCHAR2(500) NOT NULL,
 IBAN VARCHAR2(27) NOT NULL,
 DT_INIZIO_VALIDITA DATE NOT NULL,
 DT_FINE_VALIDITA DATE,
 CONSTRAINT PK_PBANDI_D_DEST_INTERV_SOST PRIMARY KEY (ID_DESTINATARIO_INTERVENTO) USING INDEX TABLESPACE PBANDI_IDX 
);

-- pbandi_t_riassicurazioni
CREATE TABLE pbandi_t_riassicurazioni
     (    id_riassicurazione NUMBER(8) NOT NULL,         
          linea_intervento_soggetto VARCHAR2(50),
          ragione_sociale VARCHAR2(10),
          forma_giuridica VARCHAR2(255),
          descr_forma_giuridica VARCHAR2(500),
          codice_fiscale VARCHAR2(16),
          indirizzo_sede_destinataria VARCHAR2(255),
          localita_sede_destinataria VARCHAR2(255),
          provincia_sede_destinataria VARCHAR2(2),
          ateco VARCHAR2(8),
          descrizione_ateco VARCHAR2(500),
          importo_finanziato NUMBER(17,2),
          id_progetto NUMBER(8) NOT NULL,
          importo_garanzia NUMBER(17,2),
          importo_ammesso NUMBER(17,2),
          percentuale_garanzia NUMBER(5,2),
          percentuale_riassicurato NUMBER(5,2),
          dt_erogazione_mutuo date,
          dt_delibera_mutuo date,
          dt_emissione_garanzia date,
          dt_scadenza_mutuo date,
          importo_escusso NUMBER(17,2),
          data_scarico date,
          data_revoca date,
          data_inizio date NOT NULL,
          data_fine date,
          id_utente_ins number(8) NOT NULL,
          id_utente_agg number(8),
		  DATA_ESCUSSIONE DATE
      );
      
-- pk     
alter table pbandi_t_riassicurazioni
 add constraint pk_pbandi_t_riassicurazioni primary key (id_riassicurazione)
 using index  tablespace PBANDI_IDX;
-- fk  
alter table pbandi_t_riassicurazioni
  add constraint FK_PBANDI_T_UTENTE_434 foreign key (ID_UTENTE_AGG)
  references PBANDI_T_UTENTE (ID_UTENTE);
alter table pbandi_t_riassicurazioni
  add constraint FK_PBANDI_T_UTENTE_435 foreign key (ID_UTENTE_INS)
  references PBANDI_T_UTENTE (ID_UTENTE);
alter table pbandi_t_riassicurazioni
  add constraint FK_PBANDI_T_PROGETTO_98 foreign key (ID_PROGETTO)
  references PBANDI_T_PROGETTO (ID_PROGETTO);
-- idx  
create index IE1_pbandi_t_riassicurazioni on  pbandi_t_riassicurazioni (ID_UTENTE_AGG) tablespace PBANDI_IDX; 
create index IE2_pbandi_t_riassicurazioni on  pbandi_t_riassicurazioni (ID_UTENTE_INS) tablespace PBANDI_IDX; 
create index IE3_pbandi_t_riassicurazioni on  pbandi_t_riassicurazioni (ID_PROGETTO) tablespace PBANDI_IDX;       

-- PBANDI_T_RELAZIONE_TECNICA
CREATE TABLE PBANDI_T_RELAZIONE_TECNICA
	   (ID_RELAZIONE_TECNICA 		NUMBER(8) NOT NULL,
		ID_TIPO_RELAZIONE_TECNICA  	NUMBER(3) NOT NULL,
        ID_PROGETTO 				NUMBER(8) NOT NULL,
		DT_INIZIO_VALIDITA			DATE	  NOT NULL,
		DT_FINE_VALIDITA			DATE,		
		ID_UTENTE_INS				NUMBER(8) NOT NULL,
		ID_UTENTE_AGG				NUMBER(8),		
		DT_INSERIMENTO				DATE	  NOT NULL,
		DT_AGGIORNAMENTO			DATE,
		FLAG_VALIDATO 				VARCHAR2(1),
		NOTE 						VARCHAR2(4000)
      );
      
-- pk     
ALTER TABLE PBANDI_T_RELAZIONE_TECNICA
 ADD CONSTRAINT PK_PBANDI_T_RELAZIONE_TECNICA PRIMARY KEY (ID_RELAZIONE_TECNICA)
 USING INDEX  TABLESPACE PBANDI_IDX;
-- fk  
ALTER TABLE PBANDI_T_RELAZIONE_TECNICA
  ADD CONSTRAINT FK_PBANDI_T_UTENTE_448 FOREIGN KEY (ID_UTENTE_AGG)
  REFERENCES PBANDI_T_UTENTE (ID_UTENTE);
ALTER TABLE PBANDI_T_RELAZIONE_TECNICA
  ADD CONSTRAINT FK_PBANDI_T_UTENTE_449 FOREIGN KEY (ID_UTENTE_INS)
  REFERENCES PBANDI_T_UTENTE (ID_UTENTE);
ALTER TABLE PBANDI_T_RELAZIONE_TECNICA
  ADD CONSTRAINT FK_PBANDI_T_PROGETTO_99 FOREIGN KEY (ID_PROGETTO)
  REFERENCES PBANDI_T_PROGETTO (ID_PROGETTO);
ALTER TABLE PBANDI_T_RELAZIONE_TECNICA
  ADD CONSTRAINT FK_PBANDI_D_TIPO_DICH_SPESA_03 FOREIGN KEY (ID_TIPO_RELAZIONE_TECNICA)
  REFERENCES PBANDI_D_TIPO_DICHIARAZ_SPESA (ID_TIPO_DICHIARAZ_SPESA);
  
ALTER TABLE PBANDI_T_RELAZIONE_TECNICA add constraint chk_flag_validato  check (flag_validato IN ('S','N'));
  
-- idx  
CREATE INDEX IE1_PBANDI_T_RELAZIONE_TECNICA ON  PBANDI_T_RELAZIONE_TECNICA (ID_UTENTE_AGG) TABLESPACE PBANDI_IDX; 
CREATE INDEX IE2_PBANDI_T_RELAZIONE_TECNICA ON  PBANDI_T_RELAZIONE_TECNICA (ID_UTENTE_INS) TABLESPACE PBANDI_IDX; 
CREATE INDEX IE3_PBANDI_T_RELAZIONE_TECNICA ON  PBANDI_T_RELAZIONE_TECNICA (ID_PROGETTO) TABLESPACE PBANDI_IDX;       
CREATE INDEX IE4_PBANDI_T_RELAZIONE_TECNICA ON  PBANDI_T_RELAZIONE_TECNICA (ID_TIPO_RELAZIONE_TECNICA) TABLESPACE PBANDI_IDX;       

--PBANDI_T_RNA_PROGETTO_MAN
CREATE TABLE PBANDI.PBANDI_T_RNA_PROGETTO_MAN
(
  ID_RNA_PROGETTO_MAN  NUMBER(8)                NOT NULL,
  ID_PROGETTO          NUMBER(8)                NOT NULL,
  ACOVAR1              NUMBER(10),
  DDATCOVAR1           DATE,
  ACOVAR2              NUMBER(10),
  DDATCOVAR2           DATE,
  ACOVAR3              NUMBER(10),
  DDATCOVAR3           DATE,
  AVERCOR1             NUMBER(10),
  DDTVERCOR1           DATE,
  AVERCOR2             NUMBER(10),
  DDTVERCOR2           DATE,
  AVERCOR3             NUMBER(10),
  DDTVERCOR3           NUMBER(10),
  ACOR2                NUMBER(10),
  DDATACOR2            DATE,
  ACUP                 VARCHAR2(100),
  AIDCONC              VARCHAR2(30),
  AIDRICH              VARCHAR2(30),
  CODRNA               VARCHAR2(100),
  CODRNA2              NUMBER(10),
  DDATRNA2             DATE,
  ID_UTENTE_INS        NUMBER(8)                NOT NULL
)
TABLESPACE PBANDI_TBL;


CREATE INDEX PBANDI.IE_PBANDI_T_RNA_PROGETTO_MAN_1 ON PBANDI.PBANDI_T_RNA_PROGETTO_MAN
(ID_PROGETTO) TABLESPACE PBANDI_IDX;


CREATE INDEX PBANDI.IE_PBANDI_T_RNA_PROGETTO_MAN_2 ON PBANDI.PBANDI_T_RNA_PROGETTO_MAN
(ID_UTENTE_INS) TABLESPACE PBANDI_IDX;


ALTER TABLE PBANDI.PBANDI_T_RNA_PROGETTO_MAN ADD (
  CONSTRAINT PK_PBANDI_T_RNA_PROGETTO_MAN
 PRIMARY KEY
 (ID_RNA_PROGETTO_MAN)
    USING INDEX 
    TABLESPACE PBANDI_IDX
);

ALTER TABLE PBANDI.PBANDI_T_RNA_PROGETTO_MAN ADD (
  CONSTRAINT FK_PBANDI_T_PROGETTO_102 
 FOREIGN KEY (ID_PROGETTO) 
 REFERENCES PBANDI.PBANDI_T_PROGETTO (ID_PROGETTO),
  CONSTRAINT FK_PBANDI_T_UTENTE_416 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE));

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_SERVIZI_DOQUI"                                        */
/* ---------------------------------------------------------------------- */
CREATE TABLE PBANDI_D_SERVIZI_DOQUI
(ID_SERVIZIO  Number  Not null,   
 NOME_SERVIZIO  VARCHAR2(40) Not null,    
 DESCRIZIONE  VARCHAR2(300),     
 TIPOLOGIA  Varchar2(1),		
 DT_INIZIO_VALIDITA	Date Not null,		
 DT_FINE_VALIDITA	Date,		
 PARAMETRI_DI_INPUT	VARCHAR2(200)	Not null,		
 PARAMETRI_DI_OUTPUT	VARCHAR2(200)	Not null,
 CONSTRAINT PK_PBANDI_D_SERVIZI_DOQUI PRIMARY KEY (ID_SERVIZIO) USING INDEX TABLESPACE PBANDI_IDX
);

--
COMMENT ON COLUMN PBANDI_D_SERVIZI_DOQUI.ID_SERVIZIO IS 'Identificativo interno del servizio';
COMMENT ON COLUMN PBANDI_D_SERVIZI_DOQUI.NOME_SERVIZIO IS 'Nome del servizio chiamato nel codice';
COMMENT ON COLUMN PBANDI_D_SERVIZI_DOQUI.DESCRIZIONE IS 'Testo descrittivo del servizio';
COMMENT ON COLUMN PBANDI_D_SERVIZI_DOQUI.TIPOLOGIA IS 'Se in lettura o scrittura (Valori R o W)';
COMMENT ON COLUMN PBANDI_D_SERVIZI_DOQUI.PARAMETRI_DI_INPUT IS 'Concatenazione con separatore';
COMMENT ON COLUMN PBANDI_D_SERVIZI_DOQUI.PARAMETRI_DI_OUTPUT IS 'Concatenazione con separatore';

-- PBANDI_T_MON_SERV_DOQUI
CREATE TABLE PBANDI_T_MON_SERV_DOQUI
(ID_MONIT_DOQUI	Number(38) not null,
    ID_SERVIZIO	Number		not null,		
    ID_UTENTE	Number		not null,		
    MODALITA_CHIAMATA	Varchar2(1)	not null	,    	
    ESITO 	Varchar2(2),		
    CODICE_ERRORE	Varchar2(10),		
    MESSAGGIO_ERRORE	Varchar2(4000),		
    DATETIME_INIZIO_CHIAMATA	Date	not null,		
    DATETIME_FINE_CHIAMATA	Date,		
    PARAMETRI_DI_INPUT	VARCHAR2(4000) not null,		
    PARAMETRI_DI_OUTPUT	VARCHAR2(4000),		
    ID_ENTITA	NUMBER(3,0) not null,		
    ID_TARGET	NUMBER(8,0)	not null,
    CONSTRAINT PK_PBANDI_T_MON_SERV_DOQUI PRIMARY KEY (ID_MONIT_DOQUI) USING INDEX TABLESPACE PBANDI_IDX	
);


-- idx
CREATE INDEX IE1_PBANDI_T_MON_SERV_DOQUI ON PBANDI_T_MON_SERV_DOQUI (ID_SERVIZIO) TABLESPACE PBANDI_IDX;
CREATE INDEX IE2_PBANDI_T_MON_SERV_DOQUI ON PBANDI_T_MON_SERV_DOQUI (ID_UTENTE) TABLESPACE PBANDI_IDX;
CREATE INDEX IE3_PBANDI_T_MON_SERV_DOQUI ON PBANDI_T_MON_SERV_DOQUI (ID_ENTITA,ID_TARGET) TABLESPACE PBANDI_IDX;

-- 
COMMENT ON COLUMN PBANDI_T_MON_SERV_DOQUI.ID_MONIT_DOQUI IS 'Identificativo interno valorizzato tramite sequence';
COMMENT ON COLUMN PBANDI_T_MON_SERV_DOQUI.ID_UTENTE IS 'Identificativo dell''utente applicativo che effettua la chiamata';
COMMENT ON COLUMN PBANDI_T_MON_SERV_DOQUI.MODALITA_CHIAMATA IS 'Possibili valori I (Insert), U (Update), nel caso di angrafica fondo e iban cancellazione non permessa';
COMMENT ON COLUMN PBANDI_T_MON_SERV_DOQUI.ESITO IS 'Valori (OK/KO)';
COMMENT ON COLUMN PBANDI_T_MON_SERV_DOQUI.PARAMETRI_DI_INPUT IS 'Concatenazione con separatore';
COMMENT ON COLUMN PBANDI_T_MON_SERV_DOQUI.PARAMETRI_DI_OUTPUT IS 'Concatenazione con separatore';

ALTER TABLE PBANDI_T_MON_SERV_DOQUI ADD CONSTRAINT FK_PBANDI_C_ENTITA_17 
    FOREIGN KEY (ID_ENTITA) REFERENCES PBANDI_C_ENTITA (ID_ENTITA);

ALTER TABLE PBANDI_T_MON_SERV_DOQUI ADD CONSTRAINT FK_PBANDI_D_SERVIZI_DOQUI_01 
    FOREIGN KEY (ID_SERVIZIO) REFERENCES PBANDI_D_SERVIZI_DOQUI (ID_SERVIZIO);

ALTER TABLE PBANDI_T_MON_SERV_DOQUI ADD CONSTRAINT FK_PBANDI_T_UTENTE_454 
    FOREIGN KEY (ID_UTENTE) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

/* ---------------------------------------------------------------------- */
/* Add table "PBANDI_D_SERVIZI_FINISTR"                                        */
/* ---------------------------------------------------------------------- */
CREATE TABLE PBANDI_D_SERVIZI_FINISTR
(ID_SERVIZIO  Number  Not null,   
 NOME_SERVIZIO  VARCHAR2(40) Not null,    
 DESCRIZIONE  VARCHAR2(300),     
 TIPOLOGIA  Varchar2(1),		
 DT_INIZIO_VALIDITA	Date Not null,		
 DT_FINE_VALIDITA	Date,		
 PARAMETRI_DI_INPUT	VARCHAR2(200)	Not null,		
 PARAMETRI_DI_OUTPUT	VARCHAR2(200)	Not null,
 CONSTRAINT PK_PBANDI_D_SERVIZI_FINISTR PRIMARY KEY (ID_SERVIZIO) USING INDEX TABLESPACE PBANDI_IDX
);

--
COMMENT ON COLUMN PBANDI_D_SERVIZI_FINISTR.ID_SERVIZIO IS 'Identificativo interno del servizio';
COMMENT ON COLUMN PBANDI_D_SERVIZI_FINISTR.NOME_SERVIZIO IS 'Nome del servizio chiamato nel codice';
COMMENT ON COLUMN PBANDI_D_SERVIZI_FINISTR.DESCRIZIONE IS 'Testo descrittivo del servizio';
COMMENT ON COLUMN PBANDI_D_SERVIZI_FINISTR.TIPOLOGIA IS 'Se in lettura o scrittura (Valori R o W)';
COMMENT ON COLUMN PBANDI_D_SERVIZI_FINISTR.PARAMETRI_DI_INPUT IS 'Concatenazione con separatore';
COMMENT ON COLUMN PBANDI_D_SERVIZI_FINISTR.PARAMETRI_DI_OUTPUT IS 'Concatenazione con separatore';

-- PBANDI_T_MON_SERV_FINISTR
CREATE TABLE PBANDI_T_MON_SERV_FINISTR
(ID_MONIT_FINISTR	Number(38) not null,
    ID_SERVIZIO	Number		not null,		
    ID_UTENTE	Number		not null,		
    MODALITA_CHIAMATA	Varchar2(1)	not null	,    	
    ESITO 	Varchar2(2),		
    CODICE_ERRORE	Varchar2(10),		
    MESSAGGIO_ERRORE	Varchar2(4000),		
    DATETIME_INIZIO_CHIAMATA	Date	not null,		
    DATETIME_FINE_CHIAMATA	Date,		
    PARAMETRI_DI_INPUT	VARCHAR2(4000) not null,		
    PARAMETRI_DI_OUTPUT	VARCHAR2(4000),		
    ID_ENTITA	NUMBER(3,0) not null,		
    ID_TARGET	NUMBER(8,0)	not null,
    CONSTRAINT PK_PBANDI_T_MON_SERV_FINISTR PRIMARY KEY (ID_MONIT_FINISTR) USING INDEX TABLESPACE PBANDI_IDX	
);


-- idx
CREATE INDEX IE1_PBANDI_T_MON_SERV_FINISTR ON PBANDI_T_MON_SERV_FINISTR (ID_SERVIZIO) TABLESPACE PBANDI_IDX;
CREATE INDEX IE2_PBANDI_T_MON_SERV_FINISTR ON PBANDI_T_MON_SERV_FINISTR (ID_UTENTE) TABLESPACE PBANDI_IDX;
CREATE INDEX IE3_PBANDI_T_MON_SERV_FINISTR ON PBANDI_T_MON_SERV_FINISTR (ID_ENTITA,ID_TARGET) TABLESPACE PBANDI_IDX;

-- 
COMMENT ON COLUMN PBANDI_T_MON_SERV_FINISTR.ID_MONIT_FINISTR IS 'Identificativo interno valorizzato tramite sequence';
COMMENT ON COLUMN PBANDI_T_MON_SERV_FINISTR.ID_UTENTE IS 'Identificativo dell''utente applicativo che effettua la chiamata';
COMMENT ON COLUMN PBANDI_T_MON_SERV_FINISTR.MODALITA_CHIAMATA IS 'Possibili valori I (Insert), U (Update), nel caso di angrafica fondo e iban cancellazione non permessa';
COMMENT ON COLUMN PBANDI_T_MON_SERV_FINISTR.ESITO IS 'Valori (OK/KO)';
COMMENT ON COLUMN PBANDI_T_MON_SERV_FINISTR.PARAMETRI_DI_INPUT IS 'Concatenazione con separatore';
COMMENT ON COLUMN PBANDI_T_MON_SERV_FINISTR.PARAMETRI_DI_OUTPUT IS 'Concatenazione con separatore';

ALTER TABLE PBANDI_T_MON_SERV_FINISTR ADD CONSTRAINT FK_PBANDI_C_ENTITA_18
    FOREIGN KEY (ID_ENTITA) REFERENCES PBANDI_C_ENTITA (ID_ENTITA);

ALTER TABLE PBANDI_T_MON_SERV_FINISTR ADD CONSTRAINT FK_PBANDI_D_SERVIZI_FINISTR_01 
    FOREIGN KEY (ID_SERVIZIO) REFERENCES PBANDI_D_SERVIZI_FINISTR (ID_SERVIZIO);

ALTER TABLE PBANDI_T_MON_SERV_FINISTR ADD CONSTRAINT FK_PBANDI_T_UTENTE_455 
    FOREIGN KEY (ID_UTENTE) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

/* ---------------------------------------------------------------------- */
/* --------------------- MODIFICA TABELLE --------------------------      */

/* ---------------------------------------------------------------------- */
/* ALTER table "PBANDI_T_ENTE_GIURIDICO"                                        */
/* ---------------------------------------------------------------------- */

ALTER TABLE PBANDI_T_ENTE_GIURIDICO 
    ADD ID_STATO_ATTIVITA NUMBER(3);
	
ALTER TABLE PBANDI_T_ENTE_GIURIDICO 
    ADD DT_VALUTAZIONE_ESITO DATE;
	
ALTER TABLE PBANDI_T_ENTE_GIURIDICO 
    ADD PERIODO_SCADENZA_ESERCIZIO VARCHAR2(40);
	
ALTER TABLE PBANDI_T_ENTE_GIURIDICO 
    ADD DT_INIZIO_ATTIVITA_ESITO DATE;

ALTER TABLE PBANDI_T_ENTE_GIURIDICO 
    ADD FLAG_RATING_LEGALITA VARCHAR2(1);

ALTER TABLE PBANDI_T_ENTE_GIURIDICO ADD CONSTRAINT CK_PBANDI_T_ENTE_GIURIDICO_01 
    CHECK (FLAG_RATING_LEGALITA in ('S'));

CREATE INDEX IE_PBANDI_T_ENTE_GIURIDICO_1 ON PBANDI_T_ENTE_GIURIDICO (ID_STATO_ATTIVITA) TABLESPACE PBANDI_IDX;

ALTER TABLE PBANDI_T_SOGGETTO
    ADD NDG VARCHAR2(10);

CREATE INDEX IE2_PBANDI_T_SOGGETTO ON PBANDI_T_SOGGETTO (NDG) TABLESPACE PBANDI_IDX;
COMMENT ON COLUMN PBANDI_T_SOGGETTO.NDG IS 'Numero Direzione Generale';

/* ---------------------------------------------------------------------- */
/* ALTER table "PBANDI_D_TIPO_SOGG_CORRELATO"                                        */
/* ---------------------------------------------------------------------- */

ALTER TABLE PBANDI_D_TIPO_SOGG_CORRELATO
   ADD FLAG_INDIPENDENTE VARCHAR2(1);
   
ALTER TABLE PBANDI_D_TIPO_SOGG_CORRELATO
   ADD ID_TIPO_SOGGETTO NUMBER(3);
   
ALTER TABLE PBANDI_D_TIPO_SOGG_CORRELATO ADD CONSTRAINT CC_PBANDI_D_TIPO_SOGG_CORR_02 
    CHECK (flag_indipendente in ('S','N'));

CREATE INDEX IDX_PBANDI_D_TIPO_SOGG_CORR_1 ON PBANDI_D_TIPO_SOGG_CORRELATO (ID_TIPO_SOGGETTO) TABLESPACE PBANDI_IDX;

COMMENT ON COLUMN PBANDI_D_TIPO_SOGG_CORRELATO.FLAG_INDIPENDENTE IS 'S=Indipendente (tutte le domande) N=Dipende dalla domanda/progetto';
   
/* ---------------------------------------------------------------------- */
/* ALTER table "PBANDI_R_SOGGETTO_PROGETTO "                                        */
/* ---------------------------------------------------------------------- */
ALTER TABLE PBANDI_R_SOGGETTO_PROGETTO
   ADD FLAG_IRES VARCHAR2(1);
COMMENT ON COLUMN PBANDI_R_SOGGETTO_PROGETTO.FLAG_IRES IS 'S=Soggetto a IRES';

/*---------------------------------------------*/
/*------ALTER TABLE PBANDI_T_EROGAZIONE--------*/
/*---------------------------------------------*/
ALTER TABLE PBANDI_T_EROGAZIONE ADD ID_DISTINTA NUMBER(8);
CREATE INDEX IE2_PBANDI_T_EROGAZIONE ON PBANDI_T_EROGAZIONE (ID_DISTINTA);

ALTER TABLE PBANDI_T_EROGAZIONE ADD IMP_IRES NUMBER(17,2);
ALTER TABLE PBANDI_T_EROGAZIONE MODIFY COD_RIFERIMENTO_EROGAZIONE VARCHAR2(30);

/*---------------------------------------------*/
/*------ALTER TABLE PBANDI_T_RECUPERO--------*/
/*---------------------------------------------*/
ALTER TABLE PBANDI_T_RECUPERO MODIFY COD_RIFERIMENTO_RECUPERO VARCHAR2(30);

ALTER TABLE PBANDI_T_RECUPERO ADD ID_DISTINTA NUMBER(8);
CREATE INDEX IE3_PBANDI_T_RECUPERO ON PBANDI_T_RECUPERO (ID_DISTINTA);

ALTER TABLE PBANDI_T_PROGETTO ADD CODICE_FONDO_FINPIS           VARCHAR2(4);
ALTER TABLE PBANDI_T_DOMANDA ADD CODICE_FONDO_FINPIS            VARCHAR2(4);
ALTER TABLE PBANDI_T_PROGETTO ADD CONFIDI varchar2(200);


ALTER TABLE PBANDI_R_CONTO_ECONOM_MOD_AGEV ADD IMP_ESL 			NUMBER(17,2);
ALTER TABLE PBANDI_R_CONTO_ECONOM_MOD_AGEV ADD GARANZIE 		VARCHAR2(200);
ALTER TABLE PBANDI_R_CONTO_ECONOM_MOD_AGEV ADD CODICE_PROGETTO_AGEV VARCHAR2(100);
COMMENT ON COLUMN PBANDI_R_CONTO_ECONOM_MOD_AGEV.CODICE_PROGETTO_AGEV IS 'Codice progetto specifico per agevolazione';

ALTER TABLE PBANDI_R_CONTO_ECONOM_MOD_AGEV ADD IMPORTO_AMMESSO_FINPIS NUMBER(17,2);
COMMENT ON COLUMN PBANDI_R_CONTO_ECONOM_MOD_AGEV.IMPORTO_AMMESSO_FINPIS IS 'Importo ammesso salvato da migrazione Finpis';


CREATE INDEX IE_PBANDI_R_CONTO_EC_MOD_AGE_1 ON PBANDI_R_CONTO_ECONOM_MOD_AGEV (ID_MODALITA_AGEVOLAZIONE) TABLESPACE PBANDI_IDX;

ALTER TABLE PBANDI_T_QUOTA_PARTE_DOC_SPESA ADD FLAG_IRES        VARCHAR2(1);

CREATE INDEX IE10_PBANDI_T_PROGETTO ON PBANDI_T_PROGETTO
(CODICE_VISUALIZZATO)
TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* Alter table "PBANDI_T_REVOCA"                                         */
/* ---------------------------------------------------------------------- */

ALTER TABLE PBANDI_T_REVOCA ADD ID_GESTIONE_REVOCA NUMBER(8);
CREATE INDEX IE4_PBANDI_T_REVOCA ON PBANDI_T_REVOCA (ID_GESTIONE_REVOCA) TABLESPACE PBANDI_IDX;

ALTER TABLE PBANDI_R_BANDO_LINEA_INTERVENT ADD FLAG_MONITORAGGIO_TEMPI VARCHAR2(1);
ALTER TABLE PBANDI_R_BANDO_LINEA_INTERVENT ADD CONSTRAINT CK_PBANDI_R_BAN_LIN_INT_03 
    CHECK (FLAG_MONITORAGGIO_TEMPI='S');
COMMENT ON COLUMN PBANDI_R_BANDO_LINEA_INTERVENT.FLAG_MONITORAGGIO_TEMPI IS 'Se ''S'' attiva il monitoraggio tempi di scadenze per il bando';

/* ---------------------------------------------------------------------- */
/* ALTER table "PBANDI_T_DICHIARAZIONE_SPESA"                               */
/* ---------------------------------------------------------------------- */

ALTER TABLE PBANDI_T_DICHIARAZIONE_SPESA  ADD (
    ID_ATTRIB_VALID_SPESA NUMBER(3),
    ID_ESITO_VALID_SPESA NUMBER(3),
	--IMP_TOT_BANCA  		NUMBER(13,2),
	ID_DICHIARAZIONE_FINP NUMBER(8)
);



COMMENT ON COLUMN PBANDI_T_DICHIARAZIONE_SPESA.IMP_TOT_BANCA IS 'indica la premialit che la banca da, nel caso in cui venga erogato il 100% del prestito';
CREATE INDEX IE_PBANDI_T_DICHIARAZ_SPESA_02 ON PBANDI_T_DICHIARAZIONE_SPESA (ID_ATTRIB_VALID_SPESA) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_DICHIARAZ_SPESA_03 ON PBANDI_T_DICHIARAZIONE_SPESA (ID_ESITO_VALID_SPESA) TABLESPACE PBANDI_IDX;

CREATE INDEX IE_PBANDI_T_DICHIARAZ_SPESA_04 ON PBANDI_T_DICHIARAZIONE_SPESA (ID_DICHIARAZIONE_FINP) TABLESPACE PBANDI_IDX;

ALTER TABLE PBANDI_T_DICHIARAZIONE_SPESA ADD CONSTRAINT FK_PBANDI_D_ATTR_VAL_SPESA_01 
    FOREIGN KEY (ID_ATTRIB_VALID_SPESA) REFERENCES PBANDI_D_ATTRIBUTO_VALID_SPESA (ID_ATTRIB_VALID_SPESA);

ALTER TABLE PBANDI_T_DICHIARAZIONE_SPESA ADD CONSTRAINT FK_PBANDI_D_ESITO_VAL_SPESA_01 
    FOREIGN KEY (ID_ESITO_VALID_SPESA) REFERENCES PBANDI_D_ESITO_VALID_SPESA (ID_ESITO_VALID_SPESA);

/* ---------------------------------------------------------------------- */
/* ALTER table "PBANDI_D_FORMA_GIURIDICA"                                   */
/* ---------------------------------------------------------------------- */
ALTER TABLE PBANDI_D_FORMA_GIURIDICA ADD (
    COD_FORMA_GIURIDICA_RNA CHAR(2));

CREATE INDEX IE_PBANDI_D_FORMA_GIURIDICA2 ON PBANDI.PBANDI_D_FORMA_GIURIDICA (COD_FORMA_GIURIDICA_RNA) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* ALTER table "PBANDI_D_NAZIONE"                                           */
/* ---------------------------------------------------------------------- */

ALTER TABLE PBANDI_D_NAZIONE ADD(
    COD_NAZIONE_RNA VARCHAR2(3));

CREATE INDEX IE_PBANDI_D_NAZIONE_3 ON PBANDI.PBANDI_D_NAZIONE (COD_NAZIONE_RNA) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* ALTER table "PBANDI_D_COMUNE"                                            */
/* ---------------------------------------------------------------------- */

ALTER TABLE PBANDI_D_COMUNE ADD (
    COD_COMUNE_RNA VARCHAR2(6));

CREATE INDEX IE_PBANDI_D_COMUNE_4 ON PBANDI_D_COMUNE (COD_COMUNE_RNA) TABLESPACE PBANDI_IDX;

/* ---------------------------------------------------------------------- */
/* ALTER table "PBANDI_D_DIMENSIONE_IMPRESA"                                */
/* ---------------------------------------------------------------------- */

--PBANDI_D_MODALITA_AGEVOLAZIONE
--ALTER TABLE PBANDI.PBANDI_D_MODALITA_AGEVOLAZIONE
-- ADD (ID_MODALITA_AGEVOLAZIONE_RIF  NUMBER(3));

--PBANDI_R_PLACEHOLDER_NOTIFICA
ALTER TABLE PBANDI.PBANDI_R_PLACEHOLDER_NOTIFICA DROP  CONSTRAINT FK_PBANDI_D_TEMPLATE_MODIFICA;

ALTER TABLE PBANDI.PBANDI_R_PLACEHOLDER_NOTIFICA ADD (
  CONSTRAINT FK_PBANDI_D_TEMPLATE_NOTIFICA 
 FOREIGN KEY (ID_TEMPLATE_NOTIFICA) 
 REFERENCES PBANDI.PBANDI_D_TEMPLATE_NOTIFICA (ID_TEMPLATE_NOTIFICA));

ALTER TABLE PBANDI_D_LINEA_DI_INTERVENTO ADD FLAG_CAMPIONAMENTO_ESTERNO VARCHAR2(1);
ALTER TABLE PBANDI_D_LINEA_DI_INTERVENTO ADD CONSTRAINT CHK_FLAG_CAMPIONAMENTO_ESTERNO  CHECK (FLAG_CAMPIONAMENTO_ESTERNO='S');

CREATE INDEX PBANDI.IDX_PBANDI_L_LOG_BATCH ON PBANDI.PBANDI_L_LOG_BATCH
(ID_PROCESSO_BATCH)
TABLESPACE PBANDI_IDX;

-- Modifica per gestire la sede amministrativa in domanda
ALTER TABLE PBANDI_R_SOGGETTO_DOMANDA_SEDE ADD
  FLAG_SEDE_AMMINISTRATIVA      VARCHAR2(1);

-- PBANDI_T_PROPOSTA_EROGAZIONE
ALTER TABLE PBANDI_T_PROPOSTA_EROGAZIONE ADD flag_finistr varchar2(2);
ALTER TABLE PBANDI_T_PROPOSTA_EROGAZIONE add constraint chk_flag_finistr
  check (flag_finistr IN ('SI','NO',NULL));

-- PBANDI_T_PROPOSTA_EROGAZIONE
ALTER TABLE PBANDI_T_PROPOSTA_EROGAZIONE ADD
(ID_PROPOSTA_PADRE NUMBER(8),
 ID_DESTINATARIO_INTERVENTO NUMBER(8)
);

-- fk
 ALTER TABLE PBANDI_T_PROPOSTA_EROGAZIONE   ADD CONSTRAINT fk_pbandi_t_proposta_erog_02 
    FOREIGN KEY (ID_PROPOSTA_PADRE) REFERENCES PBANDI_T_PROPOSTA_EROGAZIONE (ID_PROPOSTA);
 ALTER TABLE PBANDI_T_PROPOSTA_EROGAZIONE   ADD CONSTRAINT fk_PBANDI_D_DEST_INT_SOST_01 
    FOREIGN KEY (ID_DESTINATARIO_INTERVENTO) REFERENCES PBANDI_D_DEST_INTERV_SOSTITUT (ID_DESTINATARIO_INTERVENTO);
    
-- idx
CREATE INDEX ie_pbandi_t_proposta_erogaz_3 ON PBANDI_T_PROPOSTA_EROGAZIONE (ID_PROPOSTA_PADRE)  TABLESPACE PBANDI_IDX;
CREATE INDEX ie_pbandi_t_proposta_erogaz_4 ON PBANDI_T_PROPOSTA_EROGAZIONE (ID_DESTINATARIO_INTERVENTO)  TABLESPACE PBANDI_IDX;



--PBANDI_T_DOCUMENTO_INDEX
--ALTER TABLE PBANDI.PBANDI_T_DOCUMENTO_INDEX ADD   FLAG_VISIBILE_BEN VARCHAR2(1);
ALTER TABLE PBANDI.PBANDI_T_DOCUMENTO_INDEX ADD (
  CONSTRAINT CHK_FLAG_VISIBILE_BEN
 CHECK (FLAG_VISIBILE_BEN IN ('N', NULL)));

-- PBANDI_D_STATO_DISTINTA
ALTER TABLE PBANDI_D_STATO_DISTINTA ADD ID_STATO_DISTINTA_AMVVO NUMBER(8);
ALTER TABLE PBANDI_D_TIPO_DISTINTA ADD ID_TIPO_DISTINTA_AMMVO NUMBER(8);

-- PBANDI_T_PROPOSTA_EROGAZIONE
alter table PBANDI_T_PROPOSTA_EROGAZIONE ADD ID_GESTIONE_REVOCA NUMBER(8);
-- fk
ALTER TABLE PBANDI_T_PROPOSTA_EROGAZIONE   ADD CONSTRAINT fk_pbandi_t_gestione_revoca_02
    FOREIGN KEY (ID_GESTIONE_REVOCA) REFERENCES pbandi_t_gestione_revoca(ID_GESTIONE_REVOCA);
 -- idx
CREATE INDEX ie_pbandi_t_proposta_erogaz_5 ON PBANDI_T_PROPOSTA_EROGAZIONE (ID_GESTIONE_REVOCA)  TABLESPACE PBANDI_IDX;

--PBANDI_R_BANDO_CAUSALE_EROGAZ
ALTER TABLE PBANDI_R_BANDO_CAUSALE_EROGAZ ADD ID_MODALITA_AGEVOLAZIONE  NUMBER(3);

ALTER TABLE PBANDI_R_BANDO_CAUSALE_EROGAZ ADD CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_37
    FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE) REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE);

CREATE INDEX IE2_PBANDI_R_BANDO_CAUS_EROG ON PBANDI_R_BANDO_CAUSALE_EROGAZ (ID_MODALITA_AGEVOLAZIONE)  TABLESPACE PBANDI_IDX;
CREATE INDEX IE3_PBANDI_R_BANDO_CAUS_EROG ON PBANDI_R_BANDO_CAUSALE_EROGAZ (ID_CAUSALE_EROGAZIONE)  TABLESPACE PBANDI_IDX;

ALTER TABLE PBANDI_C_TIPO_DOCUMENTO_INDEX ADD FLAG_PROTOCOLLO VARCHAR2(1);

ALTER TABLE PBANDI_C_TIPO_DOCUMENTO_INDEX ADD CONSTRAINT CC_PBANDI_C_TIPO_DOC_INDEX_01 
    CHECK (FLAG_PROTOCOLLO IN('A','I','P'));

COMMENT ON COLUMN PBANDI_C_TIPO_DOCUMENTO_INDEX.FLAG_PROTOCOLLO IS 'A=Arrivo, I=Interno, P=Partenza';

ALTER TABLE PBANDI_W_CARICAMENTO_XML
 ADD (STATO_DOMANDA  VARCHAR2(20));
 
ALTER TABLE TMP_NUM_DOMANDA_GEFO ADD FLAG_MIGRAZIONE VARCHAR2(1);

-- Nuovi indici per performance migrazione
CREATE INDEX PBANDI.IE2_PBANDI_T_PREVIEW_DETT_PROP ON PBANDI.PBANDI_T_PREVIEW_DETT_PROP_CER
(ID_PROGETTO)
TABLESPACE PBANDI_IDX;


CREATE INDEX PBANDI.IE5_PBANDI_T_REVOCA ON PBANDI.PBANDI_T_REVOCA
(ID_PROGETTO)
TABLESPACE PBANDI_IDX;

CREATE INDEX PBANDI.IE1_PBANDI_R_DET_PRO_CER_QP_DO ON PBANDI.PBANDI_R_DET_PROP_CER_QP_DOC
(PROGR_PAG_QUOT_PARTE_DOC_SP)
TABLESPACE PBANDI_IDX;

CREATE INDEX PBANDI.IE1_PBANDI_R_DET_PR_CER_QP_DOC ON PBANDI.PBANDI_R_DET_PROP_CER_QP_DOC
(ID_DICHIARAZIONE_SPESA)
TABLESPACE PBANDI_IDX;

CREATE INDEX PBANDI.IE1_PBANDI_R_DETT_PRO_CE_EROG ON PBANDI.PBANDI_R_DETT_PROP_CERT_EROGAZ
(ID_EROGAZIONE)
TABLESPACE PBANDI_IDX;

CREATE INDEX PBANDI.IE1_PBANDI_R_SOGG_DOMANDA_SEDE ON PBANDI.PBANDI_R_SOGGETTO_DOMANDA_SEDE
(PROGR_SOGGETTO_DOMANDA)
TABLESPACE PBANDI_IDX;

CREATE INDEX PBANDI.IE1_PBANDI_T_COMUNIC_FINE_PROG ON PBANDI.PBANDI_T_COMUNICAZ_FINE_PROG
(ID_PROGETTO)
TABLESPACE PBANDI_IDX;

CREATE INDEX PBANDI.IE4_PBANDI_R_SOGGETTO_PROGETTO ON PBANDI.PBANDI_R_SOGGETTO_PROGETTO
(PROGR_SOGGETTO_DOMANDA)
TABLESPACE PBANDI_IDX;

CREATE INDEX PBANDI.IE1_PBANDI_T_CHECKLIST ON PBANDI.PBANDI_T_CHECKLIST
(ID_DICHIARAZIONE_SPESA)
TABLESPACE PBANDI_IDX;

CREATE INDEX PBANDI.IE2_PBANDI_T_RECUPERO ON PBANDI.PBANDI_T_RECUPERO
(ID_PROGETTO)
TABLESPACE PBANDI_IDX;

CREATE INDEX PBANDI.IE1_PBANDI_R_SOGG_DOM_SOGG_COR ON PBANDI.PBANDI_R_SOGG_DOM_SOGG_CORREL
(PROGR_SOGGETTI_CORRELATI)
TABLESPACE PBANDI_IDX;

CREATE INDEX PBANDI.IE1_PBANDI_R_SOGGETTI_CORRELAT ON PBANDI.PBANDI_R_SOGGETTI_CORRELATI
(ID_SOGGETTO)
TABLESPACE PBANDI_IDX;

CREATE INDEX PBANDI.IE1_PBANDI_T_UTENTE ON PBANDI.PBANDI_T_UTENTE
(ID_SOGGETTO)
TABLESPACE PBANDI_IDX;

CREATE INDEX PBANDI.IE1_PBANDI_T_RECAPITI ON PBANDI.PBANDI_T_RECAPITI
(NVL("TELEFONO",'0'))
TABLESPACE PBANDI_IDX;

CREATE INDEX PBANDI.IE1_PBANDI_T_DOCUMENTO ON PBANDI.PBANDI_T_DOCUMENTO
(NVL("NUMERO_DOCUMENTO",'0'))
TABLESPACE PBANDI_IDX;

CREATE INDEX PBANDI.IE1_PBANDI_T_SEDE ON PBANDI.PBANDI_T_SEDE
(NVL("PARTITA_IVA",'0'))
TABLESPACE PBANDI_IDX;

CREATE INDEX IE1_PBANDI_T_PAGAMENTO ON PBANDI_T_PAGAMENTO
(ID_EROGAZIONE, 1)
TABLESPACE PBANDI_IDX;

CREATE INDEX IE1_PBANDI_T_DOMANDA ON PBANDI_T_DOMANDA
(NUMERO_DOMANDA)
TABLESPACE PBANDI_IDX;

CREATE INDEX IE1_PROGR_SOGGETTI_CORRELATI ON PBANDI_R_SOGG_PROG_SOGG_CORREL
(PROGR_SOGGETTI_CORRELATI)
TABLESPACE PBANDI_IDX;

-- Altre modifiche
ALTER TABLE PBANDI_D_CATEG_ANAGRAFICA ADD FLAG_REVOCA            VARCHAR2(1);
ALTER TABLE PBANDI_T_INTEGRAZIONE_SPESA MODIFY(DESCRIZIONE  NULL);
--ALTER TABLE PBANDI_T_REVOCA ADD DT_DECOR_REVOCA  DATE;

ALTER TABLE PBANDI_R_BANDO_LINEA_INTERVENT ADD DT_CREAZIONE_ACTA  DATE;
ALTER TABLE PBANDI_T_PROGETTO ADD DT_CREAZIONE_ACTA  DATE;
ALTER TABLE PBANDI_T_PAGAMENTO ADD flag_pagamento VARCHAR2(1);
ALTER TABLE PBANDI_T_PAGAMENTO add constraint chk_flag_pagamento check (flag_pagamento IN ('S',NULL));
comment on column pbandi_t_pagamento.flag_pagamento is 'Indica la non disponibilit della quietanza per il documento di spesa a cui si riferisce';
/* ---------------------------------------------------------------------- */
/* Foreign key constraints                                                */
/* ---------------------------------------------------------------------- */


ALTER TABLE PBANDI_T_SOGG_STATO_AZIENDA ADD CONSTRAINT FK_PBANDI_T_SOGGETTO_28 
    FOREIGN KEY (ID_SOGGETTO) REFERENCES PBANDI.PBANDI_T_SOGGETTO (ID_SOGGETTO);

ALTER TABLE PBANDI_T_SOGG_STATO_AZIENDA ADD CONSTRAINT FK_PBANDI_D_STATO_AZIENDA_01 
    FOREIGN KEY (ID_STATO_AZIENDA) REFERENCES PBANDI_D_STATO_AZIENDA (ID_STATO_AZIENDA);

ALTER TABLE PBANDI_R_SOGG_PROG_STA_CRED_FP ADD CONSTRAINT FK_PBANDI_R_SOGG_PROGETTO_04 
    FOREIGN KEY (PROGR_SOGGETTO_PROGETTO) REFERENCES PBANDI.PBANDI_R_SOGGETTO_PROGETTO (PROGR_SOGGETTO_PROGETTO);

ALTER TABLE PBANDI_R_SOGG_PROG_STA_CRED_FP ADD CONSTRAINT FK_PBANDI_D_STATO_CRED_FP_01 
    FOREIGN KEY (ID_STATO_CREDITO_FP) REFERENCES PBANDI_D_STATO_CREDITO_FP (ID_STATO_CREDITO_FP);

ALTER TABLE PBANDI_R_SOGG_PROG_STA_CRED_FP ADD CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_35 
    FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE) REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE);
	
ALTER TABLE PBANDI_T_SOGGETTO_RATING ADD CONSTRAINT FK_PBANDI_D_RATING_01 
    FOREIGN KEY (ID_RATING) REFERENCES PBANDI_D_RATING (ID_RATING);

ALTER TABLE PBANDI_T_SOGGETTO_RATING ADD CONSTRAINT FK_PBANDI_T_SOGGETTO_29 
    FOREIGN KEY (ID_SOGGETTO) REFERENCES PBANDI.PBANDI_T_SOGGETTO (ID_SOGGETTO);

ALTER TABLE PBANDI_D_RATING ADD CONSTRAINT FK_PBANDI_D_PROVIDER_01 
    FOREIGN KEY (ID_PROVIDER) REFERENCES PBANDI_D_PROVIDER (ID_PROVIDER);

ALTER TABLE PBANDI_R_SOGG_PROG_BANCA_BEN ADD CONSTRAINT FK_PBANDI_R_SOGG_PROGETTO_06 
    FOREIGN KEY (PROGR_SOGGETTO_PROGETTO) REFERENCES PBANDI.PBANDI_R_SOGGETTO_PROGETTO (PROGR_SOGGETTO_PROGETTO);

ALTER TABLE PBANDI_R_SOGG_PROG_BANCA_BEN ADD CONSTRAINT FK_PBANDI_D_BANCA_04 
    FOREIGN KEY (ID_BANCA) REFERENCES PBANDI.PBANDI_D_BANCA (ID_BANCA);

ALTER TABLE PBANDI_R_SOGG_PROG_BANCA_BEN ADD CONSTRAINT FK_PBANDI_D_ATT_MONIT_CRED_11 
    FOREIGN KEY (ID_ATTIVITA_BANCA_BEN) REFERENCES PBANDI_D_ATTIVITA_MONIT_CRED (ID_ATTIVITA_MONIT_CRED);

	
-- Monitoraggio
ALTER TABLE PBANDI_D_ATTIVITA_MONIT_CRED ADD CONSTRAINT FK_PBANDI_D_TIPO_MONIT_CRED_01 
    FOREIGN KEY (ID_TIPO_MONIT_CRED) REFERENCES PBANDI_D_TIPO_MONIT_CRED (ID_TIPO_MONIT_CRED);
	
ALTER TABLE PBANDI_T_REVOCA_BANCARIA ADD CONSTRAINT FK_PBANDI_T_PROGETTO_60 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI.PBANDI_T_PROGETTO (ID_PROGETTO);

ALTER TABLE PBANDI_T_REVOCA_BANCARIA ADD (CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_15
	FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE)  REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE));
 
ALTER TABLE PBANDI_T_AZIONE_RECUP_BANCA ADD CONSTRAINT FK_PBANDI_T_PROGETTO_61 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI.PBANDI_T_PROGETTO (ID_PROGETTO);

ALTER TABLE PBANDI_T_AZIONE_RECUP_BANCA ADD (CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_16
	FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE)  REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE));

ALTER TABLE PBANDI_T_AZIONE_RECUP_BANCA ADD CONSTRAINT FK_PBANDI_D_ATT_MONIT_CRED_01 
    FOREIGN KEY (ID_ATTIVITA_AZIONE) REFERENCES PBANDI_D_ATTIVITA_MONIT_CRED (ID_ATTIVITA_MONIT_CRED);

ALTER TABLE PBANDI_T_LIBERAZ_GARANTE ADD CONSTRAINT FK_PBANDI_T_PROGETTO_62 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI.PBANDI_T_PROGETTO (ID_PROGETTO);
	
ALTER TABLE PBANDI_T_LIBERAZ_GARANTE ADD (CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_17
	FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE)  REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE));

ALTER TABLE PBANDI_T_ABBATTIM_GARANZIE ADD CONSTRAINT FK_PBANDI_T_PROGETTO_63 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI.PBANDI_T_PROGETTO (ID_PROGETTO);
	
ALTER TABLE PBANDI_T_ABBATTIM_GARANZIE ADD (CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_18
	FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE)  REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE));

ALTER TABLE PBANDI_T_ABBATTIM_GARANZIE ADD CONSTRAINT FK_PBANDI_D_ATT_MONIT_CRED_02 
    FOREIGN KEY (ID_ATTIVITA_GARANZIE) REFERENCES PBANDI_D_ATTIVITA_MONIT_CRED (ID_ATTIVITA_MONIT_CRED);

ALTER TABLE PBANDI_T_ESCUSS_CONFIDI ADD CONSTRAINT FK_PBANDI_T_PROGETTO_64 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI.PBANDI_T_PROGETTO (ID_PROGETTO);
	
ALTER TABLE PBANDI_T_ESCUSS_CONFIDI ADD (CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_19
	FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE)  REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE));

ALTER TABLE PBANDI_T_ESCUSS_CONFIDI ADD CONSTRAINT FK_PBANDI_D_ATT_MONIT_CRED_03 
    FOREIGN KEY (ID_ATTIVITA_GARANZIA_CONFIDI) REFERENCES PBANDI_D_ATTIVITA_MONIT_CRED (ID_ATTIVITA_MONIT_CRED);

ALTER TABLE PBANDI_T_PIANO_RIENTRO ADD CONSTRAINT FK_PBANDI_T_PROGETTO_65 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI.PBANDI_T_PROGETTO (ID_PROGETTO);
	
ALTER TABLE PBANDI_T_PIANO_RIENTRO ADD (CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_20
	FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE)  REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE));

ALTER TABLE PBANDI_T_PIANO_RIENTRO ADD CONSTRAINT FK_PBANDI_D_ATT_MONIT_CRED_05 
    FOREIGN KEY (ID_ATTIVITA_ESITO) REFERENCES PBANDI_D_ATTIVITA_MONIT_CRED (ID_ATTIVITA_MONIT_CRED);

ALTER TABLE PBANDI_T_PIANO_RIENTRO ADD CONSTRAINT FK_PBANDI_D_ATT_MONIT_CRED_04 
    FOREIGN KEY (ID_ATTIVITA_RECUPERO) REFERENCES PBANDI_D_ATTIVITA_MONIT_CRED (ID_ATTIVITA_MONIT_CRED);

ALTER TABLE PBANDI_T_SALDO_STRALCIO ADD CONSTRAINT FK_PBANDI_T_PROGETTO_66 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI.PBANDI_T_PROGETTO (ID_PROGETTO);
	
ALTER TABLE PBANDI_T_SALDO_STRALCIO ADD (CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_21
	FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE)  REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE));

ALTER TABLE PBANDI_T_SALDO_STRALCIO ADD CONSTRAINT FK_PBANDI_D_ATT_MONIT_CRED_06 
    FOREIGN KEY (ID_ATTIVITA_SALDO_STRALCIO) REFERENCES PBANDI_D_ATTIVITA_MONIT_CRED (ID_ATTIVITA_MONIT_CRED);

ALTER TABLE PBANDI_T_SALDO_STRALCIO ADD CONSTRAINT FK_PBANDI_D_ATT_MONIT_CRED_07 
    FOREIGN KEY (ID_ATTIVITA_ESITO) REFERENCES PBANDI_D_ATTIVITA_MONIT_CRED (ID_ATTIVITA_MONIT_CRED);

ALTER TABLE PBANDI_T_SALDO_STRALCIO ADD CONSTRAINT FK_PBANDI_D_ATT_MONIT_CRED_08 
    FOREIGN KEY (ID_ATTIVITA_RECUPERO) REFERENCES PBANDI_D_ATTIVITA_MONIT_CRED (ID_ATTIVITA_MONIT_CRED);

ALTER TABLE PBANDI_T_PASSAGGIO_PERDITA ADD CONSTRAINT FK_PBANDI_T_PROGETTO_67 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI.PBANDI_T_PROGETTO (ID_PROGETTO);
	
ALTER TABLE PBANDI_T_PASSAGGIO_PERDITA ADD (CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_22
	FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE)  REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE));

ALTER TABLE PBANDI_T_LIBERAZ_BANCA ADD CONSTRAINT FK_PBANDI_T_PROGETTO_68 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI.PBANDI_T_PROGETTO (ID_PROGETTO);

ALTER TABLE PBANDI_T_LIBERAZ_BANCA ADD CONSTRAINT FK_PBANDI_D_ATT_MONIT_CRED_09 
    FOREIGN KEY (ID_ATTIVITA_LIBERAZIONE) REFERENCES PBANDI_D_ATTIVITA_MONIT_CRED (ID_ATTIVITA_MONIT_CRED);
	
ALTER TABLE PBANDI_T_LIBERAZ_BANCA ADD (CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_23
	FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE)  REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE));

ALTER TABLE PBANDI_T_MESSA_IN_MORA ADD CONSTRAINT FK_PBANDI_T_PROGETTO_70 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI.PBANDI_T_PROGETTO (ID_PROGETTO);
	
ALTER TABLE PBANDI_T_MESSA_IN_MORA ADD (CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_24
	FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE)  REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE));

ALTER TABLE PBANDI_T_MESSA_IN_MORA ADD CONSTRAINT FK_PBANDI_D_ATT_MONIT_CRED_10 
    FOREIGN KEY (ID_ATTIVITA_MORA) REFERENCES PBANDI_D_ATTIVITA_MONIT_CRED (ID_ATTIVITA_MONIT_CRED);

ALTER TABLE PBANDI_T_MESSA_IN_MORA ADD CONSTRAINT FK_PBANDI_D_ATT_MONIT_CRED_12 
    FOREIGN KEY (ID_ATTIVITA_RECUPERO_MORA) REFERENCES PBANDI_D_ATTIVITA_MONIT_CRED (ID_ATTIVITA_MONIT_CRED);

ALTER TABLE PBANDI_T_ANNOTAZ_GENERALI ADD CONSTRAINT FK_PBANDI_T_PROGETTO_69 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI.PBANDI_T_PROGETTO (ID_PROGETTO);
	
ALTER TABLE PBANDI_T_ANNOTAZ_GENERALI ADD (CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_29
	FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE)  REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE));

ALTER TABLE PBANDI_T_ISCRIZIONE_RUOLO ADD CONSTRAINT FK_PBANDI_T_PROGETTO_71 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI.PBANDI_T_PROGETTO (ID_PROGETTO);
	
ALTER TABLE PBANDI_T_ISCRIZIONE_RUOLO ADD (CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_25
	FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE)  REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE));

ALTER TABLE PBANDI_T_SEGNALAZ_CORTE_CONTI ADD CONSTRAINT FK_PBANDI_T_PROGETTO_72 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI.PBANDI_T_PROGETTO (ID_PROGETTO);
	
ALTER TABLE PBANDI_T_SEGNALAZ_CORTE_CONTI ADD (CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_26
	FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE)  REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE));

ALTER TABLE PBANDI_T_CESSIONE_QUOTA_FP ADD CONSTRAINT FK_PBANDI_T_PROGETTO_73 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI.PBANDI_T_PROGETTO (ID_PROGETTO);
	
ALTER TABLE PBANDI_T_CESSIONE_QUOTA_FP ADD (CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_27
	FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE)  REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE));

ALTER TABLE PBANDI_T_CESSIONE_QUOTA_FP ADD CONSTRAINT FK_PBANDI_D_STATO_CESS_01 
    FOREIGN KEY (ID_STATO_CESSIONE) REFERENCES PBANDI_D_STATO_CESSIONE (ID_STATO_CESSIONE);

ALTER TABLE PBANDI_T_TRANSAZIONI_BANCA ADD CONSTRAINT FK_PBANDI_T_PROGETTO_74 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI.PBANDI_T_PROGETTO (ID_PROGETTO);
	
ALTER TABLE PBANDI_T_TRANSAZIONI_BANCA ADD (CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_28
	FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE)  REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE));

ALTER TABLE PBANDI_T_TRANSAZIONI_BANCA ADD CONSTRAINT FK_PBANDI_D_BANCA_03 
    FOREIGN KEY (ID_BANCA) REFERENCES PBANDI.PBANDI_D_BANCA (ID_BANCA);

ALTER TABLE PBANDI_T_VARIAZ_ST_CREDITO ADD CONSTRAINT FK_PBANDI_R_SOG_PRO_STA_CRE_1 
    FOREIGN KEY (ID_SOGG_PROG_STATO_CREDITO_FP) REFERENCES PBANDI_R_SOGG_PROG_STA_CRED_FP (ID_SOGG_PROG_STATO_CREDITO_FP);

ALTER TABLE PBANDI_T_VARIAZ_ST_CREDITO ADD CONSTRAINT FK_PBANDI_D_STATO_CRED_FP_02 
    FOREIGN KEY (ID_NUOVO_STATO_CREDITO_FP) REFERENCES PBANDI_D_STATO_CREDITO_FP (ID_STATO_CREDITO_FP);

ALTER TABLE PBANDI_T_VARIAZ_ST_CREDITO ADD CONSTRAINT FK_PBANDI_D_STA_PROP_VAR_CRE_1 
    FOREIGN KEY (ID_STATO_PROP_VAR_CRE) REFERENCES PBANDI_D_STATO_PROP_VAR_CRE (ID_STATO_PROP_VAR_CRE);

ALTER TABLE PBANDI_T_VARIAZ_ST_CREDITO ADD CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_10 
    FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE) REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE);

ALTER TABLE PBANDI_T_SOGGETTO_CLA_RISCHIO ADD CONSTRAINT FK_PBANDI_T_SOGGETTO_34 
    FOREIGN KEY (ID_SOGGETTO) REFERENCES PBANDI.PBANDI_T_SOGGETTO (ID_SOGGETTO);

ALTER TABLE PBANDI_T_SOGGETTO_CLA_RISCHIO ADD CONSTRAINT FK_PBANDI_D_CLASSE_RISCHIO_01 
    FOREIGN KEY (ID_CLASSE_RISCHIO) REFERENCES PBANDI_D_CLASSE_RISCHIO (ID_CLASSE_RISCHIO);

ALTER TABLE PBANDI_T_ALLUNG_PIANO_AMMORT ADD CONSTRAINT FK_PBANDI_T_PROGETTO_90 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI.PBANDI_T_PROGETTO (ID_PROGETTO);
	
ALTER TABLE PBANDI_T_ALLUNG_PIANO_AMMORT ADD (CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_30
	FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE)  REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE));

ALTER TABLE PBANDI_T_ALLUNG_PIANO_AMMORT ADD (CONSTRAINT FK_PBANDI_D_ESI_ALL_PIA_AMM_01
	FOREIGN KEY (ID_ESITO_ALL_PIANO_AMMOR)  REFERENCES PBANDI_D_ESITO_ALL_PIANO_AMMOR (ID_ESITO_ALL_PIANO_AMMOR));


ALTER TABLE PBANDI_T_CREDITORIE ADD CONSTRAINT FK_PBANDI_T_PROGETTO_91 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI.PBANDI_T_PROGETTO (ID_PROGETTO);
	
ALTER TABLE PBANDI_T_CREDITORIE ADD (CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_31
	FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE)  REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE));


ALTER TABLE PBANDI_T_PROCEDURE_CONCORS ADD CONSTRAINT FK_PBANDI_T_PROGETTO_92 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI.PBANDI_T_PROGETTO (ID_PROGETTO);
	
ALTER TABLE PBANDI_T_PROCEDURE_CONCORS ADD (CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_32
	FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE)  REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE));
	
ALTER TABLE PBANDI_T_PROCEDURE_CONCORS ADD (CONSTRAINT FK_PBANDI_D_TIP_PROC_CONCOR_01
	FOREIGN KEY (ID_TIPO_PROCED_CONCORS)  REFERENCES PBANDI_D_TIPO_PROCED_CONCORS (ID_TIPO_PROCED_CONCORS));

ALTER TABLE PBANDI_T_PROCEDURE_CONCORS ADD (CONSTRAINT FK_PBANDI_D_ST_INSIN_CONCOR_01
	FOREIGN KEY (ID_STATO_INSINUA_CONCORS)  REFERENCES PBANDI_D_STATO_INSINUA_CONCORS (ID_STATO_INSINUA_CONCORS));

ALTER TABLE PBANDI_T_PROCEDURE_CONCORS ADD (CONSTRAINT FK_PBANDI_D_ST_PROCE_CONCOR_01
	FOREIGN KEY (ID_STATO_PROCED_CONCORS)  REFERENCES PBANDI_D_STATO_PROCED_CONCORS (ID_STATO_PROCED_CONCORS));

ALTER TABLE PBANDI_R_AGEV_CREDITI_GARANZIE ADD (CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_33
	FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE)  REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE));

ALTER TABLE PBANDI_R_AGEV_CREDITI_GARANZIE ADD (CONSTRAINT FK_PBANDI_C_ENTITA_16
	FOREIGN KEY (ID_ENTITA)  REFERENCES PBANDI_C_ENTITA (ID_ENTITA));


ALTER TABLE PBANDI_T_SOGG_STATO_AZIENDA ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_298 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_299 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);
    
ALTER TABLE PBANDI_R_SOGG_PROG_STA_CRED_FP ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_300 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_301 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);
 
ALTER TABLE PBANDI_T_SOGGETTO_RATING ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_302 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_303 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);
    
ALTER TABLE PBANDI_T_SOGGETTO_CLA_RISCHIO ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_304 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_305 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);

ALTER TABLE PBANDI_T_REVOCA_BANCARIA ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_306 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_307 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);

ALTER TABLE PBANDI_T_AZIONE_RECUP_BANCA ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_308 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_309 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);
    
ALTER TABLE PBANDI_T_ABBATTIM_GARANZIE ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_312 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_313 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);

ALTER TABLE PBANDI_T_ESCUSS_CONFIDI ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_314 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_315 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);

ALTER TABLE PBANDI_T_PIANO_RIENTRO ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_316 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_317 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);    

ALTER TABLE PBANDI_T_SALDO_STRALCIO ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_318 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_319 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);  

ALTER TABLE PBANDI_T_PASSAGGIO_PERDITA ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_320 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_321 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);    

ALTER TABLE PBANDI_T_LIBERAZ_BANCA ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_322 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_323 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);
    
ALTER TABLE PBANDI_T_MESSA_IN_MORA ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_324 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_325 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);

ALTER TABLE PBANDI_T_ANNOTAZ_GENERALI ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_326 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_327 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);


ALTER TABLE PBANDI_T_ISCRIZIONE_RUOLO ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_330 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_331 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);

ALTER TABLE PBANDI_T_SEGNALAZ_CORTE_CONTI ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_332 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_333 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);
	
ALTER TABLE PBANDI_T_CESSIONE_QUOTA_FP ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_334 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_335 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);

ALTER TABLE PBANDI_T_TRANSAZIONI_BANCA ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_336 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_337 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);
	
ALTER TABLE PBANDI_T_VARIAZ_ST_CREDITO ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_378
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_379
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);

ALTER TABLE PBANDI_T_ALLUNG_PIANO_AMMORT ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_410
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_411
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);

ALTER TABLE PBANDI_T_CREDITORIE ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_412
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_413
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);
	

ALTER TABLE PBANDI_T_PROCEDURE_CONCORS ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_414
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_415
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);

ALTER TABLE PBANDI.PBANDI_T_LIBERAZ_GARANTE ADD (
  CONSTRAINT FK_PBANDI_T_UTENTE_310 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_311 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);
  

ALTER TABLE PBANDI_D_CAMPO_REGOLA ADD CONSTRAINT FK_PBANDI_C_REGOLA_04 
    FOREIGN KEY (ID_REGOLA) REFERENCES PBANDI_C_REGOLA (ID_REGOLA);

ALTER TABLE PBANDI_D_CAMPO_REGOLA ADD CONSTRAINT FK_PBANDI_D_CAUSALE_BLOCCO_01
    FOREIGN KEY (ID_CAUSALE_BLOCCO) REFERENCES PBANDI_D_CAUSALE_BLOCCO (ID_CAUSALE_BLOCCO);


ALTER TABLE PBANDI_T_ENTE_GIURIDICO ADD CONSTRAINT FK_PBANDI_D_STATO_ATTIV_01 
    FOREIGN KEY (id_stato_attivita) REFERENCES PBANDI_D_STATO_ATTIVITA (id_stato_attivita);
	
ALTER TABLE PBANDI_T_ENTE_GIUR_SEZI ADD CONSTRAINT FK_PBANDI_D_SEZ_SPEC_01 
    FOREIGN KEY (id_sezione_speciale) REFERENCES PBANDI_D_SEZIONE_SPECIALE (id_sezione_speciale);

ALTER TABLE PBANDI_T_ENTE_GIUR_SEZI ADD CONSTRAINT FK_PBANDI_T_SOGGETTO_30 
    FOREIGN KEY (id_soggetto) REFERENCES PBANDI_T_SOGGETTO (id_soggetto);

ALTER TABLE PBANDI_T_RICHIESTA ADD CONSTRAINT FK_PBANDI_T_UTENTE_338 
    FOREIGN KEY (id_utente_richiedente) REFERENCES PBANDI_T_UTENTE (id_utente);

ALTER TABLE PBANDI_T_RICHIESTA ADD CONSTRAINT FK_PBANDI_D_TIPO_RICH_01 
    FOREIGN KEY (id_tipo_richiesta) REFERENCES PBANDI_D_TIPO_RICHIESTA (id_tipo_richiesta);

ALTER TABLE PBANDI_T_RICHIESTA ADD CONSTRAINT FK_PBANDI_D_STATO_RICH_01 
    FOREIGN KEY (id_stato_richiesta) REFERENCES PBANDI_D_STATO_RICHIESTA (id_stato_richiesta);

ALTER TABLE PBANDI_T_RICHIESTA ADD CONSTRAINT FK_PBANDI_T_DOMANDA_10 
    FOREIGN KEY (id_domanda) REFERENCES PBANDI_T_DOMANDA (id_domanda);

ALTER TABLE PBANDI_T_TRACCIATURA_RICH ADD CONSTRAINT FK_PBANDI_T_RICHIESTA_01 
    FOREIGN KEY (id_richiesta) REFERENCES PBANDI_T_RICHIESTA (id_richiesta);

ALTER TABLE PBANDI_T_TRACCIATURA_RICH ADD CONSTRAINT FK_D_TIPO_COMUNIC_01 
    FOREIGN KEY (id_tipo_comunicazione) REFERENCES PBANDI_D_TIPO_COMUNICAZIONE (id_tipo_comunicazione);

ALTER TABLE PBANDI_T_SOGGETTO_DURC ADD CONSTRAINT FK_PBANDI_D_TIPO_ESIT_RICH_01 
    FOREIGN KEY (id_tipo_esito_durc) REFERENCES PBANDI_D_TIPO_ESITO_RICHIESTE (id_tipo_esito_richieste);

ALTER TABLE PBANDI_T_SOGGETTO_DURC ADD CONSTRAINT FK_PBANDI_T_SOGGETTO_31 
    FOREIGN KEY (id_soggetto) REFERENCES PBANDI_T_SOGGETTO (id_soggetto);

--ALTER TABLE PBANDI_T_SOGGETTO_DSAN ADD CONSTRAINT FK_PBANDI_D_TIPO_ESIT_RICH_03 
--    FOREIGN KEY (id_esito_dsan) REFERENCES PBANDI_D_TIPO_ESITO_RICHIESTE (id_tipo_esito_richieste);

ALTER TABLE PBANDI_T_SOGGETTO_DSAN ADD CONSTRAINT FK_PBANDI_T_DOMANDA_09 
    FOREIGN KEY (id_domanda) REFERENCES PBANDI_T_DOMANDA (id_domanda);

ALTER TABLE PBANDI_T_SOGGETTO_ANTIMAFIA ADD CONSTRAINT FK_PBANDI_T_DOMANDA_08 
    FOREIGN KEY (id_domanda) REFERENCES PBANDI_T_DOMANDA (id_domanda);

ALTER TABLE PBANDI_T_SOGGETTO_ANTIMAFIA ADD CONSTRAINT FK_PBANDI_D_TIPO_ESIT_RICH_02 
    FOREIGN KEY (id_tipo_esito_antimafia) REFERENCES PBANDI_D_TIPO_ESITO_RICHIESTE (id_tipo_esito_richieste);

ALTER TABLE PBANDI_T_SOGG_DOMANDA_BLOCCO ADD CONSTRAINT FK_PBANDI_R_SOGG_DOMANDA_04 
    FOREIGN KEY (progr_soggetto_domanda) REFERENCES PBANDI_R_SOGGETTO_DOMANDA (progr_soggetto_domanda);

ALTER TABLE PBANDI_T_SOGG_DOMANDA_BLOCCO ADD CONSTRAINT FK_PBANDI_D_CAUS_BLOC_01 
    FOREIGN KEY (id_causale_blocco) REFERENCES PBANDI_D_CAUSALE_BLOCCO (id_causale_blocco);

ALTER TABLE PBANDI_D_CAUSALE_BLOCCO ADD CONSTRAINT FK_PBANDI_D_STATO_AZIENDA_03 
    FOREIGN KEY (ID_STATO_AZIENDA) REFERENCES PBANDI_D_STATO_AZIENDA (ID_STATO_AZIENDA);
	
ALTER TABLE PBANDI_D_TIPO_SOGG_CORRELATO ADD CONSTRAINT FK_PBANDI_D_TIPO_SOGGETTO_04 
    FOREIGN KEY (ID_TIPO_SOGGETTO) REFERENCES PBANDI_D_TIPO_SOGGETTO (ID_TIPO_SOGGETTO);

ALTER TABLE PBANDI_T_CALC_DIM_IMPRESA ADD CONSTRAINT FK_PBANDI_T_PERIODO_11 
    FOREIGN KEY (ID_PERIODO) REFERENCES PBANDI_T_PERIODO (id_periodo);

ALTER TABLE PBANDI_T_CALC_DIM_IMPRESA ADD CONSTRAINT FK_PBANDI_T_SOGGETTO_35 
    FOREIGN KEY (ID_SOGGETTO) REFERENCES PBANDI_T_SOGGETTO (id_soggetto);


ALTER TABLE PBANDI_T_ENTE_GIUR_SEZI ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_339
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_340
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);
	
ALTER TABLE PBANDI_T_SOGG_DOMANDA_BLOCCO ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_341
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_342
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);
	
ALTER TABLE PBANDI_T_SOGGETTO_DURC ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_343
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_344
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);
	
ALTER TABLE PBANDI_T_SOGGETTO_ANTIMAFIA ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_345
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_346
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);
	
ALTER TABLE PBANDI_T_SOGGETTO_DSAN ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_347
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_348
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);
	
ALTER TABLE PBANDI_T_RICHIESTA ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_349
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_350
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);
	
ALTER TABLE PBANDI_T_TRACCIATURA_RICH ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_351
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_352
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);

ALTER TABLE PBANDI_T_CALC_DIM_IMPRESA ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_390
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_391
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);

ALTER TABLE PBANDI_T_MON_SERV_AMMVO_CONTAB ADD CONSTRAINT FK_PBANDI_C_ENTITA_15 
    FOREIGN KEY (ID_ENTITA) REFERENCES PBANDI_C_ENTITA (ID_ENTITA);

ALTER TABLE PBANDI_T_MON_SERV_AMMVO_CONTAB ADD CONSTRAINT FK_PBANDI_D_SERV_AMMVO_CONT_01 
    FOREIGN KEY (ID_SERVIZIO) REFERENCES PBANDI_D_SERVIZI_AMMVO_CONTAB (ID_SERVIZIO);

ALTER TABLE PBANDI_T_MON_SERV_AMMVO_CONTAB ADD CONSTRAINT FK_PBANDI_T_UTENTE_406 
    FOREIGN KEY (ID_UTENTE) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_CAMPIONAMENTO_FINP ADD CONSTRAINT FK_PBANDI_D_FASE_CAMP_01 
    FOREIGN KEY (ID_FASE_CAMP) REFERENCES PBANDI_D_FASE_CAMP (ID_FASE_CAMP);

ALTER TABLE PBANDI_T_CAMPIONAMENTO_FINP ADD CONSTRAINT FK_PBANDI_D_TIPO_CAMP_01 
    FOREIGN KEY (ID_TIPO_CAMP) REFERENCES PBANDI_D_TIPO_CAMP (ID_TIPO_CAMP);

ALTER TABLE PBANDI_R_CAMP_PROGETTI ADD CONSTRAINT FK_PBANDI_T_PROGETTO_76 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI_T_PROGETTO (ID_PROGETTO);

ALTER TABLE PBANDI_R_CAMP_PROGETTI ADD CONSTRAINT FK_PBANDI_T_CAMP_FINP_02 
    FOREIGN KEY (ID_CAMPIONAMENTO) REFERENCES PBANDI_T_CAMPIONAMENTO_FINP (ID_CAMPIONAMENTO);

ALTER TABLE PBANDI_R_RIC_CAMP_TIPO_DICH_SP ADD CONSTRAINT FK_PBANDI_T_DICHIARAZ_SPESA_08 
    FOREIGN KEY (ID_TIPO_DICHIARAZ_SPESA) REFERENCES PBANDI_D_TIPO_DICHIARAZ_SPESA (ID_TIPO_DICHIARAZ_SPESA);

ALTER TABLE PBANDI_R_RIC_CAMP_TIPO_DICH_SP ADD CONSTRAINT FK_PBANDI_T_CAMP_FINP_03 
    FOREIGN KEY (ID_CAMPIONAMENTO) REFERENCES PBANDI_T_CAMPIONAMENTO_FINP (ID_CAMPIONAMENTO);

ALTER TABLE PBANDI_R_RIC_CAMP_BANDO_LINEA ADD CONSTRAINT FK_PBANDI_T_CAMP_FINP_01 
    FOREIGN KEY (ID_CAMPIONAMENTO) REFERENCES PBANDI_T_CAMPIONAMENTO_FINP (ID_CAMPIONAMENTO);

ALTER TABLE PBANDI_R_RIC_CAMP_BANDO_LINEA ADD CONSTRAINT FK_PBANDI_R_BANDO_LINEA_INT_31 
    FOREIGN KEY (PROGR_BANDO_LINEA_INTERVENTO) REFERENCES PBANDI_R_BANDO_LINEA_INTERVENT (PROGR_BANDO_LINEA_INTERVENTO);

ALTER TABLE PBANDI_T_RIC_CAMP_DICH_SP ADD CONSTRAINT FK_PBANDI_T_CAMP_FINP_04 
    FOREIGN KEY (ID_CAMPIONAMENTO) REFERENCES PBANDI_T_CAMPIONAMENTO_FINP (ID_CAMPIONAMENTO);
	
ALTER TABLE PBANDI_T_CONTROLLO_LOCO ADD CONSTRAINT FK_PBANDI_D_STATO_CONTR_LOCO_1 
    FOREIGN KEY (ID_STATO_CONTR_LOCO) REFERENCES PBANDI_D_STATO_CONTR_LOCO (ID_STATO_CONTR_LOCO);
	
ALTER TABLE PBANDI_T_CONTROLLO_LOCO ADD CONSTRAINT FK_PBANDI_D_CATEG_ANAG_10 
    FOREIGN KEY (ID_CATEG_ANAGRAFICA) REFERENCES PBANDI.PBANDI_D_CATEG_ANAGRAFICA (ID_CATEG_ANAGRAFICA);

ALTER TABLE PBANDI_R_CAMP_CONTR_LOCO ADD CONSTRAINT FK_PBANDI_R_CAMP_PROGETTI_1 
    FOREIGN KEY (ID_CAMPIONAMENTO, ID_PROGETTO) REFERENCES PBANDI_R_CAMP_PROGETTI (ID_CAMPIONAMENTO,ID_PROGETTO);

ALTER TABLE PBANDI_R_CAMP_CONTR_LOCO ADD CONSTRAINT FK_PBANDI_T_CONTR_LOCO_1 
    FOREIGN KEY (ID_CONTROLLO_LOCO) REFERENCES PBANDI_T_CONTROLLO_LOCO (ID_CONTROLLO_LOCO);


ALTER TABLE PBANDI_T_CONTROLLO_LOCO_ALTRI ADD CONSTRAINT FK_PBANDI_T_PROGETTO_83 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI_T_PROGETTO (ID_PROGETTO);

ALTER TABLE PBANDI_T_CONTROLLO_LOCO_ALTRI ADD CONSTRAINT FK_PBANDI_D_STATO_CONTR_LOCO_2 
    FOREIGN KEY (ID_STATO_CONTR_LOCO) REFERENCES PBANDI_D_STATO_CONTR_LOCO (ID_STATO_CONTR_LOCO);

ALTER TABLE PBANDI_T_CONTROLLO_LOCO_ALTRI ADD CONSTRAINT FK_PBANDI_D_CATEG_ANAG_11 
    FOREIGN KEY (ID_CATEG_ANAGRAFICA) REFERENCES PBANDI.PBANDI_D_CATEG_ANAGRAFICA (ID_CATEG_ANAGRAFICA);

ALTER TABLE PBANDI_T_RICHIESTA_INTEGRAZ ADD CONSTRAINT FK_PBANDI_C_ENTITA_11 
    FOREIGN KEY (ID_ENTITA) REFERENCES PBANDI.PBANDI_C_ENTITA (ID_ENTITA);

ALTER TABLE PBANDI_T_RICHIESTA_INTEGRAZ ADD CONSTRAINT FK_PBANDI_D_STATO_RICH_INT_02 
    FOREIGN KEY (ID_STATO_RICHIESTA) REFERENCES PBANDI.PBANDI_D_STATO_RICH_INTEGRAZ (ID_STATO_RICHIESTA);

ALTER TABLE PBANDI_T_CONTROLLO_LOCO ADD CONSTRAINT FK_PBANDI_D_ATTIV_CONTR_LOCO_1 
    FOREIGN KEY (ID_ATTIV_CONTR_LOCO) REFERENCES PBANDI.PBANDI_D_ATTIV_CONTROLLO_LOCO (ID_ATTIV_CONTR_LOCO);

ALTER TABLE PBANDI_T_CONTROLLO_LOCO_ALTRI ADD CONSTRAINT FK_PBANDI_D_ATTIV_CONTR_LOCO_2 
    FOREIGN KEY (ID_ATTIV_CONTR_LOCO) REFERENCES PBANDI.PBANDI_D_ATTIV_CONTROLLO_LOCO (ID_ATTIV_CONTR_LOCO);

ALTER TABLE PBANDI_T_CONTROLLO_LOCO_ALTRI ADD CONSTRAINT FK_PBANDI_D_STATO_CHECKLIST_01 
    FOREIGN KEY (ID_STATO_CHECKLIST) REFERENCES PBANDI_D_STATO_CHECKLIST (ID_STATO_CHECKLIST);


ALTER TABLE PBANDI_T_CAMPIONAMENTO_FINP ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_354 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_355 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);
    
ALTER TABLE PBANDI_R_CAMP_PROGETTI ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_356 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_357 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);
 
ALTER TABLE PBANDI_T_CONTROLLO_LOCO ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_374 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_375 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);

ALTER TABLE PBANDI_T_CONTROLLO_LOCO_ALTRI ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_384
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_385 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);

ALTER TABLE PBANDI_T_RICHIESTA_INTEGRAZ ADD
(
 CONSTRAINT FK_PBANDI_T_UTENTE_386
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_387 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_388 
 FOREIGN KEY (ID_UTENTE_RICHIESTA) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_389 
 FOREIGN KEY (ID_UTENTE_INVIO) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE)
    ON DELETE SET NULL);


ALTER TABLE PBANDI_T_INTEGRAZIONE_SPESA ADD CONSTRAINT FK_PBANDI_D_STATO_RICH_INT_01 
    FOREIGN KEY (ID_STATO_RICHIESTA) REFERENCES PBANDI_D_STATO_RICH_INTEGRAZ (ID_STATO_RICHIESTA);

ALTER TABLE PBANDI_T_PROROGA ADD CONSTRAINT FK_PBANDI_C_ENTITA_10 
    FOREIGN KEY (ID_ENTITA) REFERENCES PBANDI_C_ENTITA (ID_ENTITA);

ALTER TABLE PBANDI_T_PROROGA ADD CONSTRAINT FK_PBANDI_D_STATO_PROROGA_01 
    FOREIGN KEY (ID_STATO_PROROGA) REFERENCES PBANDI_D_STATO_PROROGA (ID_STATO_PROROGA);

ALTER TABLE PBANDI_T_PROROGA ADD CONSTRAINT FK_PBANDI_T_UTENTE_381 
    FOREIGN KEY (ID_UTENTE_INS) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_PROROGA ADD CONSTRAINT FK_PBANDI_T_UTENTE_380 
    FOREIGN KEY (ID_UTENTE_AGG) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);
	
ALTER TABLE PBANDI_T_FILE_ENTITA ADD CONSTRAINT FK_PBANDI_T_INTEGR_SPESA_01 
    FOREIGN KEY (ID_INTEGRAZIONE_SPESA) REFERENCES PBANDI_T_INTEGRAZIONE_SPESA (ID_INTEGRAZIONE_SPESA);
	

ALTER TABLE PBANDI_T_DISTINTA ADD CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_11 
    FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE) REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE);

ALTER TABLE PBANDI_T_DISTINTA ADD CONSTRAINT FK_PBANDI_T_ESTREMI_BANCARI_06 
    FOREIGN KEY (ID_ESTREMI_BANCARI) REFERENCES PBANDI_T_ESTREMI_BANCARI (ID_ESTREMI_BANCARI);

ALTER TABLE PBANDI_T_DISTINTA ADD CONSTRAINT FK_PBANDI_D_STATO_DISTINTA_01 
    FOREIGN KEY (ID_STATO_DISTINTA) REFERENCES PBANDI_D_STATO_DISTINTA (ID_STATO_DISTINTA);

ALTER TABLE PBANDI_T_DISTINTA ADD CONSTRAINT FK_PBANDI_T_UTENTE_392 
    FOREIGN KEY (ID_UTENTE_INS) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_DISTINTA ADD CONSTRAINT FK_PBANDI_T_UTENTE_393 
    FOREIGN KEY (ID_UTENTE_AGG) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_DISTINTA ADD CONSTRAINT FK_PBANDI_C_ENTITA_12 
    FOREIGN KEY (ID_ENTITA) REFERENCES PBANDI.PBANDI_C_ENTITA (ID_ENTITA);

ALTER TABLE PBANDI_T_DISTINTA ADD CONSTRAINT FK_PBANDI_D_TIPO_DISTINTA_01 
    FOREIGN KEY (ID_TIPO_DISTINTA) REFERENCES PBANDI_D_TIPO_DISTINTA (ID_TIPO_DISTINTA);

ALTER TABLE PBANDI_T_PROPOSTA_EROGAZIONE ADD CONSTRAINT FK_PBANDI_T_PROGETTO_85 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI_T_PROGETTO (ID_PROGETTO);

ALTER TABLE PBANDI_T_PROPOSTA_EROGAZIONE ADD CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_12 
    FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE) REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE);

ALTER TABLE PBANDI_T_PROPOSTA_EROGAZIONE ADD CONSTRAINT FK_PBANDI_T_UTENTE_394 
    FOREIGN KEY (ID_UTENTE_INS) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_PROPOSTA_EROGAZIONE ADD CONSTRAINT FK_PBANDI_T_UTENTE_395 
    FOREIGN KEY (ID_UTENTE_AGG) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_R_CTRL_NA_EROGAZIONE ADD CONSTRAINT FK_PBANDI_T_PROPOSTA_EROG_01 
    FOREIGN KEY (ID_PROPOSTA) REFERENCES PBANDI_T_PROPOSTA_EROGAZIONE (ID_PROPOSTA);

ALTER TABLE PBANDI_R_CTRL_NA_EROGAZIONE ADD CONSTRAINT FK_PBANDI_D_TIPO_RICH_02 
    FOREIGN KEY (ID_TIPO_RICHIESTA) REFERENCES PBANDI.PBANDI_D_TIPO_RICHIESTA (ID_TIPO_RICHIESTA);

ALTER TABLE PBANDI_R_CTRL_NA_EROGAZIONE ADD CONSTRAINT FK_PBANDI_T_UTENTE_396 
    FOREIGN KEY (ID_UTENTE_INS) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_R_CTRL_NA_EROGAZIONE ADD CONSTRAINT FK_PBANDI_T_UTENTE_397 
    FOREIGN KEY (ID_UTENTE_AGG) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_DISTINTA_DETT ADD CONSTRAINT FK_PBANDI_T_DISTINTA_01 
    FOREIGN KEY (ID_DISTINTA) REFERENCES PBANDI_T_DISTINTA (ID_DISTINTA);

ALTER TABLE PBANDI_T_DISTINTA_DETT ADD CONSTRAINT FK_PBANDI_T_UTENTE_398 
    FOREIGN KEY (ID_UTENTE_INS) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_DISTINTA_DETT ADD CONSTRAINT FK_PBANDI_T_UTENTE_399 
    FOREIGN KEY (ID_UTENTE_AGG) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_EROGAZIONE ADD CONSTRAINT FK_PBANDI_T_DISTINTA_02 
    FOREIGN KEY (ID_DISTINTA) REFERENCES PBANDI_T_DISTINTA (ID_DISTINTA);

ALTER TABLE PBANDI_T_RECUPERO ADD CONSTRAINT FK_PBANDI_T_DISTINTA_04 
    FOREIGN KEY (ID_DISTINTA) REFERENCES PBANDI_T_DISTINTA (ID_DISTINTA);


ALTER TABLE PBANDI_T_PROP_EROG_CTRL_RNA ADD (
  CONSTRAINT fk_pbandi_t_soggetto_36
  FOREIGN KEY (ID_SOGGETTO) 
  REFERENCES PBANDI_T_SOGGETTO (ID_SOGGETTO));

-- FK 
ALTER TABLE PBANDI_T_PROP_EROG_CTRL_RNA ADD (
  CONSTRAINT fk_pbandi_t_utente_404
  FOREIGN KEY (ID_UTENTE_INS) 
  REFERENCES PBANDI_T_UTENTE (ID_UTENTE));

-- FK 
ALTER TABLE PBANDI_T_PROP_EROG_CTRL_RNA ADD (
  CONSTRAINT fk_pbandi_t_utente_405
  FOREIGN KEY (ID_UTENTE_AGG) 
  REFERENCES PBANDI_T_UTENTE (ID_UTENTE));

ALTER TABLE PBANDI_T_ESCUSSIONE ADD CONSTRAINT FK_PBANDI_T_PROGETTO_82 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI_T_PROGETTO (ID_PROGETTO);

ALTER TABLE PBANDI_T_ESCUSSIONE ADD CONSTRAINT FK_PBANDI_T_UTENTE_382 
    FOREIGN KEY (ID_UTENTE_INS) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_ESCUSSIONE ADD CONSTRAINT FK_PBANDI_T_UTENTE_383 
    FOREIGN KEY (ID_UTENTE_AGG) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_ESCUSSIONE ADD CONSTRAINT FK_PBANDI_D_TIPO_ESCUSS_1 
    FOREIGN KEY (ID_TIPO_ESCUSSIONE) REFERENCES PBANDI_D_TIPO_ESCUSSIONE (ID_TIPO_ESCUSSIONE);

ALTER TABLE PBANDI_T_ESCUSSIONE ADD CONSTRAINT FK_PBANDI_D_STATO_ESCUSS_1 
    FOREIGN KEY (ID_STATO_ESCUSSIONE) REFERENCES PBANDI_D_STATO_ESCUSSIONE (ID_STATO_ESCUSSIONE);

ALTER TABLE PBANDI_T_ESCUSSIONE ADD CONSTRAINT FK_PBANDI_T_DISTINTA_03 
    FOREIGN KEY (ID_DISTINTA) REFERENCES PBANDI_T_DISTINTA (ID_DISTINTA);

ALTER TABLE PBANDI_T_ESCUSSIONE ADD CONSTRAINT FK_PBANDI_T_PROPOSTA_EROG_03
    FOREIGN KEY (ID_PROPOSTA_EROGAZIONE) REFERENCES PBANDI_T_PROPOSTA_EROGAZIONE (ID_PROPOSTA);
	

ALTER TABLE PBANDI_R_TIPO_STATO_ITER ADD CONSTRAINT FK_PBANDI_D_INCARICO_01 
    FOREIGN KEY (ID_INCARICO) REFERENCES PBANDI_D_INCARICO (ID_INCARICO);

ALTER TABLE PBANDI_R_TIPO_STATO_ITER ADD CONSTRAINT FK_PBANDI_D_TIPO_ITER_01 
    FOREIGN KEY (ID_TIPO_ITER) REFERENCES PBANDI_D_TIPO_ITER (ID_TIPO_ITER);

ALTER TABLE PBANDI_R_TIPO_STATO_ITER ADD CONSTRAINT FK_PBANDI_D_STATO_ITER_01 
    FOREIGN KEY (ID_STATO_ITER) REFERENCES PBANDI_D_STATO_ITER (ID_STATO_ITER);

ALTER TABLE PBANDI_T_WORK_FLOW ADD CONSTRAINT FK_PBANDI_T_UTENTE_370 
    FOREIGN KEY (ID_UTENTE_INS) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_WORK_FLOW ADD CONSTRAINT FK_PBANDI_T_UTENTE_371 
    FOREIGN KEY (ID_UTENTE_AGG) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_WORK_FLOW ADD CONSTRAINT FK_PBANDI_D_TIPO_ITER_02 
    FOREIGN KEY (ID_TIPO_ITER) REFERENCES PBANDI_D_TIPO_ITER (ID_TIPO_ITER);

ALTER TABLE PBANDI_T_DETT_WORK_FLOW ADD CONSTRAINT FK_PBANDI_T_WORK_FLOW_01 
    FOREIGN KEY (ID_WORK_FLOW) REFERENCES PBANDI_T_WORK_FLOW (ID_WORK_FLOW);

ALTER TABLE PBANDI_T_DETT_WORK_FLOW ADD CONSTRAINT FK_PBANDI_T_UTENTE_372 
    FOREIGN KEY (ID_UTENTE_INS) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_DETT_WORK_FLOW ADD CONSTRAINT FK_PBANDI_T_UTENTE_373 
    FOREIGN KEY (ID_UTENTE_AGG) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_DETT_WORK_FLOW ADD CONSTRAINT FK_PBANDI_D_STATO_ITER_02 
    FOREIGN KEY (ID_STATO_ITER) REFERENCES PBANDI_D_STATO_ITER (ID_STATO_ITER);

ALTER TABLE PBANDI_T_WORK_FLOW_ENTITA ADD CONSTRAINT FK_PBANDI_T_WORK_FLOW_02 
    FOREIGN KEY (ID_WORK_FLOW) REFERENCES PBANDI_T_WORK_FLOW (ID_WORK_FLOW);

ALTER TABLE PBANDI_T_WORK_FLOW_ENTITA ADD CONSTRAINT FK_PBANDI_C_ENTITA_09 
    FOREIGN KEY (ID_ENTITA) REFERENCES PBANDI_C_ENTITA (ID_ENTITA);

ALTER TABLE PBANDI_T_WORK_FLOW_ENTITA ADD CONSTRAINT FK_PBANDI_T_PROGETTO_81 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI_T_PROGETTO (ID_PROGETTO);

ALTER TABLE PBANDI_T_WORK_FLOW_ENTITA ADD CONSTRAINT FK_PBANDI_T_UTENTE_377 
    FOREIGN KEY (ID_UTENTE_INS) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_WORK_FLOW_ENTITA ADD CONSTRAINT FK_PBANDI_T_UTENTE_376 
    FOREIGN KEY (ID_UTENTE_AGG) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_R_INCARICO_SOGGETTO ADD CONSTRAINT FK_PBANDI_D_INCARICO_02 
    FOREIGN KEY (ID_INCARICO) REFERENCES PBANDI_D_INCARICO (ID_INCARICO);

ALTER TABLE PBANDI_R_INCARICO_SOGGETTO ADD CONSTRAINT FK_PBANDI_T_SOGGETTO_38 
    FOREIGN KEY (ID_SOGGETTO) REFERENCES PBANDI_T_SOGGETTO (ID_SOGGETTO);

ALTER TABLE PBANDI_T_ACTIVEINFO_METADATA ADD CONSTRAINT FK_PBANDI_T_PROGETTO_87 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI_T_PROGETTO (ID_PROGETTO);


ALTER TABLE PBANDI_R_BANDO_MOD_AG_ESTR_BAN ADD CONSTRAINT FK_PBANDI_R_BANDO_MODAL_AGE_01 
    FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE, ID_BANDO) REFERENCES PBANDI_R_BANDO_MODALITA_AGEVOL (ID_MODALITA_AGEVOLAZIONE,ID_BANDO);

ALTER TABLE PBANDI_R_BANDO_MOD_AG_ESTR_BAN ADD CONSTRAINT FK_PBANDI_T_ESTREMI_BANCARI_05 
    FOREIGN KEY (ID_ESTREMI_BANCARI) REFERENCES PBANDI_T_ESTREMI_BANCARI (ID_ESTREMI_BANCARI);

ALTER TABLE PBANDI_R_BANDO_MOD_AG_ESTR_BAN ADD CONSTRAINT FK_PBANDI_T_UTENTE_360 
    FOREIGN KEY (ID_UTENTE_INS) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_R_BANDO_MOD_AG_ESTR_BAN ADD CONSTRAINT FK_PBANDI_T_UTENTE_361 
    FOREIGN KEY (ID_UTENTE_AGG) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_NOTE ADD CONSTRAINT FK_PBANDI_T_SOGGETTO_33 
    FOREIGN KEY (ID_SOGGETTO_BENEFICIARIO) REFERENCES PBANDI_T_SOGGETTO (ID_SOGGETTO);

ALTER TABLE PBANDI_T_NOTE ADD CONSTRAINT FK_PBANDI_T_PROGETTO_78 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI_T_PROGETTO (ID_PROGETTO);

ALTER TABLE PBANDI_T_NOTE ADD CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_09 
    FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE) REFERENCES PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE);

ALTER TABLE PBANDI_T_NOTE ADD CONSTRAINT FK_PBANDI_T_UTENTE_362 
    FOREIGN KEY (ID_UTENTE_INS) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_NOTE ADD CONSTRAINT FK_PBANDI_T_UTENTE_363 
    FOREIGN KEY (ID_UTENTE_AGG) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_AMMORTAMENTO_PROGETTI ADD CONSTRAINT FK_T_DELIBERA_PROG_01 
    FOREIGN KEY (ID_DELIBERA) REFERENCES PBANDI_T_DELIBERA_PROGETTI (ID_DELIBERA);


ALTER TABLE PBANDI_T_AMMORTAMENTO_PROGETTI ADD CONSTRAINT FK_D_TIPO_CALC_AMM_01 
    FOREIGN KEY (ID_TIPO_CALC_AMM) REFERENCES PBANDI_D_TIPO_CALCOLO_AMM (ID_TIPO_CALC_AMM);

ALTER TABLE PBANDI_T_AMMORTAMENTO_PROGETTI ADD CONSTRAINT FK_D_TASSO_AMM_01 
    FOREIGN KEY (ID_TASSO_AMM) REFERENCES PBANDI_D_TASSO_AMM (ID_TASSO_AMM);

ALTER TABLE PBANDI_T_AMMORTAMENTO_PROGETTI ADD CONSTRAINT FK_PBANDI_T_UTENTE_366 
    FOREIGN KEY (ID_UTENTE_INS) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_AMMORTAMENTO_PROGETTI ADD CONSTRAINT FK_PBANDI_T_UTENTE_367 
    FOREIGN KEY (ID_UTENTE_AGG) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_AMMORTAMENTO_PROGETTI ADD CONSTRAINT FK_D_TIPI_TASSI_01 
    FOREIGN KEY (ID_TIPO_TASSO) REFERENCES PBANDI_D_TIPO_TASSI (ID_TIPO_TASSO);

ALTER TABLE PBANDI_T_AMMORTAMENTO_PROGETTI ADD CONSTRAINT FK_PBANDI_D_TIPO_PER_AMMORT_01 
    FOREIGN KEY (ID_TIPO_PERIODO_AMMORTAMENTO) REFERENCES PBANDI_D_TIPO_PERIODO_AMMORT (ID_TIPO_PERIODO_AMMORTAMENTO);

ALTER TABLE PBANDI_T_AMMORTAMENTO_PROGETTI ADD CONSTRAINT FK_pbandi_d_freq_ammort_01 
    FOREIGN KEY (ID_FREQUENZA_AMMORTAMENTO) REFERENCES pbandi_d_frequenza_ammort(ID_FREQUENZA_AMMORTAMENTO);

ALTER TABLE PBANDI_T_RNA_PROGETTO ADD CONSTRAINT fk_pbandi_t_progetto_86 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI_T_PROGETTO (ID_PROGETTO);

ALTER TABLE PBANDI_T_RNA_PROGETTO ADD CONSTRAINT FK_PBANDI_W_RNA_CARICAM_XML_01 
    FOREIGN KEY (ID_CARICAMENTO) REFERENCES PBANDI_W_RNA_CARICAMENTO_XML (ID_CARICAMENTO);

ALTER TABLE PBANDI_T_RNA_PROGETTO ADD CONSTRAINT FK_PBANDI_D_RNA_TIPO_VARIAZ_01 
    FOREIGN KEY (COD_TIPO_VARIAZIONE) REFERENCES PBANDI_D_RNA_TIPO_VARIAZIONE (COD_TIPO_VARIAZIONE);

ALTER TABLE PBANDI_T_RNA_PROGETTO ADD CONSTRAINT FK_PBANDI_T_UTENTE_407 
    FOREIGN KEY (ID_UTENTE_INS) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_RNA_PROGETTO ADD CONSTRAINT FK_PBANDI_T_UTENTE_408 
    FOREIGN KEY (ID_UTENTE_AGG) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);
  
ALTER TABLE PBANDI.PBANDI_T_RNA_AGEVOLAZIONE ADD (
  CONSTRAINT FK_PBANDI_T_PROGETTO_100 
 FOREIGN KEY (ID_RNA_PROGETTO) 
 REFERENCES PBANDI.PBANDI_T_RNA_PROGETTO (ID_RNA_PROGETTO),
  CONSTRAINT FK_PBANDI_D_MODALITA_AGEVOL_14 
 FOREIGN KEY (ID_MODALITA_AGEVOLAZIONE) 
 REFERENCES PBANDI.PBANDI_D_MODALITA_AGEVOLAZIONE (ID_MODALITA_AGEVOLAZIONE),
  CONSTRAINT FK_PBANDI_T_UTENTE_450 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_451 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE));  

ALTER TABLE PBANDI.PBANDI_T_RNA_COSTO_GEST ADD (
  CONSTRAINT FK_PBANDI_T_PROGETTO_101 
 FOREIGN KEY (ID_RNA_PROGETTO) 
 REFERENCES PBANDI.PBANDI_T_RNA_PROGETTO (ID_RNA_PROGETTO),
  CONSTRAINT FK_PBANDI_T_UTENTE_452 
 FOREIGN KEY (ID_UTENTE_INS) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_UTENTE_453 
 FOREIGN KEY (ID_UTENTE_AGG) 
 REFERENCES PBANDI.PBANDI_T_UTENTE (ID_UTENTE),
  CONSTRAINT FK_PBANDI_T_RIGO_CONTO_ECON_04 
 FOREIGN KEY (ID_RIGO_CONTO_ECONOMICO) 
 REFERENCES PBANDI.PBANDI_T_RIGO_CONTO_ECONOMICO (ID_RIGO_CONTO_ECONOMICO));

  

ALTER TABLE PBANDI_L_LOG_FILE_AFAI ADD CONSTRAINT FK_PBANDI_T_ACTINFO_METAD_01 
    FOREIGN KEY (ID_METADATA) REFERENCES PBANDI_T_ACTIVEINFO_METADATA (ID_METADATA);


ALTER TABLE PBANDI_T_GESTIONE_REVOCA ADD CONSTRAINT FK_PBANDI_T_PROGETTO_77 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI_T_PROGETTO (ID_PROGETTO);

ALTER TABLE PBANDI_T_GESTIONE_REVOCA ADD CONSTRAINT FK_PBANDI_D_TIPO_REVOCA_01 
    FOREIGN KEY (ID_TIPOLOGIA_REVOCA) REFERENCES PBANDI_D_TIPOLOGIA_REVOCA (ID_TIPOLOGIA_REVOCA);

ALTER TABLE PBANDI_T_GESTIONE_REVOCA ADD CONSTRAINT FK_PBANDI_D_CATEG_ANAG_09 
    FOREIGN KEY (ID_CATEG_ANAGRAFICA) REFERENCES PBANDI_D_CATEG_ANAGRAFICA (ID_CATEG_ANAGRAFICA);

ALTER TABLE PBANDI_T_GESTIONE_REVOCA ADD CONSTRAINT FK_PBANDI_D_MANCATO_REC_02 
    FOREIGN KEY (ID_MANCATO_RECUPERO) REFERENCES PBANDI_D_MANCATO_RECUPERO (ID_MANCATO_RECUPERO);

ALTER TABLE PBANDI_T_GESTIONE_REVOCA ADD CONSTRAINT FK_PBANDI_D_STATO_REVOCA_01 
    FOREIGN KEY (ID_STATO_REVOCA) REFERENCES PBANDI_D_STATO_REVOCA (ID_STATO_REVOCA);

ALTER TABLE PBANDI_T_GESTIONE_REVOCA ADD CONSTRAINT FK_PBANDI_D_ATTIV_REVOCA_01 
    FOREIGN KEY (ID_ATTIVITA_REVOCA) REFERENCES PBANDI_D_ATTIVITA_REVOCA (ID_ATTIVITA_REVOCA);

ALTER TABLE PBANDI_T_GESTIONE_REVOCA ADD CONSTRAINT FK_PBANDI_T_UTENTE_358 
    FOREIGN KEY (ID_UTENTE_INS) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_GESTIONE_REVOCA ADD CONSTRAINT FK_PBANDI_T_UTENTE_359 
    FOREIGN KEY (ID_UTENTE_AGG) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_GESTIONE_REVOCA ADD CONSTRAINT FK_PBANDI_D_CAUS_BLOC_02 
    FOREIGN KEY (ID_CAUSALE_BLOCCO) REFERENCES PBANDI_D_CAUSALE_BLOCCO (ID_CAUSALE_BLOCCO);

ALTER TABLE PBANDI_T_GESTIONE_REVOCA ADD CONSTRAINT FK_PBANDI_D_MOTIVO_REVOCA_04 
    FOREIGN KEY (ID_MOTIVO_REVOCA) REFERENCES PBANDI_D_MOTIVO_REVOCA (ID_MOTIVO_REVOCA);

ALTER TABLE PBANDI_T_GESTIONE_REVOCA ADD CONSTRAINT FK_PBANDI_T_DICHIARAZ_SPESA_10 
    FOREIGN KEY (ID_DICHIARAZIONE_SPESA ) REFERENCES PBANDI_T_DICHIARAZIONE_SPESA (ID_DICHIARAZIONE_SPESA);

ALTER TABLE PBANDI_D_ATTIVITA_REVOCA ADD CONSTRAINT FK_PBANDI_D_TIPO_REVOCA_03 
    FOREIGN KEY (ID_TIPOLOGIA_REVOCA) REFERENCES PBANDI_D_TIPOLOGIA_REVOCA (ID_TIPOLOGIA_REVOCA);

ALTER TABLE PBANDI_R_STATO_TIPO_REVOCA ADD CONSTRAINT FK_PBANDI_D_TIPO_REVOCA_02 
    FOREIGN KEY (ID_TIPOLOGIA_REVOCA) REFERENCES PBANDI_D_TIPOLOGIA_REVOCA (ID_TIPOLOGIA_REVOCA);

ALTER TABLE PBANDI_R_STATO_TIPO_REVOCA ADD CONSTRAINT FK_PBANDI_D_STATO_REVOCA_02 
    FOREIGN KEY (ID_STATO_REVOCA) REFERENCES PBANDI_D_STATO_REVOCA (ID_STATO_REVOCA);

ALTER TABLE PBANDI_T_CONTRODEDUZ ADD CONSTRAINT FK_PBANDI_C_ENTITA_13
    FOREIGN KEY (ID_ENTITA) REFERENCES PBANDI_C_ENTITA (ID_ENTITA);

ALTER TABLE PBANDI_T_CONTRODEDUZ ADD CONSTRAINT FK_PBANDI_CONTRODEDUZ_01 
    FOREIGN KEY (ID_STATO_CONTRODEDUZ) REFERENCES PBANDI_D_STATO_CONTRODEDUZ (ID_STATO_CONTRODEDUZ);

ALTER TABLE PBANDI_T_CONTRODEDUZ ADD CONSTRAINT FK_PBANDI_D_ATTIV_CON_DEDUZ_01 
    FOREIGN KEY (ID_ATTIV_CONTRODEDUZ) REFERENCES PBANDI_D_ATTIV_CONTRODEDUZ (ID_ATTIV_CONTRODEDUZ);

ALTER TABLE PBANDI_T_CONTRODEDUZ ADD CONSTRAINT FK_PBANDI_T_UTENTE_400 
    FOREIGN KEY (ID_UTENTE_INS) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_CONTRODEDUZ ADD CONSTRAINT FK_PBANDI_T_UTENTE_401 
    FOREIGN KEY (ID_UTENTE_AGG) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_CONTESTAZ ADD CONSTRAINT FK_PBANDI_C_ENTITA_14 
    FOREIGN KEY (ID_ENTITA) REFERENCES PBANDI_C_ENTITA (ID_ENTITA);

ALTER TABLE PBANDI_T_CONTESTAZ ADD CONSTRAINT FK_PBANDI_D_STATO_CONTESTAZ_01 
    FOREIGN KEY (ID_STATO_CONTESTAZ) REFERENCES PBANDI_D_STATO_CONTESTAZ (ID_STATO_CONTESTAZ);

ALTER TABLE PBANDI_T_CONTESTAZ ADD CONSTRAINT FK_PBANDI_T_UTENTE_402
    FOREIGN KEY (ID_UTENTE_INS) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_CONTESTAZ ADD CONSTRAINT FK_PBANDI_T_UTENTE_403 
    FOREIGN KEY (ID_UTENTE_AGG) REFERENCES PBANDI_T_UTENTE (ID_UTENTE);

ALTER TABLE PBANDI_T_REVOCA ADD CONSTRAINT FK_PBANDI_T_GESTIONE_REVOCA_01 
    FOREIGN KEY (ID_GESTIONE_REVOCA) REFERENCES PBANDI_T_GESTIONE_REVOCA (ID_GESTIONE_REVOCA);


ALTER TABLE PBANDI_T_MONIT_TEMPI ADD CONSTRAINT FK_PBANDI_T_PROGETTO_80 
    FOREIGN KEY (ID_PROGETTO) REFERENCES PBANDI_T_PROGETTO (ID_PROGETTO);

ALTER TABLE PBANDI_T_MONIT_TEMPI ADD CONSTRAINT FK_PBANDI_C_ENTITA_08 
    FOREIGN KEY (ID_ENTITA) REFERENCES PBANDI_C_ENTITA (ID_ENTITA);

ALTER TABLE PBANDI_T_MONIT_TEMPI ADD CONSTRAINT FK_PBANDI_R_PAR_MON_BAN_LIN_01 
    FOREIGN KEY (ID_PARAM_MONIT_BANDO_LINEA) REFERENCES PBANDI_R_PARAM_MONIT_BANDO_LIN (ID_PARAM_MONIT_BANDO_LINEA);

ALTER TABLE PBANDI_T_MONIT_TEMPI ADD CONSTRAINT FK_PBANDI_T_MONIT_TEMPI_01 
    FOREIGN KEY (ID_MONIT_TEMPI_SOSPESO) REFERENCES PBANDI_T_MONIT_TEMPI (ID_MONIT_TEMPI);

ALTER TABLE PBANDI_R_PARAM_MONIT_BANDO_LIN ADD CONSTRAINT FK_PBANDI_R_BANDO_LINEA_INT_32 
    FOREIGN KEY (PROGR_BANDO_LINEA_INTERVENTO) REFERENCES PBANDI_R_BANDO_LINEA_INTERVENT (PROGR_BANDO_LINEA_INTERVENTO);

ALTER TABLE PBANDI_R_PARAM_MONIT_BANDO_LIN ADD CONSTRAINT FK_PBANDI_C_PARAM_MONIT_01 
    FOREIGN KEY (ID_PARAMETRO_MONIT) REFERENCES PBANDI_C_PARAMETRI_MONIT (ID_PARAMETRO_MONIT);
	
ALTER TABLE PBANDI_C_PARAMETRI_MONIT ADD CONSTRAINT FK_PBANDI_D_TEMPL_NOTIFICA_02 
    FOREIGN KEY (ID_TEMPLATE_NOTIFICA) REFERENCES PBANDI_D_TEMPLATE_NOTIFICA (ID_TEMPLATE_NOTIFICA);


ALTER TABLE PBANDI_W_RNA_CARICAMENTO_XML ADD CONSTRAINT FK_PBANDI_T_RNAWS_INVIO_XML_01 
    FOREIGN KEY (ID_ELAB, NUM_FILE) REFERENCES PBANDI_T_RNAWS_INVIO_XML (ID_ELAB,NUM_FILE);

/*
ALTER TABLE PBANDI_W_RNAWS_INVIO_ELAB ADD CONSTRAINT FK_PBANDI_D_RNA_BANDI_02 
    FOREIGN KEY (COD_BANDO) REFERENCES PBANDI_D_RNA_BANDI (COD_BANDO);
*/

ALTER TABLE PBANDI_W_RNAWS_INVIO_ELAB ADD CONSTRAINT FK_PBANDI_D_RNA_STATI_ELAB_01 
    FOREIGN KEY (COD_STATO_ELAB) REFERENCES PBANDI_D_RNA_STATI_ELAB (COD_STATO_ELAB);

ALTER TABLE PBANDI_T_RNAWS_INVIO_XML ADD CONSTRAINT FK_PBANDI_W_RNAWS_INV_ELAB_01 
    FOREIGN KEY (ID_ELAB) REFERENCES PBANDI_W_RNAWS_INVIO_ELAB (ID_ELAB);

ALTER TABLE PBANDI_T_RNAWS_INVIO_XML ADD CONSTRAINT FK_PBANDI_D_RNA_TIPO_VARIAZ_02 
    FOREIGN KEY (COD_TIPO_VARIAZIONE) REFERENCES PBANDI_D_RNA_TIPO_VARIAZIONE (COD_TIPO_VARIAZIONE);

ALTER TABLE PBANDI_T_RNAWS_CONFERMA ADD CONSTRAINT FK_PBANDI_W_CAR_CONF_ESITO_01 
    FOREIGN KEY (ID_CARICAMENTO) REFERENCES PBANDI_W_RNA_CARIC_CONF_ESITO (ID_CARICAMENTO);

ALTER TABLE PBANDI_D_FORMA_GIURIDICA ADD CONSTRAINT FK_PBANDI_D_FORMA_GIURIDICA_08 
    FOREIGN KEY (COD_FORMA_GIURIDICA_RNA) REFERENCES PBANDI_D_RNA_FORME_GIURIDICHE (COD_FORMA_GIURIDICA_RNA);

ALTER TABLE PBANDI_D_DIMENSIONE_IMPRESA ADD CONSTRAINT FK_PBANDI_D_RNA_DIM_IMPR_01 
    FOREIGN KEY (ID_DIMENSIONE_IMPRESA_RNA) REFERENCES PBANDI_D_RNA_DIMENSION_IMPRESA (ID_DIMENSIONE_IMPRESA_RNA);



/* -------------------------------VIEWS -----------------------------------------*/
-- Vista PBANDI_V_NOTE_MONITORAGGIO
CREATE OR REPLACE VIEW PBANDI_V_NOTE_MONITORAGGIO AS
SELECT ID_PROGETTO,
       ID_MODALITA_AGEVOLAZIONE,
       NOME_ENTITA_PROVENIENZA,
	   NOTE,
	   DT_INIZIO_VALIDITA,
	   ID_UTENTE_INS,
	   ID_UTENTE_AGG,
       DT_INSERIMENTO,
       DT_AGGIORNAMENTO
FROM
	(
	SELECT ID_PROGETTO,
	       ID_MODALITA_AGEVOLAZIONE,
		   'Revoca bancaria' AS NOME_ENTITA_PROVENIENZA,
		   NOTE,
		   DT_INIZIO_VALIDITA,
		   DT_FINE_VALIDITA,
		   ID_UTENTE_INS,
		   ID_UTENTE_AGG,
		   DT_INSERIMENTO,
		   DT_AGGIORNAMENTO
	  FROM PBANDI_T_REVOCA_BANCARIA
	UNION ALL
	SELECT ID_PROGETTO,
	       ID_MODALITA_AGEVOLAZIONE,
		   'Liberazione garante' AS NOME_ENTITA_PROVENIENZA,
		   NOTE,
		   DT_INIZIO_VALIDITA,
		   DT_FINE_VALIDITA,
		   ID_UTENTE_INS,
		   ID_UTENTE_AGG,
		   DT_INSERIMENTO,
		   DT_AGGIORNAMENTO
	  FROM PBANDI_T_LIBERAZ_GARANTE  
	UNION ALL
	SELECT ID_PROGETTO,
	       ID_MODALITA_AGEVOLAZIONE,
		   'Abbattimento garanzie '||b.DESC_BREVE_ATT_MONIT_CRED AS NOME_ENTITA_PROVENIENZA,
		   NOTE,
		   a.DT_INIZIO_VALIDITA,
		   a.DT_FINE_VALIDITA,
		   a.ID_UTENTE_INS,
		   a.ID_UTENTE_AGG,
		   a.DT_INSERIMENTO,
		   a.DT_AGGIORNAMENTO
	  FROM PBANDI_T_ABBATTIM_GARANZIE a
	  LEFT JOIN PBANDI_D_ATTIVITA_MONIT_CRED b on b.id_attivita_monit_cred = a.id_attivita_garanzie
	  LEFT JOIN PBANDI_D_TIPO_MONIT_CRED c on c.id_tipo_monit_cred = b.id_tipo_monit_cred and DESC_BREVE_TIPO_MONIT_CRED = 'tipo garanzia'
	UNION ALL
	SELECT ID_PROGETTO,
	       ID_MODALITA_AGEVOLAZIONE,
		   'Recupero banca '||b.DESC_BREVE_ATT_MONIT_CRED AS NOME_ENTITA_PROVENIENZA,
		   NOTE,
		   a.DT_INIZIO_VALIDITA,
		   a.DT_FINE_VALIDITA,
		   a.ID_UTENTE_INS,
		   a.ID_UTENTE_AGG,
		   a.DT_INSERIMENTO,
		   a.DT_AGGIORNAMENTO
	  FROM PBANDI_T_AZIONE_RECUP_BANCA a
	  LEFT JOIN PBANDI_D_ATTIVITA_MONIT_CRED b on b.id_attivita_monit_cred = a.id_attivita_azione
	  LEFT JOIN PBANDI_D_TIPO_MONIT_CRED c on c.id_tipo_monit_cred = b.id_tipo_monit_cred and DESC_BREVE_TIPO_MONIT_CRED = 'tipo azione'
	UNION ALL
	SELECT ID_PROGETTO,
	       ID_MODALITA_AGEVOLAZIONE,
		   'Escussione Confidi' AS NOME_ENTITA_PROVENIENZA,
		   NOTE,
		   a.DT_INIZIO_VALIDITA,
		   a.DT_FINE_VALIDITA,
		   a.ID_UTENTE_INS,
		   a.ID_UTENTE_AGG,
		   a.DT_INSERIMENTO,
		   a.DT_AGGIORNAMENTO
	  FROM PBANDI_T_ESCUSS_CONFIDI a
	UNION ALL
	SELECT ID_PROGETTO,
	       ID_MODALITA_AGEVOLAZIONE,
		   'Piano di rientro '||b.DESC_BREVE_ATT_MONIT_CRED AS NOME_ENTITA_PROVENIENZA,
		   NOTE,
		   a.DT_INIZIO_VALIDITA,
		   a.DT_FINE_VALIDITA,
		   a.ID_UTENTE_INS,
		   a.ID_UTENTE_AGG,
		   a.DT_INSERIMENTO,
		   a.DT_AGGIORNAMENTO
	  FROM PBANDI_T_PIANO_RIENTRO a  -- ID_ATTIVITA_RECUPERO
	  LEFT JOIN PBANDI_D_ATTIVITA_MONIT_CRED b on b.id_attivita_monit_cred = a.id_attivita_recupero
	  LEFT JOIN PBANDI_D_TIPO_MONIT_CRED c on c.id_tipo_monit_cred = b.id_tipo_monit_cred and DESC_BREVE_TIPO_MONIT_CRED = 'tipo recupero'
	UNION ALL
	SELECT ID_PROGETTO,
	       ID_MODALITA_AGEVOLAZIONE,
		   'Saldo e stralcio '||b.DESC_BREVE_ATT_MONIT_CRED AS NOME_ENTITA_PROVENIENZA,
		   NOTE,
		   a.DT_INIZIO_VALIDITA,
		   a.DT_FINE_VALIDITA,
		   a.ID_UTENTE_INS,
		   a.ID_UTENTE_AGG,
		   a.DT_INSERIMENTO,
		   a.DT_AGGIORNAMENTO
	  FROM PBANDI_T_SALDO_STRALCIO a --ID_ATTIVITA_SALDO_STRALCIO
	  LEFT JOIN PBANDI_D_ATTIVITA_MONIT_CRED b on b.id_attivita_monit_cred = a.id_attivita_saldo_stralcio
	  LEFT JOIN PBANDI_D_TIPO_MONIT_CRED c on c.id_tipo_monit_cred = b.id_tipo_monit_cred and DESC_BREVE_TIPO_MONIT_CRED = 'tipo saldo stralcio'
	UNION ALL
	SELECT ID_PROGETTO,
	       ID_MODALITA_AGEVOLAZIONE,
		   'Passaggio a perdita' AS NOME_ENTITA_PROVENIENZA,
		   NOTE,
		   a.DT_INIZIO_VALIDITA,
		   a.DT_FINE_VALIDITA,
		   a.ID_UTENTE_INS,
		   a.ID_UTENTE_AGG,
		   a.DT_INSERIMENTO,
		   a.DT_AGGIORNAMENTO
	  FROM PBANDI_T_PASSAGGIO_PERDITA a
	UNION ALL
	SELECT ID_PROGETTO,
	       ID_MODALITA_AGEVOLAZIONE,
		   'Liberazione banca' AS NOME_ENTITA_PROVENIENZA,
		   NOTE,
		   a.DT_INIZIO_VALIDITA,
		   a.DT_FINE_VALIDITA,
		   a.ID_UTENTE_INS,
		   a.ID_UTENTE_AGG,
		   a.DT_INSERIMENTO,
		   a.DT_AGGIORNAMENTO
	  FROM PBANDI_T_LIBERAZ_BANCA a
	UNION ALL
	SELECT ID_PROGETTO,
	       ID_MODALITA_AGEVOLAZIONE,
		   'Messa in mora '||b.DESC_BREVE_ATT_MONIT_CRED AS NOME_ENTITA_PROVENIENZA,
		   NOTE,
		   a.DT_INIZIO_VALIDITA,
		   a.DT_FINE_VALIDITA,
		   a.ID_UTENTE_INS,
		   a.ID_UTENTE_AGG,
		   a.DT_INSERIMENTO,
		   a.DT_AGGIORNAMENTO
	  FROM PBANDI_T_MESSA_IN_MORA a --ID_ATTIVITA_MORA
	  LEFT JOIN PBANDI_D_ATTIVITA_MONIT_CRED b on b.id_attivita_monit_cred = a.id_attivita_mora
	  LEFT JOIN PBANDI_D_TIPO_MONIT_CRED c on c.id_tipo_monit_cred = b.id_tipo_monit_cred and DESC_BREVE_TIPO_MONIT_CRED = 'tipo mora'
	UNION ALL
	SELECT ID_PROGETTO,
	       ID_MODALITA_AGEVOLAZIONE,
		   --'Annotazioni generali' AS NOME_ENTITA_PROVENIENZA,
		   'Note generali' AS NOME_ENTITA_PROVENIENZA,
		   NOTE,
		   a.DT_INIZIO_VALIDITA,
		   a.DT_FINE_VALIDITA,
		   a.ID_UTENTE_INS,
		   a.ID_UTENTE_AGG,
		   a.DT_INSERIMENTO,
		   a.DT_AGGIORNAMENTO
	  FROM PBANDI_T_ANNOTAZ_GENERALI a
	UNION ALL
	SELECT ID_PROGETTO,
	       ID_MODALITA_AGEVOLAZIONE,
		   'Iscrizione a ruolo' AS NOME_ENTITA_PROVENIENZA,
		   NOTE,
		   a.DT_INIZIO_VALIDITA,
		   a.DT_FINE_VALIDITA,
		   a.ID_UTENTE_INS,
		   a.ID_UTENTE_AGG,
		   a.DT_INSERIMENTO,
		   a.DT_AGGIORNAMENTO
	  FROM PBANDI_T_ISCRIZIONE_RUOLO a
	UNION ALL
	SELECT ID_PROGETTO,
	       ID_MODALITA_AGEVOLAZIONE,
		   --'Segnalazione corte conti' AS NOME_ENTITA_PROVENIENZA,
		   'Segnalazione Corte dei Conti' AS NOME_ENTITA_PROVENIENZA,
		   NOTE,
		   a.DT_INIZIO_VALIDITA,
		   a.DT_FINE_VALIDITA,
		   a.ID_UTENTE_INS,
		   a.ID_UTENTE_AGG,
		   a.DT_INSERIMENTO,
		   a.DT_AGGIORNAMENTO
	  FROM PBANDI_T_SEGNALAZ_CORTE_CONTI a
	UNION ALL
	SELECT ID_PROGETTO,
	       ID_MODALITA_AGEVOLAZIONE,
		   'Cessione quota Finpiemonte' AS NOME_ENTITA_PROVENIENZA,
		   NOTE,
		   a.DT_INIZIO_VALIDITA,
		   a.DT_FINE_VALIDITA,
		   a.ID_UTENTE_INS,
		   a.ID_UTENTE_AGG,
		   a.DT_INSERIMENTO,
		   a.DT_AGGIORNAMENTO
	  FROM PBANDI_T_CESSIONE_QUOTA_FP a
	UNION ALL
	SELECT ID_PROGETTO,
	       ID_MODALITA_AGEVOLAZIONE,
		   --'Transazione banca' AS NOME_ENTITA_PROVENIENZA,
		   'Transazioni' AS NOME_ENTITA_PROVENIENZA,
		   NOTE,
		   a.DT_INIZIO_VALIDITA,
		   a.DT_FINE_VALIDITA,
		   a.ID_UTENTE_INS,
		   a.ID_UTENTE_AGG,
		   a.DT_INSERIMENTO,
		   a.DT_AGGIORNAMENTO
	  FROM PBANDI_T_TRANSAZIONI_BANCA a
	UNION ALL
	SELECT ID_PROGETTO,
	       ID_MODALITA_AGEVOLAZIONE,
		   'Allungamento piano ammortamento' AS NOME_ENTITA_PROVENIENZA,
		   NOTE,
		   a.DT_INIZIO_VALIDITA,
		   a.DT_FINE_VALIDITA,
		   a.ID_UTENTE_INS,
		   a.ID_UTENTE_AGG,
		   a.DT_INSERIMENTO,
		   a.DT_AGGIORNAMENTO
	  FROM PBANDI_T_ALLUNG_PIANO_AMMORT a
	UNION ALL
	SELECT ID_PROGETTO,
	       ID_MODALITA_AGEVOLAZIONE,
		   'Creditoria' AS NOME_ENTITA_PROVENIENZA,
		   NOTE,
		   a.DT_INIZIO_VALIDITA,
		   a.DT_FINE_VALIDITA,
		   a.ID_UTENTE_INS,
		   a.ID_UTENTE_AGG,
		   a.DT_INSERIMENTO,
		   a.DT_AGGIORNAMENTO
	  FROM PBANDI_T_CREDITORIE a
	UNION ALL
	SELECT ID_PROGETTO,
	       ID_MODALITA_AGEVOLAZIONE,
		   'Procedure concorsuali' AS NOME_ENTITA_PROVENIENZA,
		   NOTE,
		   a.DT_INIZIO_VALIDITA,
		   a.DT_FINE_VALIDITA,
		   a.ID_UTENTE_INS,
		   a.ID_UTENTE_AGG,
		   a.DT_INSERIMENTO,
		   a.DT_AGGIORNAMENTO
	  FROM PBANDI_T_PROCEDURE_CONCORS a
	)
 WHERE DT_FINE_VALIDITA IS NULL
   AND NOTE IS NOT NULL
ORDER BY 1,4 DESC;   

CREATE OR REPLACE VIEW PBANDI_V_SOGG_AMMVO_CONTAB_B AS
SELECT DISTINCT
         s.id_sogg_ammvo_contab as id_sogg_ammvo_contab,  
         h.ndg as COD_BENEFICIARIO,
         h1.denominazione_ente_giuridico as RAGIONE_SOCIALE,
         o.cognome as COGNOME,
         o.nome as NOME,
         86 as ID_NAZIONE,
         n.id_provincia as ID_PROVINCIA,
         n.id_comune as ID_COMUNE,
         upper(n.desc_indirizzo) as INDIRIZZO,
         n.cap as CAP,
         h.codice_fiscale_soggetto as CODICE_FISCALE,
         h.codice_fiscale_soggetto as PARTITA_IVA,
         p.email as EMAIL,
         p.pec as PEC,
         p.telefono as TELEFONO,
         1 as DITTA,
         null as TOP011_CLIFOR_CG44,
		 s.data_invio as data_invio,
		 s.tipo_invio as tipo_invio,
		 s.esito as esito
		 --,AMMVO_CONTAB_CALC_VARIAZ(h.ndg) as FLAG_VARIAZIONE
FROM PBANDI_R_BANDO_LINEA_ENTE_COMP a
JOIN PBANDI_T_ENTE_COMPETENZA b on b.id_ente_competenza = a.id_ente_competenza and b.desc_ente = 'FINPIEMONTE'
JOIN PBANDI_D_RUOLO_ENTE_COMPETENZA c on c.id_ruolo_ente_competenza = a.id_ruolo_ente_competenza and c.desc_breve_ruolo_ente = 'DESTINATARIO'
JOIN PBANDI_R_BANDO_LINEA_INTERVENT d on d.progr_bando_linea_intervento = a.progr_bando_linea_intervento
JOIN PBANDI_T_DOMANDA e on e.progr_bando_linea_intervento = a.progr_bando_linea_intervento
--JOIN PBANDI_T_PROGETTO f on f.id_domanda = e.id_domanda
JOIN PBANDI_R_SOGGETTO_DOMANDA g on g.id_domanda = e.id_domanda and g.id_tipo_anagrafica = 1 and g.id_tipo_beneficiario <> 4 and g.dt_fine_validita is null
LEFT JOIN PBANDI_T_ENTE_GIURIDICO h1 on h1.id_ente_giuridico = g.id_ente_giuridico
JOIN PBANDI_T_SOGGETTO h on h.id_soggetto = h1.id_soggetto
LEFT JOIN PBANDI_R_SOGGETTO_DOMANDA_SEDE g1 on g1.progr_soggetto_domanda = g.progr_soggetto_domanda
LEFT JOIN PBANDI_T_INDIRIZZO n on n.id_indirizzo = nvl(g1.id_indirizzo,g.id_indirizzo_persona_fisica)
LEFT JOIN PBANDI_T_PERSONA_FISICA o on o.id_persona_fisica = g.id_persona_fisica
LEFT JOIN PBANDI_T_RECAPITI p on p.id_recapiti = nvl(g1.id_recapiti,g.id_recapiti_persona_fisica)
LEFT JOIN PBANDI_T_SOGG_AMMVO_CONTAB s on s.cod_beneficiario = h.ndg
where nvl(g1.id_tipo_sede,1) = 1 -- Sede Leg
and nvl(g.id_ente_giuridico,0) = nvl((select max(id_ente_giuridico)
                              from PBANDI_R_SOGGETTO_PROGETTO
                             where id_soggetto = g.id_soggetto),0)
and nvl(s.data_invio,to_date('31129999','ddmmyyyy')) = nvl((select max(data_invio)
                                                          from PBANDI_T_SOGG_AMMVO_CONTAB
					                                     where cod_beneficiario = h.ndg),to_date('31129999','ddmmyyyy'));
														 
														 
------------------														 
-- FUNCTION
-----------------
CREATE OR REPLACE FUNCTION 	AMMVO_CONTAB_CALC_VARIAZ (P_COD_BENEFICIARIO  IN VARCHAR2) RETURN VARCHAR2 IS

  CURSOR c1 (c_cod_beneficiario VARCHAR2) IS
   SELECT 
	    RAGIONE_SOCIALE,
		COGNOME,
		NOME,
		ID_NAZIONE,
		ID_PROVINCIA,
		ID_COMUNE,
		INDIRIZZO,
		CAP,
		CODICE_FISCALE,
		PARTITA_IVA,
		EMAIL,
		PEC,
		TELEFONO
	FROM PBANDI_T_SOGG_AMMVO_CONTAB
   WHERE COD_BENEFICIARIO = c_cod_beneficiario
     AND DATA_INVIO = (SELECT MAX(DATA_INVIO)
	                     FROM PBANDI_T_SOGG_AMMVO_CONTAB
						WHERE COD_BENEFICIARIO = c_cod_beneficiario)
   MINUS
   SELECT 
	    RAGIONE_SOCIALE,
		COGNOME,
		NOME,
		ID_NAZIONE,
		ID_PROVINCIA,
		ID_COMUNE,
		INDIRIZZO,
		CAP,
		CODICE_FISCALE,
		PARTITA_IVA,
		EMAIL,
		PEC,
		TELEFONO
	FROM PBANDI_V_SOGG_AMMVO_CONTAB_B
   WHERE COD_BENEFICIARIO = c_cod_beneficiario;
   
   r1 c1%ROWTYPE;
   
  v_flag_variazione varchar2(1);
  
BEGIN

  OPEN c1(P_COD_BENEFICIARIO);
  FETCH c1 INTO r1;
  IF c1%FOUND THEN
     v_flag_variazione := 'S';
  ELSE
     v_flag_variazione := 'N';
  END IF;
  
  CLOSE c1;

  RETURN v_flag_variazione;
END AMMVO_CONTAB_CALC_VARIAZ;												 
/


CREATE OR REPLACE FORCE VIEW PBANDI.PBANDI_V_SOGG_AMMVO_CONTAB AS
SELECT 
   ID_SOGG_AMMVO_CONTAB,
   COD_BENEFICIARIO,
   RAGIONE_SOCIALE,
   COGNOME,
   NOME,
   ID_NAZIONE,
   ID_PROVINCIA,
   ID_COMUNE,
   INDIRIZZO,
   CAP,
   CODICE_FISCALE,
   PARTITA_IVA,
   EMAIL,
   PEC,
   TELEFONO,
   DITTA,
   TOP011_CLIFOR_CG44,
   DATA_INVIO,
   TIPO_INVIO,
   ESITO,
   AMMVO_CONTAB_CALC_VARIAZ(COD_BENEFICIARIO) as FLAG_VARIAZIONE
FROM PBANDI_V_SOGG_AMMVO_CONTAB_B;

CREATE OR REPLACE PROCEDURE GetTemplateMessage
                                    (p_descr_breve_template_notif    IN  PBANDI_D_TEMPLATE_NOTIFICA.DESCR_BREVE_TEMPLATE_NOTIFICA%TYPE,
                                     p_subject_notifica             OUT  PBANDI_D_TEMPLATE_NOTIFICA.COMP_SUBJECT%TYPE,
                                     p_message_notifica             OUT  PBANDI_D_TEMPLATE_NOTIFICA.COMP_MESSAGE%TYPE) AS 

     CURSOR c1 (c_descr_breve_template_notif PBANDI_D_TEMPLATE_NOTIFICA.DESCR_BREVE_TEMPLATE_NOTIFICA%TYPE) IS
        SELECT comp_subject,
               comp_message,
               id_template_notifica
          FROM PBANDI_D_TEMPLATE_NOTIFICA
         WHERE descr_breve_template_notifica = c_descr_breve_template_notif;

     r1 c1%ROWTYPE;

     CURSOR c2 (c_id_template_notifica PBANDI_D_TEMPLATE_NOTIFICA.ID_TEMPLATE_NOTIFICA%TYPE) IS
        SELECT nome_parametro,
               placeholder
          FROM PBANDI_R_PLACEHOLDER_NOTIFICA a,
               PBANDI_D_METADATA_NOTIFICA b
         WHERE a.id_template_notifica = c_id_template_notifica
           AND b.id_metadata_notifica = a.id_metadata_notifica;


     v_subject_notifica     VARCHAR2(4000);
     v_message_notifica     CLOB;
     v_statement_replace CLOB;


  BEGIN
     OPEN c1(p_descr_breve_template_notif);
     FETCH c1 into r1;
     IF c1%NOTFOUND THEN 
        p_message_notifica := 'Template di notifica non previsto';
		p_subject_notifica := '';
     ELSE
            v_subject_notifica := r1.comp_subject;
            v_message_notifica := r1.comp_message;
            FOR r2 in c2(r1.id_template_notifica)
            LOOP
            v_statement_replace :=

                'DECLARE'||chr(10)||
                   'v_subject_notifica     VARCHAR2(4000);'||chr(10)||
                   'v_message_notifica     CLOB;'||chr(10)|| ---- mc sviluppo settembre 2019
                   'v_placeholder          PBANDI_R_PLACEHOLDER_NOTIFICA.PLACEHOLDER%TYPE;'||chr(10)||
                   'v_nome_parametro       PBANDI_D_METADATA_NOTIFICA.NOME_PARAMETRO%TYPE;'||chr(10)||
                'BEGIN'||chr(10)||
                   'v_subject_notifica     := '''||replace(v_subject_notifica,'''','''''')||''';'||chr(10)||
                   'v_message_notifica     := '''||replace(v_message_notifica,'''','''''')||''';'||chr(10)||
                   'v_placeholder          := '''||r2.placeholder||''';'||chr(10)||
                   'v_nome_parametro       :=   pck_pbandi_processo.v_metadata_notifiche_processo.'||replace(r2.nome_parametro,'''','''''')||';'||chr(10)||
                   ':v_subject_notifica := replace(v_subject_notifica,v_placeholder,v_nome_parametro);'||chr(10)||
                   ':v_message_notifica := replace(v_message_notifica,v_placeholder,v_nome_parametro);'||chr(10)||
                 'END;';

                   EXECUTE IMMEDIATE v_statement_replace USING OUT v_subject_notifica, OUT v_message_notifica;


            END LOOP;
			
			p_subject_notifica := v_subject_notifica;
			p_message_notifica := v_message_notifica;
       
     --
     
     END IF;
     CLOSE c1;

  END GetTemplateMessage;
  /

-- Calcola i giorni di sospensione per un identificativo sottoposto a monitoraggio
-- Le sospensioni con dt_fine nulla non sono considerati nel calcolo
CREATE OR REPLACE FUNCTION MonitTempi_GetNumGGSospesi (p_id_monit_tempi_sospeso IN NUMBER) RETURN NUMBER IS
   CURSOR c1 (c_id_monit_tempi_sospeso NUMBER) IS
      SELECT sum(TRUNC(dt_fine) - TRUNC(dt_decorrenza)) as num_gg_sospesi
	    FROM PBANDI_T_MONIT_TEMPI
       WHERE id_monit_tempi_sospeso = c_id_monit_tempi_sospeso
	     AND dt_fine IS NULL;
		 
  v_num_gg_sospesi NUMBER;
		 
BEGIN
  OPEN c1 (p_id_monit_tempi_sospeso);
  FETCH c1 INTO v_num_gg_sospesi;
  CLOSE c1;

RETURN nvl(v_num_gg_sospesi,0);
END MonitTempi_GetNumGGSospesi;
/

-- Calcola la data di sospensione per un identificativo sottoposto a monitoraggio
-- Si assume che ci sia solo una sospensione aperta per evento sospeso.Se cos non fosse si prende l'ultima
-- Se non ci sono sospensioni viene restituita la SYSDATE
CREATE OR REPLACE FUNCTION MonitTempi_GetDataSospensione (p_id_monit_tempi_sospeso IN NUMBER) RETURN DATE IS
   CURSOR c1 (c_id_monit_tempi_sospeso NUMBER) IS
      SELECT max(TRUNC(dt_decorrenza)) as v_dt_sospensione
	    FROM PBANDI_T_MONIT_TEMPI
       WHERE id_monit_tempi_sospeso = c_id_monit_tempi_sospeso
	     AND dt_fine IS NULL;
		 
  v_dt_sospensione DATE;
		 
BEGIN
  OPEN c1 (p_id_monit_tempi_sospeso);
  FETCH c1 INTO v_dt_sospensione;
  CLOSE c1;
  
  IF v_dt_sospensione IS NULL THEN
     v_dt_sospensione := TRUNC(SYSDATE);
  END IF;

RETURN v_dt_sospensione;
END MonitTempi_GetDataSospensione;
/

-- Verifica se c' ancora una sospensione aperta per un identificativo sottoposto a monitoraggio
CREATE OR REPLACE FUNCTION MonitTempi_IsSospensioneAperta (p_id_monit_tempi_sospeso IN NUMBER) RETURN VARCHAR2 IS
   CURSOR c1 (c_id_monit_tempi_sospeso NUMBER) IS
      SELECT count(*) as v_flag_sospensione_attiva
	    FROM PBANDI_T_MONIT_TEMPI
       WHERE id_monit_tempi_sospeso = c_id_monit_tempi_sospeso
	     AND dt_fine IS NULL;
		 
  v_flag_sospensione_attiva VARCHAR2(10) := 'FALSE';
  v_count  NUMBER;
		 
BEGIN
  OPEN c1 (p_id_monit_tempi_sospeso);
  FETCH c1 INTO v_count;
  CLOSE c1;
  
  IF v_count > 0 THEN
     v_flag_sospensione_attiva := 'TRUE';
  END IF;

RETURN v_flag_sospensione_attiva;
END MonitTempi_IsSospensioneAperta;
/

----------
-- VISTA
-----------

CREATE OR REPLACE FORCE VIEW PBANDI.PBANDI_V_MONIT_TEMPI
(
   ID_MONIT_TEMPI,
   ID_ENTITA,
   ID_TARGET,
   ID_PROGETTO,
   NOME_BANDO_LINEA,
   DENOMINAZIONE_BENEFICIARIO,
   CODICE_VISUALIZZATO_PROGETTO,
   DESCRIZIONE,
   DATA_DECORRENZA,
   NUM_GIORNI_PREVISTI,
   NUM_GIORNI_TRASCORSI,
   NUM_GIORNI_RESIDUI,
   DATA_SCADENZA,
   STATO
)
AS
   SELECT   mt.ID_MONIT_TEMPI,
            mt.id_entita,
			mt.id_target,
            p.ID_PROGETTO,
            bli.NOME_BANDO_LINEA,
            NVL (eg.denominazione_ente_giuridico,
                 pf.nome || NVL2 (pf.nome, ' ', '') || pf.cognome)
               AS DENOMINAZIONE_BENEFICIARIO,
            p.codice_visualizzato AS CODICE_VISUALIZZATO_PROGETTO,
            mt.descrizione,
            TO_CHAR (mt.dt_decorrenza, 'DD/MM/YYYY') AS DATA_DECORRENZA,
            mt.num_giorni AS NUM_GIORNI_PREVISTI,
            --NUM_GIORNI_TRASCORSI
            -- (MonitTempi_GetDataSospensione) Se non c' sospensione o le sospensioni sono tutte concluse allora la funzione restituisce la SYSDATE
            -- I giorni relativi alle sospensione concluse sono poi sottratte dal calcolo del numero dei giorni trascorsi
            (MonitTempi_GetDataSospensione (ID_MONIT_TEMPI)
             - TRUNC (mt.dt_decorrenza))
            - MonitTempi_GetNumGGSospesi (ID_MONIT_TEMPI)
               AS NUM_GIORNI_TRASCORSI,
            --NUM_GIORNI_RESIDUI
            -- (MonitTempi_GetDataSospensione) Se non c' sospensione o le sospensioni sono tutte concluse allora la funzione restituisce la SYSDATE
            -- I giorni relativi alle sospensione concluse sono poi da aggiungere al calcolo del numero dei giorni residui
            GREATEST (
               ( (TRUNC (mt.dt_decorrenza) + mt.num_giorni)
                - MonitTempi_GetDataSospensione (ID_MONIT_TEMPI))
               + MonitTempi_GetNumGGSospesi (ID_MONIT_TEMPI),
               0
            )
               AS NUM_GIORNI_RESIDUI,
            --DATA_SCADENZA
            --(MonitTempi_IsSospensioneAperta) Se c' una sospensione ancora aperta allora la data di scadenza  da definire
            -- I giorni relativi alle sospensione concluse sono da aggiungere al calcolo della data di scadenza
            CASE
               WHEN MonitTempi_IsSospensioneAperta (ID_MONIT_TEMPI) = 'TRUE'
               THEN
                  'da definire'
               ELSE
                  TO_CHAR (
                     (  TRUNC (mt.dt_decorrenza)
                      + mt.num_giorni
                      + MonitTempi_GetNumGGSospesi (ID_MONIT_TEMPI)),
                     'DD/MM/YYYY'
                  )
            END
               AS DATA_SCADENZA,
            CASE
               WHEN MonitTempi_IsSospensioneAperta (ID_MONIT_TEMPI) = 'TRUE'
               THEN
                  'SOSPESO'
               WHEN TRUNC (SYSDATE) >
                       (  mt.dt_decorrenza
                        + mt.num_giorni
                        + MonitTempi_GetNumGGSospesi (ID_MONIT_TEMPI))
               THEN
                  'SCADUTO'
               ELSE
                  'IN CORSO'
            END
               AS STATO
     FROM                           PBANDI_T_MONIT_TEMPI mt
                                 JOIN
                                    PBANDI_T_PROGETTO p
                                 ON p.id_progetto = mt.id_progetto
                              JOIN
                                 PBANDI_T_DOMANDA d
                              ON d.id_domanda = p.id_domanda
                           JOIN
                              PBANDI_R_BANDO_LINEA_INTERVENT bli
                           ON bli.progr_bando_linea_intervento =
                                 d.progr_bando_linea_intervento
                        JOIN
                           PBANDI_R_PARAM_MONIT_BANDO_LIN pmbl
                        ON pmbl.id_param_monit_bando_linea =
                              mt.id_param_monit_bando_linea
                     JOIN
                        PBANDI_C_PARAMETRI_MONIT pm
                     ON pm.id_parametro_monit = pmbl.id_parametro_monit
                  JOIN
                     PBANDI_R_SOGGETTO_PROGETTO sp
                  ON     sp.id_progetto = mt.id_progetto
                     AND sp.id_tipo_anagrafica = 1
                     AND sp.id_tipo_beneficiario <> 4
               LEFT JOIN
                  pbandi_t_ente_giuridico eg
               ON eg.id_ente_giuridico = sp.id_ente_giuridico
            LEFT JOIN
               pbandi_t_persona_fisica pf
            ON pf.id_persona_fisica = sp.id_persona_fisica
    WHERE   mt.dt_fine IS NULL AND mt.num_giorni IS NOT NULL;


-- Funzione utilizzata da un batch schedulato relativo alla scadenza di un monitoraggio 
-- che aggiorni il record corrispettivo sulla tabella di gestione
CREATE OR REPLACE FUNCTION MonitTempi_BatchAggScadenze  RETURN NUMBER IS
   CURSOR c1  IS 
      SELECT a.id_target as id_gestione_revoca,
	         b.id_tipologia_revoca,
			 b.id_stato_revoca,
			 b.dt_notifica,
			 b.id_attivita_revoca,
			 b.dt_fine_validita,
			 to_date(a.data_scadenza,'DD/MM/YYYY') as dt_scadenza
	    FROM PBANDI_V_MONIT_TEMPI a
		JOIN PBANDI_T_GESTIONE_REVOCA b ON b.id_gestione_revoca = a.id_target
       WHERE id_entita = 516 -- PBANDI_T_GESTIONE_REVOCA
	     AND stato = 'SCADUTO'
		 AND NVL(b.id_attivita_revoca,0) != 11 ; -- Termine scaduto
		 
  v_flag_scadenza BOOLEAN;
		 
BEGIN
--Rif. [A] = PBAN_TRS_STE_V03_MONTEMP001_SpecificheTecnicheMonitoraggioTempi
   FOR r1 IN c1 LOOP
	  -- PROCEDIMENTO DI REVOCA Rif. [A].6.1.5 Controdeduzioni procedimento di revoca (a decorrere dalla data di notifica che comunica lavvio del procedimento di revoca)
      IF r1.id_tipologia_revoca = 2 
	    AND r1.id_stato_revoca = 6 
		AND r1.dt_notifica IS NOT NULL 
		AND nvl(r1.id_attivita_revoca,0) in (0,9,10) --Proroga accettata(9), proroga rifiutata(10)
		AND r1.dt_fine_validita IS NULL THEN
		   v_flag_scadenza := TRUE;
		
      -- RICHIESTA INTEGRAZIONI Rif. [A].6.1.7 Invio richiesta integrazione alle controdeduzioni al procedimento di revoca
	  ELSIF r1.id_tipologia_revoca = 2 
	    AND r1.id_stato_revoca = 7
		AND r1.dt_notifica IS  NOT NULL 
		AND nvl(r1.id_attivita_revoca,0) in (0,9,10) --Proroga accettata(9), proroga rifiutata(10)
		AND r1.dt_fine_validita IS NULL THEN
		   v_flag_scadenza := TRUE;
		   
	  --PROVVEDIMENTO DI REVOCA Rif. [A].6.1.8 Contestazioni provvedimento di revoca (a decorrere dalla data di notifica che comunica lemissione del provvedimento di revoca)
	  ELSIF r1.id_tipologia_revoca = 3
	    AND r1.id_stato_revoca = 8  
		AND r1.dt_notifica IS NOT NULL 
		AND r1.id_attivita_revoca is null
		AND r1.dt_fine_validita IS NULL THEN
		   v_flag_scadenza := TRUE;
		   
	  ELSE
		   v_flag_scadenza := FALSE;
	  END IF;
	  
	  IF v_flag_scadenza = TRUE THEN
	  
	  	UPDATE PBANDI_T_GESTIONE_REVOCA
		   SET id_attivita_revoca = 11, --termine scaduto
		       dt_attivita = r1.dt_scadenza,
			   id_utente_agg = -19, -- Batch scadenze
			   dt_aggiornamento = sysdate
		WHERE id_gestione_revoca = r1.id_gestione_revoca;
		
	  END IF;

   END LOOP;

COMMIT;
RETURN 0;
EXCEPTION
   WHEN OTHERS THEN
     ROLLBACK;
     RETURN 1;
   	 DBMS_OUTPUT.PUT_LINE(SQLERRM || ' riga = '|| DBMS_UTILITY.FORMAT_ERROR_BACKTRACE);
END MonitTempi_BatchAggScadenze;
/

CREATE OR REPLACE FORCE VIEW PBANDI.PBANDI_V_DOC_INDEX_BATCH
(
   ID_DOCUMENTO_INDEX,
   AZIONE,
   UUID_NODO,
   PROGR_BANDO_LINEA_INTERVENTO,
   ID_PROGETTO,
   CODICE_VISUALIZZATO,
   NOME_FILE,
   DESC_TIPO_DOC_INDEX,
   ID_STATO_DOCUMENTO,
   DESC_BREVE,
   FLAG_FIRMA_CARTACEA,
   DT_VERIFICA_FIRMA,
   DT_MARCA_TEMPORALE,
   DESCRIZIONE,
   NUM_PROTOCOLLO,
   ID_SOGG_DELEGATO,
   ID_SOGG_RAPPR_LEGALE,
   DESC_BREVE_ENTE,
   DESC_BREVE_SETTORE,
   DESC_ENTE_COMPETENZA,
   ID_MESSAGGIO_APPL,
   ENTE,
   SETTORE,
   PAROLA_CHIAVE,
   FEEDBACK_ACTA,
   FASCICOLO_ACTA,
   CLASSIFICAZIONE_ACTA,
   FLAG_REGIONALE,
   FLAG_FINPIEMONTE,
   DENOMINAZIONE_BENEFICIARIO,
   CODICE_FISCALE_BENEFICIARIO,
   CONSERVAZIONE_CORRENTE,
   CONSERVAZIONE_GENERALE,
   NOME_DOCUMENTO,
   NOME_DOCUMENTO_FIRMATO,
   NOME_DOCUMENTO_MARCATO,
   REPOSITORY,
   FLAG_FIRMA_AUTOGRAFA,
   FLAG_PROTOCOLLO
)
AS
   WITH LVF                                      --Lof verifica Firma digitale
          AS (SELECT   ID_DOCUMENTO_INDEX, ID_MESSAGGIO_APPL
                FROM   PBANDI_T_LOG_VALIDAZ_FIRMA A
               WHERE   ID_LOG =
                          (SELECT   MAX (ID_LOG)
                             FROM   PBANDI_T_LOG_VALIDAZ_FIRMA
                            WHERE   ID_DOCUMENTO_INDEX = A.ID_DOCUMENTO_INDEX)
                       AND METODO = 'VERIFY'
                       AND FLAG_STATO_VALIDAZIONE = 'N'),
       LMT
          AS                                        -- Log Marcatura temporale
            (SELECT   ID_DOCUMENTO_INDEX, METODO
               FROM   PBANDI_T_LOG_VALIDAZ_FIRMA A
              WHERE   ID_LOG =
                         (SELECT   MAX (ID_LOG)
                            FROM   PBANDI_T_LOG_VALIDAZ_FIRMA
                           WHERE   ID_DOCUMENTO_INDEX = A.ID_DOCUMENTO_INDEX)
                      AND METODO = 'TIMESTAMP'),
       BEN
          AS (SELECT   A.ID_PROGETTO,
                       B.DENOMINAZIONE_ENTE_GIURIDICO,
                       C.CODICE_FISCALE_SOGGETTO
                FROM   PBANDI_R_SOGGETTO_PROGETTO A,
                       PBANDI_T_ENTE_GIURIDICO B,
                       PBANDI_T_SOGGETTO C
               WHERE       A.ID_ENTE_GIURIDICO = B.ID_ENTE_GIURIDICO
                       AND C.ID_SOGGETTO = A.ID_SOGGETTO
                       AND ID_TIPO_BENEFICIARIO != 4
                       AND ID_TIPO_ANAGRAFICA = 1
                       AND B.DT_FINE_VALIDITA IS NULL
                       AND A.DT_FINE_VALIDITA IS NULL),
       BEN_PRIV
          AS (SELECT   A.ID_PROGETTO,
                       B.COGNOME || ' ' || B.NOME
                          AS DENOMINAZIONE_PERSONA_FISICA,
                       C.CODICE_FISCALE_SOGGETTO
                FROM   PBANDI_R_SOGGETTO_PROGETTO A,
                       PBANDI_T_PERSONA_FISICA B,
                       PBANDI_T_SOGGETTO C
               WHERE       A.ID_PERSONA_FISICA = B.ID_PERSONA_FISICA
                       AND C.ID_SOGGETTO = A.ID_SOGGETTO
                       AND ID_TIPO_BENEFICIARIO != 4
                       AND ID_TIPO_ANAGRAFICA = 1
                       AND B.DT_FINE_VALIDITA IS NULL
                       AND A.DT_FINE_VALIDITA IS NULL)
   --MAIN
   SELECT   ID_DOCUMENTO_INDEX,
            CASE
               WHEN     DESC_BREVE IN ('ACQUISITO')
                    AND FLAG_FIRMA_CARTACEA = 'N'
                    AND DT_VERIFICA_FIRMA IS NULL
                    AND lvf.ID_MESSAGGIO_APPL = 'ERR_GENERIC'
               THEN
                  'DA_VALIDARE'
               WHEN     DESC_BREVE IN ('VALIDATO')
                    AND FLAG_FIRMA_CARTACEA = 'N'
                    AND DT_VERIFICA_FIRMA IS NOT NULL
                    AND DT_MARCA_TEMPORALE IS NULL
                    AND lmt.METODO = 'TIMESTAMP'
               THEN
                  'DA_MARCARE_TEMPORALMENTE'
               WHEN DESC_BREVE IN ('INVIATO') AND FLAG_FIRMA_CARTACEA = 'N'
                    AND (DT_MARCA_TEMPORALE IS NOT NULL
                         OR FLAG_FIRMA_AUTOGRAFA = 'S')
               THEN
                  'DA_CLASSIFICARE'
               WHEN DESC_BREVE IN ('CLASSIFICATO')
                    AND FLAG_FIRMA_CARTACEA = 'N'
                    AND (DT_MARCA_TEMPORALE IS NOT NULL
                         OR FLAG_FIRMA_AUTOGRAFA = 'S')
                    AND DT_CLASSIFICAZIONE IS NOT NULL
               THEN
                  'DA_PROTOCOLLARE'
            END
               AZIONE,
            UUID_NODO,
            PROGR_BANDO_LINEA_INTERVENTO,
            ID_PROGETTO,
            CODICE_VISUALIZZATO,
            NOME_FILE,
            DESC_TIPO_DOC_INDEX,
            ID_STATO_DOCUMENTO,
            DESC_BREVE,
            FLAG_FIRMA_CARTACEA,
            TO_CHAR (DT_VERIFICA_FIRMA, 'DD/MM/YYYY') AS DT_VERIFICA_FIRMA,
            TO_CHAR (DT_MARCA_TEMPORALE, 'DD/MM/YYYY') AS DT_MARCA_TEMPORALE,
            prot.DESCRIZIONE,
            dp.NUM_PROTOCOLLO,
            ID_SOGG_DELEGATO,
            ID_SOGG_RAPPR_LEGALE,
            blec.DESC_BREVE_ENTE,
            CASE
               WHEN blec.DESC_SETTORE IS NOT NULL THEN '000'
               ELSE NVL (blec.DESC_BREVE_SETTORE, '000')
            END
               DESC_BREVE_SETTORE,
            blec.DESC_ENTE_COMPETENZA,
            ID_MESSAGGIO_APPL,
            blec.DESC_BREVE_ENTE ENTE,
            blec.DESC_BREVE_ENTE
            || NVL (blec.DESC_SETTORE, NVL (blec.DESC_BREVE_SETTORE, '000'))
               SETTORE,
            blec.PAROLA_CHIAVE,
            blec.FEEDBACK_ACTA,
            FASCICOLO_ACTA,
            CLASSIFICAZIONE_ACTA,
            CASE
               WHEN DESC_BREVE_TIPO_ENTE_COMPETENZ IN ('ADG', 'REG') THEN 'S'
               ELSE 'N'
            END
               FLAG_REGIONALE,
            CASE
               WHEN DESC_BREVE_TIPO_ENTE_COMPETENZ IN ('OI') THEN 'S'
               ELSE 'N'
            END
               FLAG_FINPIEMONTE,
            NVL (ben.DENOMINAZIONE_ENTE_GIURIDICO,
                 ben_priv.DENOMINAZIONE_PERSONA_FISICA)
               DENOMINAZIONE_BENEFICIARIO,
            NVL (ben.CODICE_FISCALE_SOGGETTO,
                 ben_priv.CODICE_FISCALE_SOGGETTO)
               CODICE_FISCALE_BENEFICIARIO,
            blec.CONSERVAZIONE_CORRENTE,
            blec.CONSERVAZIONE_GENERALE,
            NOME_DOCUMENTO,
            NOME_DOCUMENTO_FIRMATO,
            NOME_DOCUMENTO_MARCATO,
            REPOSITORY,
            FLAG_FIRMA_AUTOGRAFA,
			FLAG_PROTOCOLLO  
     FROM                                          PBANDI_T_DOCUMENTO_INDEX
                                                JOIN
                                                   PBANDI_C_TIPO_DOCUMENTO_INDEX
                                                USING (ID_TIPO_DOCUMENTO_INDEX)
                                             LEFT JOIN
                                                PBANDI_D_STATO_DOCUMENTO_INDEX
                                             USING (ID_STATO_DOCUMENTO)
                                          JOIN
                                             PBANDI_T_PROGETTO p
                                          USING (ID_PROGETTO)
                                       JOIN
                                          PBANDI_T_DOMANDA d
                                       ON d.ID_DOMANDA = p.ID_DOMANDA
                                    -- USING (ID_DOMANDA)
                                    JOIN
                                       PBANDI_R_BANDO_LINEA_INTERVENT bli
                                    USING (PROGR_BANDO_LINEA_INTERVENTO)
                                 JOIN
                                    PBANDI_R_REGOLA_BANDO_LINEA
                                 USING (PROGR_BANDO_LINEA_INTERVENTO)
                              JOIN
                                 PBANDI_V_BANDO_LINEA_ENTE_COMP blec
                              USING (PROGR_BANDO_LINEA_INTERVENTO)
                           LEFT JOIN
                              PBANDI_T_DOC_PROTOCOLLO dp
                           USING (ID_DOCUMENTO_INDEX)
                        LEFT JOIN
                           PBANDI_D_SISTEMA_PROTOCOLLO prot
                        USING (ID_SISTEMA_PROT)
                     LEFT JOIN
                        lvf
                     USING (ID_DOCUMENTO_INDEX)
                  LEFT JOIN
                     lmt
                  USING (ID_DOCUMENTO_INDEX)
               LEFT JOIN
                  ben
               USING (ID_PROGETTO)
            LEFT JOIN
               ben_priv
            USING (ID_PROGETTO)
    WHERE       PBANDI_C_TIPO_DOCUMENTO_INDEX.FLAG_FIRMABILE = 'S'
            AND blec.DESC_BREVE_RUOLO_ENTE = 'DESTINATARIO'
            AND PBANDI_R_REGOLA_BANDO_LINEA.ID_REGOLA = 42;

-------------------------
-- VIEW -----------------
-------------------------

CREATE OR REPLACE VIEW PBANDI_V_NOTE_GENERALI AS
SELECT ID_PROGETTO,
       NOME_ENTITA_PROVENIENZA,
       NOTE,
       ID_UTENTE_INS,
       ID_UTENTE_AGG,
       DT_INSERIMENTO,
       DT_AGGIORNAMENTO
FROM
    (SELECT ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       to_char(NOTE) as NOTE,
       NULL AS ID_UTENTE_INS,
       ID_UTENTE_AGG,
       DT_INSERIMENTO,
       DT_AGGIORNAMENTO
       FROM PBANDI_T_DICH_MENS_WS
       UNION ALL
       SELECT ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       NOTE,
       ID_UTENTE_INS,
       ID_UTENTE_AGG,
       DT_INSERIMENTO,
       DT_AGGIORNAMENTO
       FROM PBANDI_T_SERVICER
       UNION ALL
       SELECT ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       NOTE,
       ID_UTENTE_INS,
       ID_UTENTE_AGG,
       DT_INSERIMENTO,
       DT_AGGIORNAMENTO
       FROM PBANDI_R_PROG_SOGG_FINANZIAT
       UNION ALL
       SELECT ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       NOTE,
       ID_UTENTE_INS,
       ID_UTENTE_AGG,
       DT_INSERIMENTO,
       DT_AGGIORNAMENTO
       FROM PBANDI_W_PROG_SOGG_FIN_LOG
       UNION ALL
       SELECT ID_PROGETTO,
       'TUTTE LE AREE' AS NOME_ENTITA_PROVENIENZA,
       NOTE,
       NULL AS ID_UTENTE_INS,
       NULL AS ID_UTENTE_AGG,
       DT_INSERIMENTO,
       NULL AS DT_AGGIORNAMENTO
       FROM PBANDI_W_ATTIVITA_PREGRESSE
       UNION ALL
       SELECT ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       NOTE,
       ID_UTENTE_INS,
       ID_UTENTE_AGG,
       DT_INSERIMENTO,
       DT_AGGIORNAMENTO
       FROM PBANDI_T_RECUPERO
	   /*
       UNION ALL
       SELECT ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       NOTE_CHIUSURA_PROGETTO AS NOTE,
       ID_UTENTE_INS,
       ID_UTENTE_AGG,
       DT_INSERIMENTO,
       DT_AGGIORNAMENTO
       FROM PBANDI_T_PROGETTO_AI
	   */
       UNION ALL
       SELECT ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       NOTE_CHIUSURA_PROGETTO  AS NOTE,
       ID_UTENTE_INS,
       ID_UTENTE_AGG,
       DT_INSERIMENTO,
       DT_AGGIORNAMENTO
       FROM PBANDI_T_PROGETTO
       UNION ALL
       SELECT ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       NOTE_ATTO AS NOTE,
       ID_UTENTE_INS,
       ID_UTENTE_AGG,
       DT_INSERIMENTO,
       DT_AGGIORNAMENTO
       FROM PBANDI_T_ATTO_LIQUIDAZIONE
       UNION ALL
       SELECT ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       NOTE_COMUNICAZ_FINE_PROGETTO AS NOTE,
       ID_UTENTE_INS,
       ID_UTENTE_AGG,
       DT_COMUNICAZIONE AS DT_INSERIMENTO,
       NULL AS DT_AGGIORNAMENTO
       FROM PBANDI_T_COMUNICAZ_FINE_PROG
       UNION ALL -- PBANDI_T_DETT_CHECK_APPALTI
       SELECT DISTINCT ptpa.ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       ptdca.NOTE,
       NULL AS ID_UTENTE_INS,
       NULL AS ID_UTENTE_AGG,
       NULL AS DT_INSERIMENTO,
       NULL AS DT_AGGIORNAMENTO
       FROM PBANDI_T_PROCEDURA_AGGIUDICAZ ptpa
       INNER JOIN PBANDI_T_APPALTO pta ON PTPA.ID_PROCEDURA_AGGIUDICAZ = pta.ID_PROCEDURA_AGGIUDICAZ
       INNER JOIN PBANDI_T_APPALTO_CHECKLIST ptac ON PTA.ID_APPALTO = PTAC.ID_APPALTO
       INNER JOIN PBANDI_T_DETT_CHECK_APPALTI ptdca ON PTAC.ID_APPALTO_CHECKLIST = PTDCA.ID_APPALTO_CHECKLIST
       UNION ALL
       SELECT ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       NOTE,
       NULL AS ID_UTENTE_INS,
       NULL AS ID_UTENTE_AGG,
       DATA_CAMPIONE AS DT_INSERIMENTO,
       NULL AS DT_AGGIORNAMENTO
       FROM PBANDI_T_IRREGOLARITA_PROVV
       UNION ALL -- PBANDI_T_INTEGRAZIONE_APPALTO
       SELECT DISTINCT ptpa.ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       PTIA.NOTE_RICHIESTA AS NOTE,
       NULL AS ID_UTENTE_INS,
       NULL AS ID_UTENTE_AGG,
       PTIA.DT_INVIO AS DT_INSERIMENTO,
       NULL AS DT_AGGIORNAMENTO
       FROM PBANDI_T_PROCEDURA_AGGIUDICAZ ptpa
       INNER JOIN PBANDI_T_APPALTO pta ON PTPA.ID_PROCEDURA_AGGIUDICAZ = pta.ID_PROCEDURA_AGGIUDICAZ
       INNER JOIN PBANDI_T_INTEGRAZIONE_APPALTO PTIA ON PTPA.ID_PROCEDURA_AGGIUDICAZ = PTA.ID_PROCEDURA_AGGIUDICAZ
       UNION ALL -- PBANDI_T_ESITI_NOTE_AFFIDAMENT
       SELECT DISTINCT ptdi.ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       ptena.NOTE,
       ptena.ID_UTENTE_INS,
       NULL AS ID_UTENTE_AGG,
       ptena.DATA_INS AS DT_INSERIMENTO,
       NULL AS DT_AGGIORNAMENTO
       FROM PBANDI_T_DOCUMENTO_INDEX ptdi
       INNER JOIN PBANDI_T_CHECKLIST ptc ON PTDI.ID_DOCUMENTO_INDEX = PTC.ID_DOCUMENTO_INDEX
       INNER JOIN PBANDI_T_ESITI_NOTE_AFFIDAMENT ptena ON PTC.ID_CHECKLIST = PTENA.ID_CHECKLIST
       UNION ALL -- PBANDI_T_VARIANTI_AFFIDAMENTI
       SELECT DISTINCT ptpa.ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       ptva.NOTE,
       NULL AS  ID_UTENTE_INS,
       NULL AS ID_UTENTE_AGG,
       ptva.DT_INSERIMENTO,
       NULL AS DT_AGGIORNAMENTO
       FROM PBANDI_T_PROCEDURA_AGGIUDICAZ ptpa
       INNER JOIN PBANDI_T_APPALTO pta ON PTPA.ID_PROCEDURA_AGGIUDICAZ = PTA.ID_PROCEDURA_AGGIUDICAZ
       INNER JOIN PBANDI_T_VARIANTI_AFFIDAMENTI ptva ON PTA.ID_APPALTO = PTVA.ID_APPALTO
       UNION ALL
       SELECT ID_PROGETTO_CEDENTE AS ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       NOTE_RICEZIONE AS NOTE,
       ID_UTENTE_INS,
       ID_UTENTE_AGG,
       DATA_INSERIMENTO AS DT_INSERIMENTO,
       DATA_MODIFICA  AS DT_AGGIORNAMENTO
       FROM PBANDI_T_ECONOMIE
       UNION ALL
       SELECT ID_PROGETTO_CEDENTE AS ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       NOTE_CESSIONE  AS NOTE,
       ID_UTENTE_INS,
       ID_UTENTE_AGG,
       DATA_INSERIMENTO AS DT_INSERIMENTO,
       DATA_MODIFICA  AS DT_AGGIORNAMENTO
       FROM PBANDI_T_ECONOMIE
       UNION ALL -- PBANDI_R_PAG_QUOT_PARTE_DOC_SP
       SELECT DISTINCT ptqpds.ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       prpqpds.NOTE_VALIDAZIONE  AS NOTE,
       prpqpds.ID_UTENTE_INS,
       prpqpds.ID_UTENTE_AGG,
       prpqpds.DT_INSERIMENTO,
       prpqpds.DT_AGGIORNAMENTO
       FROM PBANDI_T_QUOTA_PARTE_DOC_SPESA ptqpds
       INNER JOIN PBANDI_R_PAG_QUOT_PARTE_DOC_SP prpqpds ON PTQPDS.ID_QUOTA_PARTE_DOC_SPESA =PRPQPDS.ID_QUOTA_PARTE_DOC_SPESA
       UNION ALL
       SELECT ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       NOTE_CHIUSURA_VALIDAZIONE  AS NOTE,
       ID_UTENTE_INS,
       ID_UTENTE_AGG,
       DT_DICHIARAZIONE AS DT_INSERIMENTO,
       NULL AS DT_AGGIORNAMENTO
       FROM PBANDI_T_DICHIARAZIONE_SPESA
       UNION ALL
       SELECT ID_PROGETTO,
       'GESTIONE REVOCHE' AS NOME_ENTITA_PROVENIENZA,
       NOTE,
       ID_UTENTE_INS,
       ID_UTENTE_AGG,
       DT_INSERIMENTO,
       DT_AGGIORNAMENTO
       FROM PBANDI_T_REVOCA
       UNION ALL
       SELECT ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       NOTE_VALIDAZIONE AS NOTE,
       ID_UTENTE_INS,
       ID_UTENTE_AGG,
       NULL AS DT_INSERIMENTO,
       NULL AS DT_AGGIORNAMENTO
       FROM PBANDI_R_DOC_SPESA_PROGETTO
       UNION ALL -- PBANDI_R_FORNITORE_QUALIFICA
       SELECT DISTINCT prsp.ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       prfq.NOTE_QUALIFICA AS NOTE,
       NULL AS ID_UTENTE_INS,
       NULL AS ID_UTENTE_AGG,
       prfq.DT_INIZIO_VALIDITA AS DT_INSERIMENTO,
       NULL AS DT_AGGIORNAMENTO
       FROM PBANDI_R_SOGGETTO_PROGETTO prsp
       INNER JOIN PBANDI_T_FORNITORE ptf ON PRSP.ID_SOGGETTO = PTF.ID_SOGGETTO_FORNITORE
       INNER JOIN PBANDI_R_FORNITORE_QUALIFICA prfq ON PTF.ID_FORNITORE = PRFQ.ID_FORNITORE
       UNION ALL
       SELECT ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       NOTE_FIDEIUSSIONE AS NOTE,
       ID_UTENTE_INS,
       ID_UTENTE_AGG,
       DT_INSERIMENTO,
       DT_AGGIORNAMENTO
       FROM PBANDI_T_FIDEIUSSIONE
       UNION ALL
       SELECT ID_PROGETTO,
       'GESTIONE REVOCHE' AS NOME_ENTITA_PROVENIENZA,
       NOTE,
       ID_UTENTE_INS,
       ID_UTENTE_AGG,
       DT_INSERIMENTO,
       DT_AGGIORNAMENTO
       FROM PBANDI_T_GESTIONE_REVOCA
       UNION ALL
       SELECT ID_PROGETTO,
       'GESTIONE GARANZIE' AS NOME_ENTITA_PROVENIENZA,
       NOTE,
       ID_UTENTE_INS,
       ID_UTENTE_AGG,
       DT_INSERIMENTO,
       DT_AGGIORNAMENTO
       FROM PBANDI_T_ESCUSSIONE
       UNION ALL -- PBANDI_T_CONTO_ECONOMICO
       SELECT DISTINCT ptp.ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       ptce.NOTE_CONTO_ECONOMICO AS NOTE,
       ptce.ID_UTENTE_INS,
       ptce.ID_UTENTE_AGG,
       ptce.DT_INIZIO_VALIDITA AS DT_INSERIMENTO,
       NULL AS DT_AGGIORNAMENTO
       FROM PBANDI_T_PROGETTO ptp
       INNER JOIN PBANDI_T_DOMANDA ptd ON PTP.ID_DOMANDA = PTD.ID_DOMANDA
       INNER JOIN PBANDI_T_CONTO_ECONOMICO ptce ON PTP.ID_DOMANDA = PTCE.ID_DOMANDA
       UNION ALL
       SELECT ID_PROGETTO,
       'CONTROLLI IN LOCO' AS NOME_ENTITA_PROVENIENZA,
       NOTE,
       NULL AS ID_UTENTE_INS,
       NULL AS ID_UTENTE_AGG,
       DATA_CAMPIONE AS DT_INSERIMENTO,
       NULL AS DT_AGGIORNAMENTO
       FROM PBANDI_T_ESITO_CONTROLLI
       UNION ALL
       SELECT ID_PROGETTO,
       'EROGAZIONE' AS NOME_ENTITA_PROVENIENZA,
       NOTE_EROGAZIONE AS NOTE,
       ID_UTENTE_INS,
       ID_UTENTE_AGG,
       DT_INSERIMENTO,
       DT_AGGIORNAMENTO
       FROM PBANDI_T_EROGAZIONE
       UNION ALL
       SELECT ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       NOTE,
       ID_UTENTE_INS,
       ID_UTENTE_AGG,
       NULL AS DT_INSERIMENTO,
       NULL AS DT_AGGIORNAMENTO
       FROM PBANDI_W_PROG_SOGG_FINANZIAT
       UNION ALL
       SELECT ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       NOTE,
       ID_UTENTE_INS,
       ID_UTENTE_AGG,
       DT_INIZIO_VALIDITA AS DT_INSERIMENTO,
       DT_AGGIORNAMENTO
       FROM PBANDI_T_QUADRO_PREVISIONALE
       UNION ALL
       SELECT ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       NOTE_PRATICA_USATA AS NOTE,
       ID_UTENTE_INS,
       ID_UTENTE_AGG,
       DT_INIZIO_VALIDITA AS DT_INSERIMENTO,
       NULL AS DT_AGGIORNAMENTO
       FROM PBANDI_T_IRREGOLARITA
       UNION ALL
       SELECT ID_PROGETTO,
       'RENDICONTAZIONE' AS NOME_ENTITA_PROVENIENZA,
       NOTE,
       ID_UTENTE_INS,
       ID_UTENTE_AGG,
       DT_INIZIO_VALIDITA AS DT_INSERIMENTO,
       NULL AS DT_AGGIORNAMENTO
       FROM PBANDI_T_IRREGOLARITA
       UNION ALL
       SELECT ID_PROGETTO,
       'AREA CREDITI' AS NOME_ENTITA_PROVENIENZA,
       NOTE,
       ID_UTENTE_INS,
       ID_UTENTE_AGG,
       DT_INSERIMENTO,
       DT_AGGIORNAMENTO
       FROM PBANDI_T_ANNOTAZ_GENERALI
       UNION ALL
       SELECT ID_PROGETTO,
           'AREA CREDITI' AS NOME_ENTITA_PROVENIENZA,
           NOTE,
           a.ID_UTENTE_INS,
           a.ID_UTENTE_AGG,
           a.DT_INSERIMENTO,
           a.DT_AGGIORNAMENTO
      FROM PBANDI_V_NOTE_MONITORAGGIO a
      ) WHERE NOTE IS NOT NULL;


-- 18122023 mc
ALTER TABLE PBANDI_T_PROPOSTA_EROGAZIONE ADD ID_CAUSALE_EROGAZIONE NUMBER(3);
ALTER TABLE PBANDI_T_PROPOSTA_EROGAZIONE ADD CONSTRAINT fk_pbandi_d_causale_erogazi_06
    FOREIGN KEY (ID_CAUSALE_EROGAZIONE) REFERENCES PBANDI_D_CAUSALE_EROGAZIONE (ID_CAUSALE_EROGAZIONE);
create index IE_PBANDI_T_PROPOSTA_EROGAZ_6 on PBANDI_T_PROPOSTA_EROGAZIONE (ID_CAUSALE_EROGAZIONE)
  tablespace PBANDI_IDX;
-- SEQ_PBANDI_t_migrazione_finpis 
drop sequence seq_pbandi_t_distinta;
CREATE SEQUENCE seq_pbandi_t_distinta
  START WITH 900000
  MAXVALUE 999999999999999999999999999
  MINVALUE 1
  NOCYCLE
  NOCACHE
  NOORDER;
-- 19122023 mc
alter table pbandi_t_pagamento add gg_quietanza number;
comment on column pbandi_t_pagamento.gg_quietanza is 'Numeri di giorni  entro i quali il beneficiario pu inserire la quietanza del documento di spesa';